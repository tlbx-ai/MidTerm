<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=overlays-content" />
    <title>MidTerm</title>

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#0D0E14" />

    <!-- Preload terminal fonts for instant availability -->
    <link rel="preload" href="fonts/CascadiaCode-Regular.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="fonts/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="fonts/Terminus.woff2" as="font" type="font/woff2" crossorigin />

    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="css/xterm.css" />
</head>
<body>
    <div id="security-warning" class="security-warning hidden">
        <span class="warning-icon">&#9888;</span>
        <span class="warning-text">No password set. Anyone on the network can access your terminals.</span>
        <button id="btn-set-password-warning" class="warning-btn">Set Password</button>
        <button id="btn-dismiss-warning" class="warning-dismiss">&times;</button>
    </div>

    <div id="app" class="terminal-page">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-resize-grip" id="sidebar-resize-grip"></div>
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <img src="/img/logo.png" alt="MidTerm" class="sidebar-logo" />
                    <span class="sidebar-title">MidTerm</span>
                </div>
                <div class="sidebar-header-buttons">
                    <button class="sidebar-btn sidebar-collapse-btn" id="btn-collapse-sidebar" title="Hide sidebar"><span class="icon">&#xe913;</span></button>
                    <button class="sidebar-btn btn-history" id="btn-history" title="Quick Launch"><span class="icon">&#xe997;</span></button>
                    <button class="sidebar-btn" id="btn-settings" title="Settings"><span class="icon">&#xe991;</span></button>
                    <button class="sidebar-btn primary" id="btn-new-session" title="New Terminal"><span class="icon">&#xea81;</span></button>
                </div>
            </div>
            <div class="session-list" id="session-list"></div>
            <div class="sidebar-footer">
                <div id="update-panel" class="update-panel hidden">
                    <div class="update-header">Update Available</div>
                    <div class="update-versions">
                        <span class="update-current"></span>
                        <span class="update-arrow icon">&#xe91b;</span>
                        <span class="update-latest"></span>
                        <span id="update-changelog-link" class="update-changelog-link">Show Changelog</span>
                    </div>
                    <button id="update-btn" class="update-btn">Update & Restart</button>
                    <div class="update-note">Sessions will be closed</div>
                </div>
                <div id="voice-section" class="voice-section hidden">
                    <button class="voice-section-header" id="btn-toggle-voice">
                        <span class="voice-section-title">Voice Assistant</span>
                        <span class="voice-section-chevron icon">&#xe910;</span>
                    </button>
                    <div class="voice-section-content" id="voice-section-content">
                        <div class="voice-controls">
                            <button id="btn-voice-toggle" class="voice-btn" title="Start/Stop">
                                <span class="icon">&#xea15;</span>
                            </button>
                            <button id="btn-voice-sync" class="voice-btn hidden" title="Test Voice Server Connection">
                                <span class="icon">&#xea2e;</span>
                            </button>
                            <button id="btn-voice-chat" class="voice-btn" title="Toggle Chat Panel">
                                <span class="icon">&#xe96b;</span>
                            </button>
                        </div>
                        <div class="voice-settings" id="voice-settings">
                            <div class="voice-setting-row">
                                <label>Voice</label>
                                <select id="voice-select" class="voice-select">
                                    <option value="">Loading...</option>
                                </select>
                            </div>
                            <div class="voice-setting-row">
                                <label>Microphone</label>
                                <select id="mic-select" class="voice-select">
                                    <option value="">Default</option>
                                </select>
                            </div>
                            <div class="voice-setting-row">
                                <label>Speed</label>
                                <div class="voice-speed-control">
                                    <input type="range" id="voice-speed" min="0.25" max="1.5" step="0.25" value="1.0">
                                    <span id="voice-speed-value">1.0x</span>
                                </div>
                            </div>
                        </div>
                        <div class="voice-status" id="voice-status">Not connected</div>
                    </div>
                </div>
                <div class="network-section" id="network-section">
                    <button class="network-section-header" id="btn-toggle-network" title="Toggle Network & Remote Access">
                        <span class="network-section-title">Network & Remote Access</span>
                        <span class="network-section-chevron icon">&#xe910;</span>
                    </button>
                    <div class="network-section-content" id="network-section-content">
                        <div class="network-list" id="network-list"></div>
                        <div class="network-actions">
                            <a id="trust-link" href="/trust" class="network-action-link" title="Trust certificate on this or other devices">
                                <span class="icon">&#xe908;</span>
                                Trust Certificate
                            </a>
                            <button id="btn-share-access" class="share-access-link" title="Share connection info via email">
                                <span class="icon">&#xe925;</span>
                                Share Access...
                            </button>
                        </div>
                    </div>
                </div>
                <div class="footer-row">
                    <span class="footer-sessions">Sessions: <span id="session-count">0</span></span>
                    <span class="footer-traffic" id="ws-traffic" title="WebSocket throughput">0 B/s</span>
                    <span class="version" id="app-version" title="Assembly version"></span>
                </div>
            </div>
        </aside>
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <aside class="chat-panel hidden" id="chat-panel">
            <div class="chat-header">
                <span class="chat-title">Voice Chat</span>
                <button id="btn-collapse-chat" class="chat-collapse-btn" title="Hide chat panel">
                    <span class="midFont-keyboard_arrow_left"></span>
                </button>
            </div>
            <div class="chat-messages" id="chat-messages"></div>
        </aside>

        <div class="collapsed-title-bar" id="collapsed-title-bar">
            <div class="title-bar-buttons">
                <button class="title-bar-btn" id="btn-expand-sidebar" title="Show sidebar"><span class="icon">&#xe910;</span></button>
                <button class="title-bar-btn" id="btn-rename-titlebar" title="Rename"><span class="icon">&#xe91f;</span></button>
                <button class="title-bar-btn" id="btn-resize-titlebar" title="Fit to screen"><span class="icon">&#xe989;</span></button>
            </div>
            <div class="title-bar-titles">
                <span class="title-bar-custom" id="title-bar-custom"></span>
                <span class="title-bar-separator" id="title-bar-separator">â€”</span>
                <span class="title-bar-terminal" id="title-bar-terminal"></span>
            </div>
        </div>

        <div class="main-content">
            <header class="mobile-topbar" id="mobile-topbar">
                <button class="topbar-btn topbar-hamburger" id="btn-hamburger" title="Sessions"><span class="icon">&#xe919;</span></button>
                <div class="topbar-title" id="mobile-title">MidTerm</div>
                <div class="topbar-actions no-terminal" id="topbar-actions">
                    <button class="topbar-btn topbar-action topbar-ctrlc" id="btn-ctrlc-mobile" title="Send Ctrl+C"><span class="icon">&#xe9b5;</span></button>
                    <button class="topbar-btn topbar-action" id="btn-resize-mobile" title="Fit to screen"><span class="icon">&#xe989;</span></button>
                    <button class="topbar-btn topbar-action" id="btn-rename-mobile" title="Rename"><span class="icon">&#xe91f;</span></button>
                    <button class="topbar-btn topbar-action topbar-close" id="btn-close-mobile" title="Close terminal"><span class="icon">&#xe909;</span></button>
                    <button class="topbar-btn topbar-add" id="btn-new-session-mobile" title="New Terminal"><span class="icon">&#xea81;</span></button>
                </div>
            </header>

            <div class="terminals-area">
                <div id="terminal-search" class="terminal-search hidden">
                    <input type="text" id="search-input" placeholder="Search..." autocomplete="off" />
                    <span id="search-results" class="search-results">0/0</span>
                    <button id="search-prev" class="search-btn" title="Previous (Shift+Enter)"><span class="icon">&#xe913;</span></button>
                    <button id="search-next" class="search-btn" title="Next (Enter)"><span class="icon">&#xe910;</span></button>
                    <button id="search-close" class="search-btn" title="Close (Esc)"><span class="icon">&#xe909;</span></button>
                </div>
                <div id="empty-state" class="empty-state">
                    <img src="/img/logo.png" alt="" class="empty-state-logo" />
                    <p>No terminals open</p>
                    <button id="btn-create-terminal">Create Terminal</button>
                    <p class="empty-state-hint">Press <kbd>Alt</kbd>+<kbd>T</kbd> to create a new terminal</p>
                </div>
                <div id="settings-view" class="settings-view hidden">
                    <div class="settings-layout">
                        <!-- Left: Vertical Tab Bar -->
                        <nav class="settings-tabs" role="tablist">
                            <button class="settings-tab active" data-tab="general" role="tab" aria-selected="true">
                                <span class="icon">&#xea0c;</span>
                                <span class="tab-label">General</span>
                            </button>
                            <button class="settings-tab" data-tab="appearance" role="tab" aria-selected="false">
                                <span class="icon">&#xe90d;</span>
                                <span class="tab-label">Appearance</span>
                            </button>
                            <button class="settings-tab" data-tab="behavior" role="tab" aria-selected="false">
                                <span class="icon">&#xe993;</span>
                                <span class="tab-label">Behavior</span>
                            </button>
                            <button class="settings-tab" data-tab="security" role="tab" aria-selected="false">
                                <span class="icon">&#xe908;</span>
                                <span class="tab-label">Security</span>
                            </button>
                            <button class="settings-tab" data-tab="diagnostics" role="tab" aria-selected="false">
                                <span class="icon">&#xe9ce;</span>
                                <span class="tab-label">Diagnostics</span>
                            </button>
                        </nav>

                        <!-- Right: Content Area -->
                        <div class="settings-content" role="tabpanel">

                            <!-- General Panel -->
                            <section class="settings-panel" data-panel="general">
                                <h2>General</h2>

                                <!-- About & Updates -->
                                <div class="settings-section">
                                    <h3>About & Updates</h3>
                                    <div class="setting-row">
                                        <label>Server</label>
                                        <span class="version-value" id="version-server" title="mt.exe binary version">-</span>
                                    </div>
                                    <div class="setting-row">
                                        <label>Frontend</label>
                                        <span class="version-value" id="version-frontend" title="JavaScript build version">-</span>
                                    </div>
                                    <div class="setting-row">
                                        <label>Host</label>
                                        <span class="version-value" id="version-host" title="mthost.exe binary version">-</span>
                                    </div>
                                    <div class="setting-row">
                                        <label>Updates</label>
                                        <div class="update-actions-inline">
                                            <button id="btn-check-updates" class="btn-secondary">Check for Updates</button>
                                            <button id="btn-show-changelog" class="btn-secondary">Changelog</button>
                                            <button id="btn-view-update-log" class="btn-secondary">Update Log</button>
                                        </div>
                                    </div>
                                    <div id="update-status-none" class="update-status-none hidden">You are running the latest version</div>
                                    <div id="update-cards" class="update-cards"></div>
                                    <div id="update-result" class="update-result hidden"></div>
                                </div>

                                <!-- Server -->
                                <div class="settings-section">
                                    <h3>Server</h3>
                                    <p class="setting-hint">Server settings are configured via command line arguments:</p>
                                    <div class="setting-info">
                                        <code>--port 2000</code> - Port to listen on (default: 2000)
                                    </div>
                                    <div class="setting-info">
                                        <code>--bind 0.0.0.0</code> - Bind address (default: 0.0.0.0, use 127.0.0.1 for local only)
                                    </div>
                                </div>

                                <!-- System Status -->
                                <div class="settings-section system-status-section">
                                    <h3>System Status</h3>
                                    <div id="system-status-content">
                                        <div class="status-loading">Loading...</div>
                                    </div>
                                </div>

                                <!-- OSS Licenses -->
                                <div class="settings-section">
                                    <h3>Open Source Licenses</h3>
                                    <p class="setting-hint">MidTerm uses the following open source components:</p>
                                    <div class="license-item">
                                        <strong>xterm.js</strong> <span class="license-version">v6.0.0</span>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/xtermjs/xterm.js" target="_blank" rel="noopener">github.com/xtermjs/xterm.js</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>xterm-addon-fit</strong> <span class="license-version">v0.11.0</span>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/xtermjs/xterm.js" target="_blank" rel="noopener">github.com/xtermjs/xterm.js</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>xterm-addon-webgl</strong> <span class="license-version">v0.19.0</span>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/xtermjs/xterm.js" target="_blank" rel="noopener">github.com/xtermjs/xterm.js</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>xterm-addon-search</strong> <span class="license-version">v0.16.0</span>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/xtermjs/xterm.js" target="_blank" rel="noopener">github.com/xtermjs/xterm.js</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>xterm-addon-web-links</strong> <span class="license-version">v0.12.0</span>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/xtermjs/xterm.js" target="_blank" rel="noopener">github.com/xtermjs/xterm.js</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>xterm-link-provider</strong> <span class="license-version">v1.3.1</span>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/LabhanshAgrawal/xterm-link-provider" target="_blank" rel="noopener">github.com/LabhanshAgrawal/xterm-link-provider</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>nanostores</strong> <span class="license-version">v1.1.0</span>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/nanostores/nanostores" target="_blank" rel="noopener">github.com/nanostores/nanostores</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>CsWin32</strong> <span class="license-version">v0.3.106</span>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/microsoft/CsWin32" target="_blank" rel="noopener">github.com/microsoft/CsWin32</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>ASP.NET Core</strong>
                                        <span class="license-type">MIT License</span>
                                        <a href="https://github.com/dotnet/aspnetcore" target="_blank" rel="noopener">github.com/dotnet/aspnetcore</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>JetBrains Mono</strong>
                                        <span class="license-type">SIL Open Font License 1.1</span>
                                        <a href="https://github.com/JetBrains/JetBrainsMono" target="_blank" rel="noopener">github.com/JetBrains/JetBrainsMono</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>Cascadia Code</strong>
                                        <span class="license-type">SIL Open Font License 1.1</span>
                                        <a href="https://github.com/microsoft/cascadia-code" target="_blank" rel="noopener">github.com/microsoft/cascadia-code</a>
                                    </div>
                                    <div class="license-item">
                                        <strong>Terminus Font</strong>
                                        <span class="license-type">SIL Open Font License 1.1</span>
                                        <a href="https://terminus-font.sourceforge.net/" target="_blank" rel="noopener">terminus-font.sourceforge.net</a>
                                    </div>
                                </div>
                            </section>

                            <!-- Appearance Panel -->
                            <section class="settings-panel hidden" data-panel="appearance">
                                <h2>Appearance</h2>

                                <div class="settings-section">
                                    <h3>Terminal Appearance</h3>
                                    <div class="setting-row">
                                        <label for="setting-font-size">Font Size</label>
                                        <div class="text-input-wrapper" data-setting="fontSize" data-type="number">
                                            <input type="number" id="setting-font-size" min="8" max="24" value="14" />
                                            <button class="inline-save-btn" title="Save"><span class="icon">&#xe90f;</span></button>
                                        </div>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-font-family">Font</label>
                                        <select id="setting-font-family">
                                            <option value="Cascadia Code">Cascadia Code</option>
                                            <option value="JetBrains Mono">JetBrains Mono</option>
                                            <option value="Terminus">Terminus</option>
                                        </select>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-cursor-style">Cursor Style</label>
                                        <select id="setting-cursor-style">
                                            <option value="bar">Bar</option>
                                            <option value="block">Block</option>
                                            <option value="underline">Underline</option>
                                        </select>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-cursor-blink">Cursor Blink</label>
                                        <input type="checkbox" id="setting-cursor-blink" checked />
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-cursor-inactive">Cursor (Unfocused)</label>
                                        <select id="setting-cursor-inactive">
                                            <option value="outline">Outline</option>
                                            <option value="block">Block</option>
                                            <option value="bar">Bar</option>
                                            <option value="underline">Underline</option>
                                            <option value="none">Hidden</option>
                                        </select>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-theme">Theme</label>
                                        <select id="setting-theme">
                                            <option value="dark">Dark</option>
                                            <option value="light">Light</option>
                                            <option value="solarizedDark">Solarized Dark</option>
                                            <option value="solarizedLight">Solarized Light</option>
                                        </select>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-tab-title">Browser Tab Title</label>
                                        <select id="setting-tab-title">
                                            <option value="hostname">Hostname</option>
                                            <option value="static">Just MidTerm</option>
                                            <option value="sessionName">Session Name</option>
                                            <option value="terminalTitle">Terminal Title</option>
                                            <option value="foregroundProcess">Foreground Process</option>
                                        </select>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-contrast">Minimum Contrast</label>
                                        <select id="setting-contrast">
                                            <option value="1">Off</option>
                                            <option value="4.5">WCAG AA (4.5:1)</option>
                                            <option value="7">WCAG AAA (7:1)</option>
                                            <option value="21">Maximum (21:1)</option>
                                        </select>
                                    </div>
                                </div>
                            </section>

                            <!-- Behavior Panel -->
                            <section class="settings-panel hidden" data-panel="behavior">
                                <h2>Behavior</h2>

                                <!-- Session Defaults -->
                                <div class="settings-section">
                                    <h3>Session Defaults</h3>
                                    <div class="setting-row">
                                        <label for="setting-default-shell">Default Shell</label>
                                        <select id="setting-default-shell">
                                            <option value="Pwsh">PowerShell 7</option>
                                            <option value="PowerShell">Windows PowerShell</option>
                                            <option value="Cmd">Command Prompt</option>
                                        </select>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-working-dir">Default Working Directory</label>
                                        <div class="text-input-wrapper" data-setting="defaultWorkingDirectory">
                                            <input type="text" id="setting-working-dir" placeholder="Leave empty for home directory" />
                                            <button class="inline-save-btn" title="Save"><span class="icon">&#xe90f;</span></button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Terminal Behavior -->
                                <div class="settings-section">
                                    <h3>Terminal Behavior</h3>
                                    <div class="setting-row">
                                        <label for="setting-scrollback">Scrollback Lines</label>
                                        <div class="text-input-wrapper" data-setting="scrollbackLines" data-type="number">
                                            <input type="number" id="setting-scrollback" min="500" max="100000" step="500" value="10000" />
                                            <button class="inline-save-btn" title="Save"><span class="icon">&#xe90f;</span></button>
                                        </div>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-bell-style">Bell Style</label>
                                        <select id="setting-bell-style">
                                            <option value="notification">Desktop Notification</option>
                                            <option value="sound">Sound</option>
                                            <option value="visual">Visual Flash</option>
                                            <option value="off">Off</option>
                                        </select>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-copy-on-select">Copy on Select</label>
                                        <input type="checkbox" id="setting-copy-on-select" />
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-right-click-paste">Right-Click Paste</label>
                                        <input type="checkbox" id="setting-right-click-paste" checked />
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-clipboard-shortcuts">Copy/Paste Shortcuts</label>
                                        <select id="setting-clipboard-shortcuts">
                                            <option value="auto">Auto (detect platform)</option>
                                            <option value="windows">Windows (Ctrl+C/V)</option>
                                            <option value="unix">Unix (Ctrl+Shift+C/V)</option>
                                        </select>
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-smooth-scrolling">Smooth Scrolling</label>
                                        <input type="checkbox" id="setting-smooth-scrolling" />
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-webgl">GPU Rendering (WebGL)</label>
                                        <input type="checkbox" id="setting-webgl" />
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-scrollback-protection">Claude Code scrollback glitch protection</label>
                                        <input type="checkbox" id="setting-scrollback-protection" />
                                    </div>
                                    <div class="setting-row">
                                        <label for="setting-file-radar" title="Detects file paths in terminal output and makes them clickable. Click to view files remotely.">File Radar</label>
                                        <input type="checkbox" id="setting-file-radar" />
                                    </div>
                                </div>
                            </section>

                            <!-- Security Panel -->
                            <section class="settings-panel hidden" data-panel="security" id="security-section">
                                <h2>Security</h2>

                                <div class="settings-section">
                                    <h3>Authentication</h3>
                                    <div class="setting-row">
                                        <label>Password</label>
                                        <div class="password-status">
                                            <span id="password-status-text" class="status-missing">Checking...</span>
                                        </div>
                                    </div>
                                    <div class="setting-row">
                                        <label>Change Password</label>
                                        <button id="btn-change-password" class="btn-secondary">Change...</button>
                                    </div>
                                    <div class="setting-row">
                                        <label>Session</label>
                                        <button id="btn-logout" class="btn-secondary">Logout</button>
                                    </div>
                                </div>

                                <div class="settings-section">
                                    <h3>Process Identity</h3>
                                    <div class="setting-row">
                                        <label for="setting-run-as-user">Terminal User</label>
                                        <select id="setting-run-as-user">
                                            <option value="">Process Owner (default)</option>
                                        </select>
                                    </div>
                                    <p class="setting-hint">When running as a system service, terminals spawn as this user instead of the service account.</p>
                                </div>

                                <div class="settings-section">
                                    <h3>HTTPS Certificate</h3>
                                    <div class="setting-row">
                                        <label>Fingerprint</label>
                                        <code class="cert-fingerprint-inline" id="settings-cert-fingerprint">Loading...</code>
                                    </div>
                                    <div class="setting-row">
                                        <label>Valid Until</label>
                                        <span id="settings-cert-validity">-</span>
                                    </div>
                                    <div class="setting-row">
                                        <label>Trust on Other Devices</label>
                                        <a href="/trust" target="_blank" class="btn-secondary">Open Trust Page</a>
                                    </div>
                                    <p class="setting-hint">
                                        <strong>Fingerprint verification:</strong> When connecting from a new device,
                                        click the padlock icon in your browser and compare the SHA-256 fingerprint with
                                        this one. Matching fingerprints confirm you're connecting to the real server.
                                    </p>
                                </div>
                            </section>

                            <!-- Diagnostics Panel -->
                            <section class="settings-panel hidden" data-panel="diagnostics">
                                <h2>Diagnostics</h2>

                                <!-- Paths -->
                                <div class="settings-section">
                                    <h3>File Paths</h3>
                                    <div class="setting-row">
                                        <label>Settings</label>
                                        <div class="path-value-row">
                                            <code class="path-value" id="path-settings">-</code>
                                            <button id="btn-reload-settings" class="btn-icon" title="Reload settings from file">
                                                <span class="icon">&#xe9bd;</span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="setting-row">
                                        <label>Secrets</label>
                                        <code class="path-value" id="path-secrets">-</code>
                                    </div>
                                    <div class="setting-row">
                                        <label>Certificate</label>
                                        <code class="path-value" id="path-certificate">-</code>
                                    </div>
                                    <div class="setting-row">
                                        <label>Log Directory</label>
                                        <code class="path-value" id="path-logs">-</code>
                                    </div>
                                </div>

                                <!-- Capture Settings -->
                                <div class="settings-section diag-capture-section">
                                    <h3>Server Capture Level</h3>
                                    <div class="diag-capture-row">
                                        <select id="setting-log-level">
                                            <option value="exception">Exception only</option>
                                            <option value="error">Error+</option>
                                            <option value="warn">Warn+ (default)</option>
                                            <option value="info">Info+</option>
                                            <option value="verbose">Verbose (all)</option>
                                        </select>
                                        <span class="diag-capture-hint">Changes apply immediately to server logging</span>
                                    </div>
                                </div>

                                <!-- Log Viewer -->
                                <div class="settings-section diag-viewer-section">
                                    <div class="diag-viewer-header">
                                        <h3>Log Viewer</h3>
                                        <div class="diag-source-tabs">
                                            <button class="diag-tab active" data-tab="server">Server</button>
                                            <button class="diag-tab" data-tab="sessions">Sessions</button>
                                        </div>
                                    </div>

                                    <div class="diag-filter-bar">
                                        <label class="diag-filter-label">
                                            Show:
                                            <select id="diag-level-filter">
                                                <option value="4">All levels</option>
                                                <option value="3">Info+</option>
                                                <option value="2" selected>Warn+</option>
                                                <option value="1">Error+</option>
                                                <option value="0">Exception</option>
                                            </select>
                                        </label>
                                        <input type="text" id="diag-search" placeholder="Search..." />
                                        <div class="diag-filter-actions">
                                            <label class="diag-live-tail-label" title="Auto-scroll to new entries">
                                                <input type="checkbox" id="diag-live-tail" checked />
                                                Live
                                            </label>
                                            <button id="diag-copy-all" class="btn-icon" title="Copy all visible logs">
                                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>

                                    <div id="diag-session-select" class="diag-session-select hidden">
                                        <select id="diag-session-picker">
                                            <option value="">Select session...</option>
                                        </select>
                                    </div>

                                    <div id="diag-log-viewer" class="diag-log-viewer">
                                        <div class="diag-log-content" id="diag-log-content"></div>
                                    </div>

                                    <div class="diag-status-bar">
                                        <span id="diag-entry-count">0 entries</span>
                                        <span id="diag-connection-status"></span>
                                    </div>
                                </div>
                            </section>

                        </div>
                    </div>
                </div>
            </div>

            <!-- File Viewer Dock Panel -->
            <aside id="file-viewer-dock" class="file-viewer-dock hidden">
                <div class="file-viewer-dock-header">
                    <span class="file-viewer-dock-title"></span>
                    <span class="file-viewer-dock-path"></span>
                    <div class="file-viewer-dock-actions">
                        <button class="btn-icon" id="dock-download" title="Download">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 12l-4-4h2.5V3h3v5H12L8 12z"/>
                                <path d="M2 13h12v1H2v-1z"/>
                            </svg>
                        </button>
                        <button class="btn-icon" id="dock-refresh" title="Refresh">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M13.5 8c0 3-2.5 5.5-5.5 5.5S2.5 11 2.5 8 5 2.5 8 2.5c1.5 0 2.9.6 3.9 1.6L10 6h5V1l-1.9 1.9C11.6 1.5 9.9.8 8 .8 3.8.8.8 3.8.8 8s3 7.2 7.2 7.2 7.2-3.2 7.2-7.2h-1.7z"/>
                            </svg>
                        </button>
                        <button class="btn-icon" id="dock-undock" title="Pop out to modal">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M2 3h8v2H4v8h8V9h2v6H2V3zm8-1h5v5h-1V4l-5 5-1-1 5-5h-3V1z"/>
                            </svg>
                        </button>
                        <button class="btn-icon" id="dock-close" title="Close">&times;</button>
                    </div>
                </div>
                <div class="file-viewer-dock-body"></div>
            </aside>
        </div>
    </div>

    <div id="paste-indicator" class="status-badge paste-indicator"></div>
    <div id="connection-status" class="status-badge connection-status"></div>
    <div id="data-loss-warning" class="status-badge data-loss-warning"></div>

    <!-- Changelog Modal -->
    <div id="changelog-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content changelog-modal-content">
            <div class="modal-header">
                <h3>Changelog</h3>
                <button id="btn-close-changelog" class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="changelog-body">
                <div class="changelog-loading">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Password Change Modal -->
    <div id="password-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content password-modal-content">
            <div class="modal-header">
                <h3 id="password-modal-title">Change Password</h3>
                <button id="btn-close-password" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="password-form">
                    <input type="text" name="username" autocomplete="username" tabindex="-1" style="position:absolute;left:-9999px;opacity:0" aria-hidden="true" />
                    <div class="form-group" id="current-password-group">
                        <label for="current-password">Current Password</label>
                        <input type="password" id="current-password" autocomplete="current-password" />
                    </div>
                    <div class="form-group">
                        <label for="new-password">New Password</label>
                        <input type="password" id="new-password" required autocomplete="new-password" />
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password</label>
                        <input type="password" id="confirm-password" required autocomplete="new-password" />
                    </div>
                    <div id="password-error" class="error-message hidden"></div>
                    <div class="modal-footer">
                        <button type="button" id="btn-cancel-password" class="btn-secondary">Cancel</button>
                        <button type="submit" id="btn-save-password" class="btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- File Viewer Modal -->
    <div id="file-viewer-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content file-viewer-modal-content">
            <div class="modal-header">
                <div class="file-viewer-header-info">
                    <h3 class="file-viewer-title">File</h3>
                    <span class="file-viewer-path"></span>
                </div>
                <div class="file-viewer-header-actions">
                    <button id="file-viewer-dock-btn" class="btn-icon" title="Dock to right">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1 2h14v12H1V2zm1 1v10h8V3H2zm9 0v10h3V3h-3z"/>
                        </svg>
                    </button>
                    <button id="file-viewer-maximize" class="btn-icon" title="Fullscreen">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M2 2h5v1H3v4H2V2zm7 0h5v5h-1V3H9V2zM3 9v4h4v1H2V9h1zm10 0v5H9v-1h4V9h1z"/>
                        </svg>
                    </button>
                    <button id="file-viewer-download" class="btn-icon" title="Download">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 12l-4-4h2.5V3h3v5H12L8 12z"/>
                            <path d="M2 13h12v1H2v-1z"/>
                        </svg>
                    </button>
                    <button class="modal-close">&times;</button>
                </div>
            </div>
            <div class="modal-body file-viewer-body">
                <div class="file-viewer-loading">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Touch Controller Bar (mobile only) -->
    <div id="touch-controller" class="touch-controller" aria-label="Terminal touch controls">
        <!-- Favorites row (dynamically rendered) -->
        <div id="touch-favorites" class="touch-favorites"></div>

        <!-- Main bar -->
        <div class="touch-bar-main">
            <div class="touch-group touch-modifiers">
                <button class="touch-key touch-modifier" data-modifier="ctrl" aria-pressed="false">Ctrl</button>
                <button class="touch-key touch-modifier" data-modifier="alt" aria-pressed="false">Alt</button>
                <button class="touch-key touch-modifier" data-modifier="shift" aria-pressed="false">Shft</button>
            </div>
            <div class="touch-group touch-arrows">
                <button class="touch-key" data-key="up" aria-label="Arrow up">&#9650;</button>
                <button class="touch-key" data-key="left" aria-label="Arrow left">&#9664;</button>
                <button class="touch-key" data-key="down" aria-label="Arrow down">&#9660;</button>
                <button class="touch-key" data-key="right" aria-label="Arrow right">&#9654;</button>
            </div>
            <div class="touch-group touch-categories">
                <button class="touch-key touch-cat" data-popup="fn" aria-haspopup="true" aria-expanded="false">Fn</button>
                <button class="touch-key touch-cat" data-popup="sym" aria-haspopup="true" aria-expanded="false">Sym</button>
                <button class="touch-key touch-cat" data-popup="ctrl" aria-haspopup="true" aria-expanded="false">^+</button>
                <button class="touch-key touch-expand" data-action="expand" aria-expanded="false" aria-controls="touch-panel">
                    <span class="expand-icon">&#8943;</span>
                </button>
            </div>
        </div>

        <!-- Compact panel (Nav/Edit keys only) -->
        <div id="touch-panel" class="touch-panel" aria-hidden="true">
            <div class="touch-panel-row">
                <button class="touch-key" data-key="tab">Tab</button>
                <button class="touch-key" data-key="esc">Esc</button>
                <button class="touch-key" data-key="enter">&#8629;</button>
                <button class="touch-key" data-key="backspace">&#9003;</button>
            </div>
            <div class="touch-panel-row">
                <button class="touch-key" data-key="home">Home</button>
                <button class="touch-key" data-key="end">End</button>
                <button class="touch-key" data-key="pgup">PgUp</button>
                <button class="touch-key" data-key="pgdn">PgDn</button>
            </div>
        </div>
    </div>

    <!-- Touch Popups (positioned absolutely, rendered by JS) -->
    <div id="touch-popup-fn" class="touch-popup" hidden></div>
    <div id="touch-popup-sym" class="touch-popup" hidden></div>
    <div id="touch-popup-ctrl" class="touch-popup" hidden></div>

    <script src="js/webAudioAccess.js"></script>
    <script src="js/terminal.min.js"></script>
</body>
</html>
