<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Trust Certificate - MidTerm</title>

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png" />
    <meta name="theme-color" content="#0D0E14" />

    <link rel="stylesheet" href="css/app.css" />
</head>
<body class="trust-page">
    <div class="trust-container">
        <div class="trust-header">
            <h1>Trust This Server</h1>
            <p>MidTerm Terminal Multiplexer</p>
        </div>

        <!-- Fingerprint verification (prominent) -->
        <section class="trust-section fingerprint-section">
            <h2>Step 1: Verify Fingerprint</h2>
            <div class="fingerprint-box">
                <div class="fingerprint-display" id="fingerprint">Loading...</div>
                <button type="button" class="copy-btn" id="copy-fingerprint" title="Copy to clipboard">Copy</button>
            </div>
            <div class="trust-hint">
                <strong>Security check:</strong> Compare this fingerprint with the one shown during installation
                or on your original trusted device. If they match, this connection is authentic.
            </div>
        </section>

        <!-- Platform-specific instructions -->
        <section class="trust-section platform-section">
            <h2>Step 2: Install Certificate</h2>
            <p class="platform-detected">Detected: <span id="detected-platform">Unknown</span></p>

            <!-- Mobile section -->
            <div class="platform-group">
                <h3 class="platform-group-title">Mobile</h3>

                <!-- iOS panel -->
                <div id="ios-panel" class="platform-panel">
                    <h4>iOS / iPadOS <span id="ios-detected" class="detected-badge hidden">(Detected)</span></h4>
                    <button type="button" class="install-btn" id="btn-install-ios">
                        Install Profile
                    </button>
                    <ol class="install-steps">
                        <li>Tap "Install Profile" above</li>
                        <li>Open <strong>Settings</strong> app</li>
                        <li>Tap <strong>Profile Downloaded</strong> (near the top)</li>
                        <li>Tap <strong>Install</strong>, enter passcode if prompted</li>
                        <li>Go to <strong>Settings &rarr; General &rarr; About &rarr; Certificate Trust Settings</strong></li>
                        <li>Enable full trust for <strong>MidTerm Certificate</strong></li>
                    </ol>
                </div>

                <!-- Android panel -->
                <div id="android-panel" class="platform-panel">
                    <h4>Android <span id="android-detected" class="detected-badge hidden">(Detected)</span></h4>
                    <button type="button" class="install-btn" id="btn-install-android">
                        Download Certificate
                    </button>
                    <ol class="install-steps">
                        <li>Tap "Download Certificate" above</li>
                        <li>Open <strong>Settings &rarr; Security &rarr; Encryption & credentials</strong></li>
                        <li>Tap <strong>Install a certificate &rarr; CA certificate</strong></li>
                        <li>Select the downloaded <code>midterm.pem</code> file</li>
                        <li>Verify the fingerprint shown matches the one above</li>
                    </ol>
                    <p class="install-note">Note: Menu names vary by Android version and manufacturer.</p>
                </div>
            </div>

            <!-- Desktop section -->
            <div class="platform-group">
                <h3 class="platform-group-title">Desktop <span id="desktop-detected" class="detected-badge hidden">(Detected)</span></h3>
                <div id="desktop-panel" class="platform-panel">
                    <div class="os-tabs">
                        <button type="button" class="os-tab active" data-os="windows">Windows</button>
                        <button type="button" class="os-tab" data-os="macos">macOS</button>
                        <button type="button" class="os-tab" data-os="linux">Linux</button>
                    </div>

                    <div class="os-instructions" id="windows-instructions">
                        <button type="button" class="install-btn" id="btn-download-pem-desktop">
                            Download Certificate
                        </button>
                        <p>Then run as Administrator in the download folder:</p>
                        <code class="command-block">certutil -addstore Root midterm.pem</code>
                    </div>

                    <div class="os-instructions hidden" id="macos-instructions">
                        <button type="button" class="install-btn" id="btn-download-pem-macos">
                            Download Certificate
                        </button>
                        <p>Then run in Terminal from the download folder:</p>
                        <code class="command-block">sudo security add-trusted-cert -d -r trustRoot \
    -k /Library/Keychains/System.keychain midterm.pem</code>
                    </div>

                    <div class="os-instructions hidden" id="linux-instructions">
                        <button type="button" class="install-btn" id="btn-download-pem-linux">
                            Download Certificate
                        </button>
                        <p>Then run in Terminal from the download folder:</p>
                        <code class="command-block">sudo cp midterm.pem /usr/local/share/ca-certificates/midterm.crt
sudo update-ca-certificates</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Browser verification education -->
        <section class="trust-section education-section">
            <h2>Verify in Your Browser</h2>
            <p>After installing, verify the connection is secure:</p>
            <ol class="install-steps">
                <li>Click the <strong>padlock icon</strong> in your browser's address bar</li>
                <li>Click <strong>Certificate</strong> or <strong>Connection is secure</strong></li>
                <li>Find the <strong>SHA-256 fingerprint</strong></li>
                <li>Compare it with the fingerprint shown above</li>
            </ol>
            <div class="warning-box">
                <strong>Security Warning:</strong> Never enter passwords or sensitive information
                until you have verified the fingerprint matches. If your browser shows a certificate
                warning after previously working, re-verify the fingerprint before proceeding.
            </div>
        </section>

        <!-- Connection info -->
        <section class="trust-section endpoints-section">
            <h2>Trusted Addresses in Certificate</h2>
            <div id="endpoints-list" class="endpoints-list">
                <p>Loading...</p>
            </div>
            <div class="cert-validity">
                <span id="cert-valid-until"></span>
            </div>
        </section>

        <div class="trust-footer">
            <a href="/" class="back-link">&larr; Back to MidTerm</a>
        </div>
    </div>

    <script src="js/terminal.min.js"></script>
</body>
</html>
