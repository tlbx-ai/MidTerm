{
  "version": 3,
  "sources": ["../../src/ts/constants.ts", "../../src/ts/state.ts", "../../src/ts/utils/dom.ts", "../../src/ts/utils/cookies.ts", "../../src/ts/utils/protocol.ts", "../../src/ts/utils/reconnect.ts", "../../src/ts/utils/index.ts", "../../src/ts/modules/settings/persistence.ts", "../../src/ts/modules/settings/panel.ts", "../../src/ts/modules/settings/index.ts", "../../src/ts/modules/theming/themes.ts", "../../src/ts/modules/comms/stateChannel.ts", "../../src/ts/modules/comms/muxChannel.ts", "../../src/ts/modules/terminal/manager.ts", "../../src/ts/modules/terminal/scaling.ts", "../../src/ts/modules/terminal/fileDrop.ts", "../../src/ts/modules/terminal/search.ts", "../../src/ts/modules/sidebar/sessionList.ts", "../../src/ts/modules/sidebar/collapse.ts", "../../src/ts/main.ts", "../../src/ts/modules/auth/status.ts", "../../src/ts/modules/auth/password.ts", "../../src/ts/modules/updating/checker.ts", "../../src/ts/modules/updating/changelog.ts"],
  "sourcesContent": ["/**\r\n * Constants\r\n *\r\n * Protocol constants, theme definitions, and configuration values.\r\n */\r\n\r\nimport type { TerminalTheme, ThemeName } from './types';\r\n\r\n// =============================================================================\r\n// Build Version (injected at compile time via esbuild --define)\r\n// =============================================================================\r\n\r\n/** Version injected at build time - DO NOT MODIFY, replaced by esbuild */\r\ndeclare const BUILD_VERSION: string;\r\n\r\n/** The version this JavaScript was compiled for */\r\nexport const JS_BUILD_VERSION: string = typeof BUILD_VERSION !== 'undefined' ? BUILD_VERSION : 'dev';\r\n\r\n// =============================================================================\r\n// Mux Protocol Constants\r\n// =============================================================================\r\n\r\n/** Mux protocol header size (1 byte type + 8 byte session ID) */\r\nexport const MUX_HEADER_SIZE = 9;\r\n\r\n/** Mux protocol message types */\r\nexport const MUX_TYPE_OUTPUT = 0x01;  // Server -> Client: Terminal output (includes dimensions)\r\nexport const MUX_TYPE_INPUT = 0x02;   // Client -> Server: Terminal input\r\nexport const MUX_TYPE_RESIZE = 0x03;  // Client -> Server: Terminal resize\r\nexport const MUX_TYPE_RESYNC = 0x05;  // Server -> Client: Clear terminals, buffer refresh follows\r\nexport const MUX_TYPE_BUFFER_REQUEST = 0x06; // Client -> Server: Request buffer refresh\r\nexport const MUX_TYPE_COMPRESSED_OUTPUT = 0x07; // Server -> Client: GZip compressed output\r\n\r\n// =============================================================================\r\n// Terminal Themes\r\n// =============================================================================\r\n\r\n/** Terminal color themes */\r\nexport const THEMES: Record<ThemeName, TerminalTheme> = {\r\n  dark: {\r\n    background: '#06060E',\r\n    foreground: '#DCDCF5',\r\n    cursor: '#DCDCF5',\r\n    cursorAccent: '#06060E',\r\n    selectionBackground: '#283457'\r\n  },\r\n  light: {\r\n    background: '#D5D6DB',\r\n    foreground: '#343B58',\r\n    cursor: '#343B58',\r\n    cursorAccent: '#D5D6DB',\r\n    selectionBackground: '#9FA0A5'\r\n  },\r\n  solarizedDark: {\r\n    background: '#002B36',\r\n    foreground: '#839496',\r\n    cursor: '#839496',\r\n    cursorAccent: '#002B36',\r\n    selectionBackground: '#073642'\r\n  },\r\n  solarizedLight: {\r\n    background: '#FDF6E3',\r\n    foreground: '#657B83',\r\n    cursor: '#657B83',\r\n    cursorAccent: '#FDF6E3',\r\n    selectionBackground: '#EEE8D5'\r\n  }\r\n};\r\n\r\n// =============================================================================\r\n// Default Settings\r\n// =============================================================================\r\n\r\n/** Default terminal settings */\r\nexport const DEFAULT_SETTINGS = {\r\n  fontSize: 14,\r\n  scrollbackLines: 10000,\r\n  cursorStyle: 'bar' as const,\r\n  cursorBlink: true,\r\n  theme: 'dark' as ThemeName,\r\n  bellStyle: 'notification' as const,\r\n  copyOnSelect: false,\r\n  rightClickPaste: true,\r\n  clipboardShortcuts: 'auto' as const\r\n};\r\n\r\n// =============================================================================\r\n// WebSocket Configuration\r\n// =============================================================================\r\n\r\n/** Initial reconnect delay in milliseconds */\r\nexport const INITIAL_RECONNECT_DELAY = 1000;\r\n\r\n/** Maximum reconnect delay in milliseconds */\r\nexport const MAX_RECONNECT_DELAY = 30000;\r\n\r\n// =============================================================================\r\n// Terminal Rendering Constants\r\n// =============================================================================\r\n\r\n/** Terminal font stack for monospace rendering */\r\nexport const TERMINAL_FONT_STACK = \"'Cascadia Code', 'Cascadia Mono', Consolas, 'Courier New', monospace\";\r\n\r\n/** Character width as ratio of font size (empirical for monospace fonts) */\r\nexport const FONT_CHAR_WIDTH_RATIO = 0.6;\r\n\r\n/** Line height as ratio of font size */\r\nexport const FONT_LINE_HEIGHT_RATIO = 1.2;\r\n\r\n/** Padding around terminal content in pixels */\r\nexport const TERMINAL_PADDING = 8;\r\n\r\n/** Minimum terminal columns */\r\nexport const MIN_TERMINAL_COLS = 10;\r\n\r\n/** Minimum terminal rows */\r\nexport const MIN_TERMINAL_ROWS = 5;\r\n\r\n/** Maximum terminal columns */\r\nexport const MAX_TERMINAL_COLS = 300;\r\n\r\n/** Maximum terminal rows */\r\nexport const MAX_TERMINAL_ROWS = 100;\r\n\r\n/** Maximum frame dimension for validation */\r\nexport const MAX_FRAME_DIMENSION = 500;\r\n\r\n/** Mobile breakpoint in pixels */\r\nexport const MOBILE_BREAKPOINT = 768;\r\n", "/**\r\n * Application State\r\n *\r\n * Centralized state management for the application.\r\n * Replaces the global variables from the original JavaScript.\r\n */\r\n\r\nimport type {\r\n  Session,\r\n  TerminalState,\r\n  Settings,\r\n  UpdateInfo,\r\n  AuthStatus,\r\n  DOMElements\r\n} from './types';\r\n\r\n// =============================================================================\r\n// State Store\r\n// =============================================================================\r\n\r\n/** Sessions from server */\r\nexport let sessions: Session[] = [];\r\n\r\n/** Currently active session ID */\r\nexport let activeSessionId: string | null = null;\r\n\r\n/** User settings from server */\r\nexport let currentSettings: Settings | null = null;\r\n\r\n/** Update info from server */\r\nexport let updateInfo: UpdateInfo | null = null;\r\n\r\n/** Auth status from server */\r\nexport let authStatus: AuthStatus | null = null;\r\n\r\n// =============================================================================\r\n// UI State\r\n// =============================================================================\r\n\r\n/** Settings panel visibility */\r\nexport let settingsOpen = false;\r\n\r\n/** Mobile sidebar visibility */\r\nexport let sidebarOpen = false;\r\n\r\n/** Desktop sidebar collapsed state */\r\nexport let sidebarCollapsed = false;\r\n\r\n// =============================================================================\r\n// WebSocket State\r\n// =============================================================================\r\n\r\n/** State WebSocket connection */\r\nexport let stateWs: WebSocket | null = null;\r\n\r\n/** State WebSocket reconnect timer */\r\nexport let stateReconnectTimer: number | undefined;\r\n\r\n/** State WebSocket reconnect delay */\r\nexport let stateReconnectDelay = 1000;\r\n\r\n/** State WebSocket connected flag */\r\nexport let stateWsConnected = false;\r\n\r\n/** Mux WebSocket connection */\r\nexport let muxWs: WebSocket | null = null;\r\n\r\n/** Mux WebSocket reconnect timer */\r\nexport let muxReconnectTimer: number | undefined;\r\n\r\n/** Mux WebSocket reconnect delay */\r\nexport let muxReconnectDelay = 1000;\r\n\r\n/** Mux WebSocket connected flag */\r\nexport let muxWsConnected = false;\r\n\r\n/** Tracks if mux WebSocket has ever connected (for reconnect detection) */\r\nexport let muxHasConnected = false;\r\n\r\n// =============================================================================\r\n// Terminal State\r\n// =============================================================================\r\n\r\n/** Windows build number for ConPTY configuration (null on non-Windows) */\r\nexport let windowsBuildNumber: number | null = null;\r\n\r\n/** Per-session terminal state */\r\nexport const sessionTerminals = new Map<string, TerminalState>();\r\n\r\n/** Sessions created in this browser session (use WebSocket buffering) */\r\nexport const newlyCreatedSessions = new Set<string>();\r\n\r\n/** Pending sessions being created (for optimistic UI) */\r\nexport const pendingSessions = new Set<string>();\r\n\r\n/** Buffer WebSocket output frames for terminals not yet opened */\r\nexport const pendingOutputFrames = new Map<string, Uint8Array[]>();\r\n\r\n/** Font loading promise */\r\nexport let fontsReadyPromise: Promise<void> | null = null;\r\n\r\n// =============================================================================\r\n// DOM Element Cache\r\n// =============================================================================\r\n\r\n/** Cached DOM elements */\r\nexport const dom: DOMElements = {\r\n  sessionList: null,\r\n  sessionCount: null,\r\n  terminalsArea: null,\r\n  emptyState: null,\r\n  mobileTitle: null,\r\n  topbarActions: null,\r\n  app: null,\r\n  sidebarOverlay: null,\r\n  settingsView: null,\r\n  settingsBtn: null,\r\n  titleBarCustom: null,\r\n  titleBarTerminal: null,\r\n  titleBarSeparator: null\r\n};\r\n\r\n// =============================================================================\r\n// State Setters\r\n// =============================================================================\r\n\r\nexport function setSessions(newSessions: Session[]): void {\r\n  sessions = newSessions;\r\n}\r\n\r\nexport function setActiveSessionId(id: string | null): void {\r\n  activeSessionId = id;\r\n}\r\n\r\nexport function setCurrentSettings(settings: Settings | null): void {\r\n  currentSettings = settings;\r\n}\r\n\r\nexport function setUpdateInfo(info: UpdateInfo | null): void {\r\n  updateInfo = info;\r\n}\r\n\r\nexport function setAuthStatus(status: AuthStatus | null): void {\r\n  authStatus = status;\r\n}\r\n\r\nexport function setSettingsOpen(open: boolean): void {\r\n  settingsOpen = open;\r\n}\r\n\r\nexport function setSidebarOpen(open: boolean): void {\r\n  sidebarOpen = open;\r\n}\r\n\r\nexport function setSidebarCollapsed(collapsed: boolean): void {\r\n  sidebarCollapsed = collapsed;\r\n}\r\n\r\nexport function setStateWs(ws: WebSocket | null): void {\r\n  stateWs = ws;\r\n}\r\n\r\nexport function setStateReconnectTimer(timer: number | undefined): void {\r\n  stateReconnectTimer = timer;\r\n}\r\n\r\nexport function setStateReconnectDelay(delay: number): void {\r\n  stateReconnectDelay = delay;\r\n}\r\n\r\nexport function setStateWsConnected(connected: boolean): void {\r\n  stateWsConnected = connected;\r\n}\r\n\r\nexport function setMuxWs(ws: WebSocket | null): void {\r\n  muxWs = ws;\r\n}\r\n\r\nexport function setMuxReconnectTimer(timer: number | undefined): void {\r\n  muxReconnectTimer = timer;\r\n}\r\n\r\nexport function setMuxReconnectDelay(delay: number): void {\r\n  muxReconnectDelay = delay;\r\n}\r\n\r\nexport function setMuxWsConnected(connected: boolean): void {\r\n  muxWsConnected = connected;\r\n}\r\n\r\nexport function setMuxHasConnected(connected: boolean): void {\r\n  muxHasConnected = connected;\r\n}\r\n\r\nexport function setFontsReadyPromise(promise: Promise<void>): void {\r\n  fontsReadyPromise = promise;\r\n}\r\n\r\nexport function setWindowsBuildNumber(build: number | null): void {\r\n  windowsBuildNumber = build;\r\n}\r\n\r\n// =============================================================================\r\n// DOM Element Cache Initialization\r\n// =============================================================================\r\n\r\n/**\r\n * Cache DOM elements for quick access\r\n */\r\nexport function cacheDOMElements(): void {\r\n  dom.sessionList = document.getElementById('session-list');\r\n  dom.sessionCount = document.getElementById('session-count');\r\n  dom.terminalsArea = document.querySelector('.terminals-area');\r\n  dom.emptyState = document.getElementById('empty-state');\r\n  dom.mobileTitle = document.getElementById('mobile-title');\r\n  dom.topbarActions = document.getElementById('topbar-actions');\r\n  dom.app = document.getElementById('app');\r\n  dom.sidebarOverlay = document.getElementById('sidebar-overlay');\r\n  dom.settingsView = document.getElementById('settings-view');\r\n  dom.settingsBtn = document.getElementById('btn-settings');\r\n  dom.titleBarCustom = document.getElementById('title-bar-custom');\r\n  dom.titleBarTerminal = document.getElementById('title-bar-terminal');\r\n  dom.titleBarSeparator = document.getElementById('title-bar-separator');\r\n}\r\n", "/**\r\n * DOM Utilities\r\n *\r\n * Helper functions for DOM manipulation and event handling.\r\n */\r\n\r\n/**\r\n * Escape HTML special characters to prevent XSS\r\n */\r\nexport function escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Bind a click event to an element by ID\r\n */\r\nexport function bindClick(id: string, handler: (e: MouseEvent) => void): void {\r\n  const el = document.getElementById(id);\r\n  if (el) {\r\n    el.addEventListener('click', handler);\r\n  }\r\n}\r\n\r\n/**\r\n * Create a debounced version of a function\r\n */\r\nexport function debounce<T extends (...args: unknown[]) => void>(\r\n  fn: T,\r\n  delay: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeoutId: number | undefined;\r\n  return (...args: Parameters<T>) => {\r\n    if (timeoutId !== undefined) {\r\n      clearTimeout(timeoutId);\r\n    }\r\n    timeoutId = window.setTimeout(() => fn(...args), delay);\r\n  };\r\n}\r\n\r\n/**\r\n * Format bytes as human-readable string\r\n */\r\nexport function formatBytes(bytes: number): string {\r\n  if (bytes < 1024) return bytes + ' B';\r\n  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\r\n  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\r\n}\r\n", "/**\r\n * Cookie Utilities\r\n *\r\n * Functions for reading and writing browser cookies.\r\n */\r\n\r\n/**\r\n * Get a cookie value by name\r\n */\r\nexport function getCookie(name: string): string | null {\r\n  const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));\r\n  const value = match?.[2];\r\n  return value !== undefined ? decodeURIComponent(value) : null;\r\n}\r\n\r\n/**\r\n * Set a cookie value\r\n */\r\nexport function setCookie(name: string, value: string, days: number = 365): void {\r\n  const expires = new Date(Date.now() + days * 24 * 60 * 60 * 1000).toUTCString();\r\n  document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;\r\n}\r\n\r\n/**\r\n * Delete a cookie by name\r\n */\r\nexport function deleteCookie(name: string): void {\r\n  document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;\r\n}\r\n\r\n/**\r\n * Detect clipboard shortcut style based on platform\r\n */\r\nexport function getClipboardStyle(setting: 'auto' | 'windows' | 'unix'): 'windows' | 'unix' {\r\n  if (setting !== 'auto') return setting;\r\n  const ua = navigator.userAgent || '';\r\n  return /Windows|Win32|Win64/i.test(ua) ? 'windows' : 'unix';\r\n}\r\n", "/**\r\n * Protocol Utilities\r\n *\r\n * Binary protocol helpers for mux WebSocket communication.\r\n */\r\n\r\nimport { MAX_FRAME_DIMENSION } from '../constants';\r\n\r\n/** Parsed output frame from server */\r\nexport interface OutputFrame {\r\n  cols: number;\r\n  rows: number;\r\n  data: Uint8Array;\r\n  valid: boolean;\r\n}\r\n\r\n/**\r\n * Parse output frame from binary payload.\r\n * Frame format: [cols:2][rows:2][data]\r\n */\r\nexport function parseOutputFrame(payload: Uint8Array): OutputFrame {\r\n  const cols = (payload[0] ?? 0) | ((payload[1] ?? 0) << 8);\r\n  const rows = (payload[2] ?? 0) | ((payload[3] ?? 0) << 8);\r\n  const data = payload.slice(4);\r\n  const valid = cols > 0 && cols <= MAX_FRAME_DIMENSION && rows > 0 && rows <= MAX_FRAME_DIMENSION;\r\n\r\n  return { cols, rows, data, valid };\r\n}\r\n\r\n/**\r\n * Parse compressed output frame and decompress.\r\n * Frame format: [cols:2][rows:2][uncompressedLen:4][gzip-data...]\r\n */\r\nexport async function parseCompressedOutputFrame(payload: Uint8Array): Promise<OutputFrame> {\r\n  const cols = (payload[0] ?? 0) | ((payload[1] ?? 0) << 8);\r\n  const rows = (payload[2] ?? 0) | ((payload[3] ?? 0) << 8);\r\n  const valid = cols > 0 && cols <= MAX_FRAME_DIMENSION && rows > 0 && rows <= MAX_FRAME_DIMENSION;\r\n\r\n  // Skip uncompressedLen (bytes 4-7) - we don't need it, DecompressionStream handles sizing\r\n  const compressedData = payload.slice(8);\r\n\r\n  try {\r\n    const data = await decompressGzip(compressedData);\r\n    return { cols, rows, data, valid };\r\n  } catch (e) {\r\n    console.error('Decompression failed:', e);\r\n    return { cols, rows, data: new Uint8Array(0), valid: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Decompress GZip data using native DecompressionStream API.\r\n * Uses Blob/Response pipeline to avoid backpressure deadlock.\r\n */\r\nexport async function decompressGzip(compressed: Uint8Array): Promise<Uint8Array> {\r\n  const blob = new Blob([compressed as BlobPart]);\r\n  const stream = blob.stream().pipeThrough(new DecompressionStream('gzip'));\r\n  return new Uint8Array(await new Response(stream).arrayBuffer());\r\n}\r\n", "/**\r\n * Reconnection Utilities\r\n *\r\n * Exponential backoff reconnection logic for WebSocket connections.\r\n */\r\n\r\n/**\r\n * Schedule a reconnection with exponential backoff.\r\n * Returns the timer ID for cancellation.\r\n */\r\nexport function scheduleReconnect(\r\n  currentDelay: number,\r\n  maxDelay: number,\r\n  connect: () => void,\r\n  setDelay: (delay: number) => void,\r\n  setTimer: (timer: number | undefined) => void,\r\n  existingTimer: number | undefined\r\n): void {\r\n  if (existingTimer !== undefined) {\r\n    clearTimeout(existingTimer);\r\n  }\r\n\r\n  const timer = window.setTimeout(() => {\r\n    setDelay(Math.min(currentDelay * 1.5, maxDelay));\r\n    connect();\r\n  }, currentDelay);\r\n\r\n  setTimer(timer);\r\n}\r\n", "/**\r\n * Utils Module\r\n *\r\n * Re-exports all utility functions.\r\n */\r\n\r\nexport * from './dom';\r\nexport * from './cookies';\r\nexport * from './protocol';\r\nexport * from './reconnect';\r\n", "/**\r\n * Settings Persistence Module\r\n *\r\n * Handles loading, saving, and form binding for application settings.\r\n * Communicates with the server API to persist settings changes.\r\n */\r\n\r\nimport type { Settings, ThemeName, TerminalState, HealthResponse } from '../../types';\r\nimport { THEMES, TERMINAL_FONT_STACK, JS_BUILD_VERSION } from '../../constants';\r\nimport { currentSettings, setCurrentSettings, dom, sessionTerminals } from '../../state';\r\nimport { setCookie } from '../../utils';\r\n\r\n/**\r\n * Set the value of a form element by ID\r\n */\r\nexport function setElementValue(id: string, value: string | number): void {\r\n  const el = document.getElementById(id) as HTMLInputElement | HTMLSelectElement | null;\r\n  if (el) el.value = String(value);\r\n}\r\n\r\n/**\r\n * Set the checked state of a checkbox by ID\r\n */\r\nexport function setElementChecked(id: string, checked: boolean): void {\r\n  const el = document.getElementById(id) as HTMLInputElement | null;\r\n  if (el) el.checked = checked;\r\n}\r\n\r\n/**\r\n * Get the value of a form element by ID\r\n */\r\nexport function getElementValue(id: string, defaultValue: string): string {\r\n  const el = document.getElementById(id) as HTMLInputElement | HTMLSelectElement | null;\r\n  return el ? el.value : defaultValue;\r\n}\r\n\r\n/**\r\n * Get the checked state of a checkbox by ID\r\n */\r\nexport function getElementChecked(id: string): boolean {\r\n  const el = document.getElementById(id) as HTMLInputElement | null;\r\n  return el ? el.checked : false;\r\n}\r\n\r\n/**\r\n * Populate version info in the about section\r\n */\r\nexport function populateVersionInfo(serverVersion: string | null, hostVersion: string | null, frontendVersion: string): void {\r\n  const formatVersion = (v: string) => 'v' + (v.split(/[+-]/)[0] ?? v).split('.').slice(0, 3).join('.');\r\n\r\n  const serverEl = document.getElementById('version-server');\r\n  if (serverEl && serverVersion) {\r\n    serverEl.textContent = formatVersion(serverVersion);\r\n  }\r\n\r\n  const frontendEl = document.getElementById('version-frontend');\r\n  if (frontendEl) {\r\n    frontendEl.textContent = frontendVersion === 'dev' ? 'dev' : formatVersion(frontendVersion);\r\n  }\r\n\r\n  const hostEl = document.getElementById('version-host');\r\n  if (hostEl) {\r\n    hostEl.textContent = hostVersion ? formatVersion(hostVersion) : '-';\r\n  }\r\n}\r\n\r\n/**\r\n * Populate user dropdown for run-as-user selection\r\n */\r\nexport function populateUserDropdown(\r\n  users: Array<{ username: string }>,\r\n  selectedUser: string | null\r\n): void {\r\n  const select = document.getElementById('setting-run-as-user') as HTMLSelectElement | null;\r\n  if (!select) return;\r\n\r\n  select.innerHTML = '<option value=\"\">Process Owner (default)</option>';\r\n\r\n  users.forEach((user) => {\r\n    const option = document.createElement('option');\r\n    option.value = user.username;\r\n    option.textContent = user.username;\r\n    if (user.username === selectedUser) {\r\n      option.selected = true;\r\n    }\r\n    select.appendChild(option);\r\n  });\r\n}\r\n\r\n/**\r\n * Populate the settings form with current settings\r\n */\r\nexport function populateSettingsForm(settings: Settings): void {\r\n  setElementValue('setting-default-shell', settings.defaultShell || 'Pwsh');\r\n  setElementValue('setting-working-dir', settings.defaultWorkingDirectory || '');\r\n  setElementValue('setting-font-size', settings.fontSize || 14);\r\n  setElementValue('setting-font-family', settings.fontFamily || 'Cascadia Code');\r\n  setElementValue('setting-cursor-style', settings.cursorStyle || 'bar');\r\n  setElementChecked('setting-cursor-blink', settings.cursorBlink !== false);\r\n  setElementValue('setting-theme', settings.theme || 'dark');\r\n  setElementValue('setting-contrast', String(settings.minimumContrastRatio || 1));\r\n  setElementValue('setting-scrollback', settings.scrollbackLines || 10000);\r\n  setElementValue('setting-bell-style', settings.bellStyle || 'notification');\r\n  setElementChecked('setting-copy-on-select', settings.copyOnSelect === true);\r\n  setElementChecked('setting-right-click-paste', settings.rightClickPaste !== false);\r\n  setElementValue('setting-clipboard-shortcuts', settings.clipboardShortcuts || 'auto');\r\n  setElementChecked('setting-smooth-scrolling', settings.smoothScrolling === true);\r\n  setElementChecked('setting-webgl', settings.useWebGL !== false);\r\n  setElementValue('setting-run-as-user', settings.runAsUser || '');\r\n  setElementChecked('setting-debug-logging', settings.debugLogging === true);\r\n}\r\n\r\n/**\r\n * Fetch settings, users, version, and health from server and populate the form\r\n */\r\nexport async function fetchSettings(): Promise<void> {\r\n  try {\r\n    const [settings, users, version, health] = await Promise.all([\r\n      fetch('/api/settings').then((r) => r.json() as Promise<Settings>),\r\n      fetch('/api/users')\r\n        .then((r) => r.json() as Promise<Array<{ username: string }>>)\r\n        .catch(() => [] as Array<{ username: string }>),\r\n      fetch('/api/version')\r\n        .then((r) => r.text())\r\n        .catch(() => null),\r\n      fetch('/api/health')\r\n        .then((r) => r.json() as Promise<HealthResponse>)\r\n        .catch(() => ({ status: '', memoryMB: 0, uptime: '', sessionCount: 0, ttyHostVersion: undefined }))\r\n    ]);\r\n\r\n    setCurrentSettings(settings);\r\n    populateUserDropdown(users, settings.runAsUser);\r\n    populateSettingsForm(settings);\r\n    populateVersionInfo(version, health.ttyHostVersion ?? null, JS_BUILD_VERSION);\r\n\r\n    // Apply settings to any terminals that were created before settings loaded\r\n    applySettingsToTerminals();\r\n  } catch (e) {\r\n    console.error('Error fetching settings:', e);\r\n  }\r\n}\r\n\r\n/**\r\n * Apply current settings to all open terminals\r\n */\r\nfunction applySettingsToTerminals(): void {\r\n  if (!currentSettings) return;\r\n  const settings = currentSettings;\r\n\r\n  const theme = THEMES[settings.theme] || THEMES.dark;\r\n  const fontFamily = `'${settings.fontFamily || 'Cascadia Code'}', ${TERMINAL_FONT_STACK}`;\r\n\r\n  sessionTerminals.forEach((state: TerminalState) => {\r\n    state.terminal.options.cursorBlink = settings.cursorBlink;\r\n    state.terminal.options.cursorStyle = settings.cursorStyle;\r\n    state.terminal.options.fontFamily = fontFamily;\r\n    state.terminal.options.fontSize = settings.fontSize;\r\n    state.terminal.options.theme = theme;\r\n    state.terminal.options.minimumContrastRatio = settings.minimumContrastRatio;\r\n    state.terminal.options.smoothScrollDuration = settings.smoothScrolling ? 150 : 0;\r\n\r\n    // Trigger re-render after font changes\r\n    if (state.opened) {\r\n      try {\r\n        const dims = state.fitAddon.proposeDimensions();\r\n        if (dims?.cols && dims?.rows) {\r\n          state.fitAddon.fit();\r\n        }\r\n      } catch {\r\n        // FitAddon may fail if terminal render service isn't initialized\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Save all settings to the server\r\n */\r\nexport function saveAllSettings(): void {\r\n  const runAsUserValue = getElementValue('setting-run-as-user', '');\r\n  const settings: Settings = {\r\n    defaultShell: getElementValue('setting-default-shell', 'Pwsh'),\r\n    defaultCols: currentSettings?.defaultCols ?? 120,\r\n    defaultRows: currentSettings?.defaultRows ?? 30,\r\n    defaultWorkingDirectory: getElementValue('setting-working-dir', ''),\r\n    fontSize: parseInt(getElementValue('setting-font-size', '14'), 10) || 14,\r\n    fontFamily: getElementValue('setting-font-family', 'Cascadia Code'),\r\n    cursorStyle: getElementValue('setting-cursor-style', 'bar') as Settings['cursorStyle'],\r\n    cursorBlink: getElementChecked('setting-cursor-blink'),\r\n    theme: getElementValue('setting-theme', 'dark') as ThemeName,\r\n    minimumContrastRatio: parseFloat(getElementValue('setting-contrast', '1')) || 1,\r\n    smoothScrolling: getElementChecked('setting-smooth-scrolling'),\r\n    useWebGL: getElementChecked('setting-webgl'),\r\n    scrollbackLines: parseInt(getElementValue('setting-scrollback', '10000'), 10) || 10000,\r\n    bellStyle: getElementValue('setting-bell-style', 'notification') as Settings['bellStyle'],\r\n    copyOnSelect: getElementChecked('setting-copy-on-select'),\r\n    rightClickPaste: getElementChecked('setting-right-click-paste'),\r\n    clipboardShortcuts: getElementValue(\r\n      'setting-clipboard-shortcuts',\r\n      'auto'\r\n    ) as Settings['clipboardShortcuts'],\r\n    runAsUser: runAsUserValue || null,\r\n    debugLogging: getElementChecked('setting-debug-logging')\r\n  };\r\n\r\n  setCookie('mm-theme', settings.theme);\r\n\r\n  fetch('/api/settings', {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(settings)\r\n  })\r\n    .then((r) => {\r\n      if (r.ok) {\r\n        setCurrentSettings(settings);\r\n        const theme = THEMES[settings.theme] || THEMES.dark;\r\n        document.documentElement.style.setProperty('--terminal-bg', theme.background);\r\n        applySettingsToTerminals();\r\n      }\r\n    })\r\n    .catch((e) => {\r\n      console.error('Error saving settings:', e);\r\n    });\r\n}\r\n\r\n/**\r\n * Bind auto-save behavior to settings form elements\r\n */\r\nexport function bindSettingsAutoSave(): void {\r\n  const settingsView = dom.settingsView;\r\n  if (!settingsView) return;\r\n\r\n  settingsView.querySelectorAll('select, input[type=\"checkbox\"]').forEach((el) => {\r\n    el.addEventListener('change', saveAllSettings);\r\n  });\r\n\r\n  settingsView.querySelectorAll('.text-input-wrapper').forEach((wrapper) => {\r\n    const input = wrapper.querySelector('input') as HTMLInputElement | null;\r\n    const saveBtn = wrapper.querySelector('.inline-save-btn') as HTMLButtonElement | null;\r\n    if (!input || !saveBtn) return;\r\n\r\n    let originalValue = '';\r\n\r\n    input.addEventListener('focus', () => {\r\n      originalValue = input.value;\r\n    });\r\n\r\n    input.addEventListener('input', () => {\r\n      wrapper.classList.toggle('unsaved', input.value !== originalValue);\r\n    });\r\n\r\n    saveBtn.addEventListener('click', () => {\r\n      saveAllSettings();\r\n      wrapper.classList.remove('unsaved');\r\n      originalValue = input.value;\r\n    });\r\n\r\n    input.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        saveAllSettings();\r\n        wrapper.classList.remove('unsaved');\r\n        originalValue = input.value;\r\n      }\r\n    });\r\n  });\r\n}\r\n", "/**\r\n * Settings Panel Module\r\n *\r\n * Handles the settings panel UI visibility, system status display,\r\n * and health check functionality.\r\n */\r\n\r\nimport type { HealthResponse } from '../../types';\r\nimport {\r\n  settingsOpen,\r\n  setSettingsOpen,\r\n  activeSessionId,\r\n  sessionTerminals,\r\n  sessions,\r\n  dom,\r\n  setWindowsBuildNumber\r\n} from '../../state';\r\nimport { fetchSettings } from './persistence';\r\n\r\n/**\r\n * Close the mobile sidebar\r\n */\r\nfunction closeSidebar(): void {\r\n  const app = dom.app;\r\n  if (app) app.classList.remove('sidebar-open');\r\n}\r\n\r\n/**\r\n * Toggle the settings panel visibility\r\n */\r\nexport function toggleSettings(): void {\r\n  if (settingsOpen) {\r\n    closeSettings();\r\n  } else {\r\n    openSettings();\r\n  }\r\n}\r\n\r\n/**\r\n * Open the settings panel\r\n */\r\nexport function openSettings(): void {\r\n  setSettingsOpen(true);\r\n  if (dom.settingsBtn) dom.settingsBtn.classList.add('active');\r\n  closeSidebar();\r\n\r\n  if (activeSessionId) {\r\n    const state = sessionTerminals.get(activeSessionId);\r\n    if (state) state.container.classList.add('hidden');\r\n  }\r\n\r\n  if (dom.emptyState) dom.emptyState.classList.add('hidden');\r\n  if (dom.settingsView) dom.settingsView.classList.remove('hidden');\r\n\r\n  fetchSettings();\r\n  fetchSystemStatus();\r\n}\r\n\r\n/**\r\n * Close the settings panel\r\n */\r\nexport function closeSettings(): void {\r\n  setSettingsOpen(false);\r\n  if (dom.settingsBtn) dom.settingsBtn.classList.remove('active');\r\n  if (dom.settingsView) dom.settingsView.classList.add('hidden');\r\n\r\n  if (activeSessionId) {\r\n    const state = sessionTerminals.get(activeSessionId);\r\n    if (state) {\r\n      state.container.classList.remove('hidden');\r\n      requestAnimationFrame(() => {\r\n        state.terminal.focus();\r\n      });\r\n    }\r\n  } else if (sessions.length === 0 && dom.emptyState) {\r\n    dom.emptyState.classList.remove('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Format uptime seconds into human-readable string\r\n */\r\nexport function formatUptime(seconds: number): string {\r\n  if (seconds < 60) return seconds + 's';\r\n  if (seconds < 3600) return Math.floor(seconds / 60) + 'm ' + (seconds % 60) + 's';\r\n\r\n  const hours = Math.floor(seconds / 3600);\r\n  const mins = Math.floor((seconds % 3600) / 60);\r\n\r\n  if (hours < 24) return hours + 'h ' + mins + 'm';\r\n\r\n  const days = Math.floor(hours / 24);\r\n  return days + 'd ' + (hours % 24) + 'h';\r\n}\r\n\r\n/**\r\n * Update the ttyhost version mismatch warning banner\r\n */\r\nexport function updateTtyHostWarning(health: HealthResponse): void {\r\n  let banner = document.getElementById('ttyhost-warning');\r\n\r\n  if (!banner) {\r\n    banner = document.createElement('div');\r\n    banner.id = 'ttyhost-warning';\r\n    banner.className = 'warning-banner';\r\n    const header = document.querySelector('.app-header');\r\n    if (header && header.parentNode) {\r\n      header.parentNode.insertBefore(banner, header.nextSibling);\r\n    }\r\n  }\r\n\r\n  if (health.ttyHostVersion && health.ttyHostCompatible === false) {\r\n    banner.innerHTML =\r\n      '<strong>Version mismatch:</strong> mmttyhost is ' +\r\n      health.ttyHostVersion +\r\n      ', expected ' +\r\n      health.ttyHostExpected +\r\n      '. Terminals may not work correctly. Please update mmttyhost.exe or restart the service.';\r\n    banner.style.display = 'block';\r\n  } else {\r\n    banner.style.display = 'none';\r\n  }\r\n}\r\n\r\n/**\r\n * Fetch and display system status in the settings panel\r\n */\r\nexport function fetchSystemStatus(): void {\r\n  const container = document.getElementById('system-status-content');\r\n  if (!container) return;\r\n\r\n  fetch('/api/health')\r\n    .then((response) => response.json() as Promise<HealthResponse>)\r\n    .then((health) => {\r\n      const statusClass = health.healthy ? 'status-healthy' : 'status-error';\r\n      const statusText = health.healthy ? 'Healthy' : 'Unhealthy';\r\n      const uptimeStr = formatUptime(health.uptimeSeconds || 0);\r\n\r\n      let ttyHostHtml = '';\r\n      if (health.ttyHostVersion !== null && health.ttyHostVersion !== undefined) {\r\n        const versionClass = health.ttyHostCompatible ? '' : 'status-error';\r\n        ttyHostHtml =\r\n          '<div class=\"status-detail-row\">' +\r\n          '<span class=\"detail-label\">mmttyhost</span>' +\r\n          '<span class=\"detail-value ' +\r\n          versionClass +\r\n          '\">' +\r\n          health.ttyHostVersion +\r\n          (health.ttyHostCompatible ? '' : ' expected ' + health.ttyHostExpected) +\r\n          '</span>' +\r\n          '</div>';\r\n      }\r\n\r\n      container.innerHTML =\r\n        '<div class=\"status-grid\">' +\r\n        '<div class=\"status-item\">' +\r\n        '<span class=\"status-label\">Status</span>' +\r\n        '<span class=\"status-value ' +\r\n        statusClass +\r\n        '\">' +\r\n        statusText +\r\n        '</span>' +\r\n        '</div>' +\r\n        '<div class=\"status-item\">' +\r\n        '<span class=\"status-label\">Mode</span>' +\r\n        '<span class=\"status-value\">' +\r\n        (health.mode || '') +\r\n        '</span>' +\r\n        '</div>' +\r\n        '<div class=\"status-item\">' +\r\n        '<span class=\"status-label\">Sessions</span>' +\r\n        '<span class=\"status-value\">' +\r\n        health.sessionCount +\r\n        '</span>' +\r\n        '</div>' +\r\n        '<div class=\"status-item\">' +\r\n        '<span class=\"status-label\">Uptime</span>' +\r\n        '<span class=\"status-value\">' +\r\n        uptimeStr +\r\n        '</span>' +\r\n        '</div>' +\r\n        '</div>' +\r\n        '<div class=\"status-details\">' +\r\n        '<div class=\"status-detail-row\">' +\r\n        '<span class=\"detail-label\">Platform</span>' +\r\n        '<span class=\"detail-value\">' +\r\n        (health.platform || '') +\r\n        '</span>' +\r\n        '</div>' +\r\n        '<div class=\"status-detail-row\">' +\r\n        '<span class=\"detail-label\">Process ID</span>' +\r\n        '<span class=\"detail-value\">' +\r\n        (health.webProcessId || '') +\r\n        '</span>' +\r\n        '</div>' +\r\n        ttyHostHtml +\r\n        '</div>';\r\n\r\n      updateTtyHostWarning(health);\r\n    })\r\n    .catch((err: unknown) => {\r\n      const message = err instanceof Error ? err.message : String(err);\r\n      container.innerHTML =\r\n        '<div class=\"status-error-msg\">Failed to load system status: ' + message + '</div>';\r\n    });\r\n}\r\n\r\n/**\r\n * Check system health on startup for version mismatches\r\n */\r\nexport function checkSystemHealth(): void {\r\n  fetch('/api/health')\r\n    .then((response) => response.json() as Promise<HealthResponse>)\r\n    .then((health) => {\r\n      updateTtyHostWarning(health);\r\n      if (health.windowsBuildNumber !== undefined) {\r\n        setWindowsBuildNumber(health.windowsBuildNumber);\r\n      }\r\n    })\r\n    .catch(() => {});\r\n}\r\n", "/**\r\n * Settings Module\r\n *\r\n * Re-exports settings panel and persistence functionality.\r\n */\r\n\r\nexport * from './panel';\r\nexport * from './persistence';\r\n", "/**\r\n * Theming Module\r\n *\r\n * Theme definitions and application to xterm.js terminals.\r\n */\r\n\r\nimport type { ThemeName, TerminalTheme } from '../../types';\r\nimport { THEMES } from '../../constants';\r\nimport { sessionTerminals, currentSettings } from '../../state';\r\nimport { setCookie } from '../../utils';\r\n\r\n/**\r\n * Get the current theme based on settings\r\n */\r\nexport function getCurrentTheme(): TerminalTheme {\r\n  const themeName = currentSettings?.theme || 'dark';\r\n  return THEMES[themeName] || THEMES.dark;\r\n}\r\n\r\n/**\r\n * Apply theme to all terminals\r\n */\r\nexport function applyThemeToTerminals(themeName: ThemeName): void {\r\n  const theme = THEMES[themeName];\r\n  if (!theme) return;\r\n\r\n  sessionTerminals.forEach((state) => {\r\n    state.terminal.options.theme = theme;\r\n  });\r\n}\r\n\r\n/**\r\n * Apply theme and persist to cookie\r\n */\r\nexport function setTheme(themeName: ThemeName): void {\r\n  setCookie('mm-theme', themeName);\r\n  applyThemeToTerminals(themeName);\r\n\r\n  // Update CSS variable for flash prevention\r\n  document.documentElement.style.setProperty('--terminal-bg', THEMES[themeName].background);\r\n}\r\n\r\n/**\r\n * Initialize theme from saved cookie\r\n */\r\nexport function initThemeFromCookie(): void {\r\n  const savedTheme = document.cookie.match(/mm-theme=([^;]+)/)?.[1] as ThemeName | undefined;\r\n  if (savedTheme && THEMES[savedTheme]) {\r\n    document.documentElement.style.setProperty('--terminal-bg', THEMES[savedTheme].background);\r\n  }\r\n}\r\n", "/**\r\n * State Channel Module\r\n *\r\n * Manages the state WebSocket connection for real-time session list updates.\r\n * Handles automatic reconnection with exponential backoff.\r\n */\r\n\r\nimport type { Session, UpdateInfo, TerminalState } from '../../types';\r\nimport { INITIAL_RECONNECT_DELAY, MAX_RECONNECT_DELAY } from '../../constants';\r\nimport { scheduleReconnect } from '../../utils';\r\nimport {\r\n  sessions,\r\n  activeSessionId,\r\n  stateWs,\r\n  stateReconnectTimer,\r\n  stateReconnectDelay,\r\n  stateWsConnected,\r\n  muxWsConnected,\r\n  sessionTerminals,\r\n  newlyCreatedSessions,\r\n  setStateWs,\r\n  setStateReconnectTimer,\r\n  setStateReconnectDelay,\r\n  setStateWsConnected,\r\n  setSessions,\r\n  setActiveSessionId,\r\n  setUpdateInfo\r\n} from '../../state';\r\n\r\n// Forward declarations for functions from other modules\r\n// These will be imported when those modules are created\r\nlet destroyTerminalForSession: (sessionId: string) => void = () => {};\r\nlet applyTerminalScaling: (sessionId: string, state: TerminalState) => void = () => {};\r\nlet renderSessionList: () => void = () => {};\r\nlet updateEmptyState: () => void = () => {};\r\nlet selectSession: (sessionId: string) => void = () => {};\r\nlet updateMobileTitle: () => void = () => {};\r\nlet renderUpdatePanel: () => void = () => {};\r\n\r\n/**\r\n * Register callbacks from other modules\r\n */\r\nexport function registerStateCallbacks(callbacks: {\r\n  destroyTerminalForSession?: (sessionId: string) => void;\r\n  applyTerminalScaling?: (sessionId: string, state: TerminalState) => void;\r\n  renderSessionList?: () => void;\r\n  updateEmptyState?: () => void;\r\n  selectSession?: (sessionId: string) => void;\r\n  updateMobileTitle?: () => void;\r\n  renderUpdatePanel?: () => void;\r\n}): void {\r\n  if (callbacks.destroyTerminalForSession) destroyTerminalForSession = callbacks.destroyTerminalForSession;\r\n  if (callbacks.applyTerminalScaling) applyTerminalScaling = callbacks.applyTerminalScaling;\r\n  if (callbacks.renderSessionList) renderSessionList = callbacks.renderSessionList;\r\n  if (callbacks.updateEmptyState) updateEmptyState = callbacks.updateEmptyState;\r\n  if (callbacks.selectSession) selectSession = callbacks.selectSession;\r\n  if (callbacks.updateMobileTitle) updateMobileTitle = callbacks.updateMobileTitle;\r\n  if (callbacks.renderUpdatePanel) renderUpdatePanel = callbacks.renderUpdatePanel;\r\n}\r\n\r\n/**\r\n * Connect to the state WebSocket for real-time session updates.\r\n * Automatically reconnects with exponential backoff on disconnect.\r\n */\r\nexport function connectStateWebSocket(): void {\r\n  // Close existing WebSocket before creating new one\r\n  if (stateWs) {\r\n    stateWs.onclose = null; // Prevent reconnect loop\r\n    stateWs.close();\r\n    setStateWs(null);\r\n  }\r\n\r\n  const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n  const ws = new WebSocket(`${protocol}//${location.host}/ws/state`);\r\n  setStateWs(ws);\r\n\r\n  ws.onopen = () => {\r\n    setStateReconnectDelay(INITIAL_RECONNECT_DELAY);\r\n    setStateWsConnected(true);\r\n    updateConnectionStatus();\r\n  };\r\n\r\n  ws.onmessage = (event) => {\r\n    try {\r\n      const data = JSON.parse(event.data);\r\n      const sessionList = data.sessions?.sessions ?? [];\r\n      handleStateUpdate(sessionList);\r\n      handleUpdateInfo(data.update);\r\n    } catch (e: unknown) {\r\n      const message = e instanceof Error ? e.message : String(e);\r\n      console.error('Error parsing state:', message);\r\n    }\r\n  };\r\n\r\n  ws.onclose = () => {\r\n    setStateWsConnected(false);\r\n    updateConnectionStatus();\r\n    scheduleStateReconnect();\r\n  };\r\n\r\n  ws.onerror = (e) => {\r\n    console.error('State WebSocket error:', e);\r\n  };\r\n}\r\n\r\n/**\r\n * Handle session list updates from server.\r\n * Removes terminals for deleted sessions, updates dimensions, and manages selection.\r\n */\r\nexport function handleStateUpdate(newSessions: Session[]): void {\r\n  // Remove terminals for deleted sessions\r\n  const newIds = new Set(newSessions.map(s => s.id));\r\n  sessionTerminals.forEach((_, id) => {\r\n    if (!newIds.has(id)) {\r\n      destroyTerminalForSession(id);\r\n      newlyCreatedSessions.delete(id);\r\n    }\r\n  });\r\n\r\n  // Update dimensions and resize terminals when server dimensions change\r\n  newSessions.forEach((session) => {\r\n    const state = sessionTerminals.get(session.id);\r\n    if (state && state.opened) {\r\n      const dimensionsChanged = state.serverCols !== session.cols || state.serverRows !== session.rows;\r\n      if (dimensionsChanged) {\r\n        state.serverCols = session.cols;\r\n        state.serverRows = session.rows;\r\n        state.terminal.resize(session.cols, session.rows);\r\n        applyTerminalScaling(session.id, state);\r\n      }\r\n    } else if (state) {\r\n      state.serverCols = session.cols;\r\n      state.serverRows = session.rows;\r\n    }\r\n  });\r\n\r\n  setSessions(newSessions);\r\n  renderSessionList();\r\n  updateEmptyState();\r\n\r\n  // Auto-select first session if none active\r\n  const firstSession = sessions[0];\r\n  if (!activeSessionId && firstSession) {\r\n    selectSession(firstSession.id);\r\n  }\r\n\r\n  // Handle active session being deleted\r\n  if (activeSessionId && !sessions.find(s => s.id === activeSessionId)) {\r\n    setActiveSessionId(null);\r\n    const nextSession = sessions[0];\r\n    if (nextSession) {\r\n      selectSession(nextSession.id);\r\n    }\r\n  }\r\n\r\n  updateMobileTitle();\r\n}\r\n\r\n/**\r\n * Handle update info from server.\r\n * Updates the stored update info and renders the update panel.\r\n */\r\nexport function handleUpdateInfo(update: UpdateInfo | null): void {\r\n  setUpdateInfo(update);\r\n  renderUpdatePanel();\r\n}\r\n\r\n/**\r\n * Schedule state WebSocket reconnection with exponential backoff.\r\n */\r\nexport function scheduleStateReconnect(): void {\r\n  scheduleReconnect(\r\n    stateReconnectDelay,\r\n    MAX_RECONNECT_DELAY,\r\n    connectStateWebSocket,\r\n    setStateReconnectDelay,\r\n    setStateReconnectTimer,\r\n    stateReconnectTimer\r\n  );\r\n}\r\n\r\n/**\r\n * Update the connection status indicator in the UI.\r\n */\r\nexport function updateConnectionStatus(): void {\r\n  const indicator = document.getElementById('connection-status');\r\n  if (!indicator) return;\r\n\r\n  let status: string;\r\n  let text: string;\r\n\r\n  if (stateWsConnected && muxWsConnected) {\r\n    status = 'connected';\r\n    text = '';\r\n  } else if (!stateWsConnected && !muxWsConnected) {\r\n    status = 'disconnected';\r\n    text = 'Server disconnected';\r\n  } else {\r\n    status = 'reconnecting';\r\n    text = 'Reconnecting...';\r\n  }\r\n\r\n  indicator.className = `connection-status ${status}`;\r\n  indicator.textContent = text;\r\n}\r\n", "/**\r\n * Mux Channel Module\r\n *\r\n * Manages the mux WebSocket connection for terminal I/O.\r\n * Uses a binary protocol with 9-byte header (1 byte type + 8 byte session ID).\r\n *\r\n * CRITICAL: All output frames are processed strictly in order through a single queue.\r\n * This ensures TUI apps receive escape sequences in the correct order.\r\n */\r\n\r\nimport type { TerminalState } from '../../types';\r\nimport {\r\n  MUX_HEADER_SIZE,\r\n  MUX_TYPE_OUTPUT,\r\n  MUX_TYPE_INPUT,\r\n  MUX_TYPE_RESIZE,\r\n  MUX_TYPE_RESYNC,\r\n  MUX_TYPE_BUFFER_REQUEST,\r\n  MUX_TYPE_COMPRESSED_OUTPUT,\r\n  INITIAL_RECONNECT_DELAY,\r\n  MAX_RECONNECT_DELAY\r\n} from '../../constants';\r\nimport { parseOutputFrame, parseCompressedOutputFrame, scheduleReconnect } from '../../utils';\r\nimport {\r\n  muxWs,\r\n  muxReconnectTimer,\r\n  muxReconnectDelay,\r\n  muxHasConnected,\r\n  sessionTerminals,\r\n  pendingOutputFrames,\r\n  setMuxWs,\r\n  setMuxReconnectTimer,\r\n  setMuxReconnectDelay,\r\n  setMuxWsConnected,\r\n  setMuxHasConnected\r\n} from '../../state';\r\nimport { updateConnectionStatus } from './stateChannel';\r\n\r\n// Forward declarations for functions from other modules\r\nlet applyTerminalScaling: (sessionId: string, state: TerminalState) => void = () => {};\r\n\r\n/**\r\n * Register callbacks from other modules\r\n */\r\nexport function registerMuxCallbacks(callbacks: {\r\n  applyTerminalScaling?: (sessionId: string, state: TerminalState) => void;\r\n}): void {\r\n  if (callbacks.applyTerminalScaling) applyTerminalScaling = callbacks.applyTerminalScaling;\r\n}\r\n\r\n// =============================================================================\r\n// Strictly Ordered Output Queue\r\n// =============================================================================\r\n\r\ninterface OutputFrameItem {\r\n  sessionId: string;\r\n  payload: Uint8Array;\r\n  compressed: boolean;\r\n}\r\n\r\nconst outputQueue: OutputFrameItem[] = [];\r\nlet processingQueue = false;\r\n\r\n/**\r\n * Queue an output frame and trigger processing.\r\n * ALL frames go through this queue to guarantee strict ordering.\r\n */\r\nfunction queueOutputFrame(sessionId: string, payload: Uint8Array, compressed: boolean): void {\r\n  outputQueue.push({ sessionId, payload, compressed });\r\n  processOutputQueue();\r\n}\r\n\r\n/**\r\n * Process output frames strictly in order.\r\n * Frames are processed one at a time - compressed frames block until decompressed.\r\n */\r\nasync function processOutputQueue(): Promise<void> {\r\n  if (processingQueue) return;\r\n  processingQueue = true;\r\n\r\n  try {\r\n    while (outputQueue.length > 0) {\r\n      const item = outputQueue.shift()!;\r\n      await processOneFrame(item);\r\n    }\r\n  } finally {\r\n    processingQueue = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Process a single frame - decompress if needed, then write to terminal.\r\n */\r\nasync function processOneFrame(item: OutputFrameItem): Promise<void> {\r\n  try {\r\n    let cols: number;\r\n    let rows: number;\r\n    let data: Uint8Array;\r\n\r\n    if (item.compressed) {\r\n      const frame = await parseCompressedOutputFrame(item.payload);\r\n      cols = frame.cols;\r\n      rows = frame.rows;\r\n      data = frame.data;\r\n    } else {\r\n      const frame = parseOutputFrame(item.payload);\r\n      cols = frame.cols;\r\n      rows = frame.rows;\r\n      data = frame.data;\r\n    }\r\n\r\n    const state = sessionTerminals.get(item.sessionId);\r\n    if (state && state.opened) {\r\n      writeToTerminal(item.sessionId, state, cols, rows, data);\r\n    } else if (data.length > 0) {\r\n      // Buffer for later replay\r\n      const bufferedPayload = new Uint8Array(4 + data.length);\r\n      bufferedPayload[0] = cols & 0xff;\r\n      bufferedPayload[1] = (cols >> 8) & 0xff;\r\n      bufferedPayload[2] = rows & 0xff;\r\n      bufferedPayload[3] = (rows >> 8) & 0xff;\r\n      bufferedPayload.set(data, 4);\r\n\r\n      if (!pendingOutputFrames.has(item.sessionId)) {\r\n        pendingOutputFrames.set(item.sessionId, []);\r\n      }\r\n      pendingOutputFrames.get(item.sessionId)!.push(bufferedPayload);\r\n    }\r\n  } catch (e) {\r\n    console.error('Failed to process frame:', e);\r\n  }\r\n}\r\n\r\n// Track bracketed paste mode per session\r\nconst bracketedPasteState = new Map<string, boolean>();\r\n\r\n/** Check if session has bracketed paste mode enabled */\r\nexport function isBracketedPasteEnabled(sessionId: string): boolean {\r\n  return bracketedPasteState.get(sessionId) ?? false;\r\n}\r\n\r\n/**\r\n * Write data to terminal, resizing if dimensions changed.\r\n */\r\nfunction writeToTerminal(\r\n  sessionId: string,\r\n  state: TerminalState,\r\n  cols: number,\r\n  rows: number,\r\n  data: Uint8Array\r\n): void {\r\n  // Track bracketed paste mode by detecting escape sequences\r\n  if (data.length > 0) {\r\n    const text = new TextDecoder().decode(data);\r\n    if (text.includes('\\x1b[?2004h')) {\r\n      bracketedPasteState.set(sessionId, true);\r\n    }\r\n    if (text.includes('\\x1b[?2004l')) {\r\n      bracketedPasteState.set(sessionId, false);\r\n    }\r\n  }\r\n\r\n  // Resize if dimensions are valid and different\r\n  if (cols > 0 && rows > 0 && cols <= 500 && rows <= 500) {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    const termCore = (state.terminal as any)._core;\r\n    if (termCore && termCore._renderService) {\r\n      const currentCols = state.terminal.cols;\r\n      const currentRows = state.terminal.rows;\r\n\r\n      if (currentCols !== cols || currentRows !== rows) {\r\n        try {\r\n          state.terminal.resize(cols, rows);\r\n          state.serverCols = cols;\r\n          state.serverRows = rows;\r\n          applyTerminalScaling(sessionId, state);\r\n        } catch (e: unknown) {\r\n          const message = e instanceof Error ? e.message : String(e);\r\n          console.warn('Terminal resize deferred:', message);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Always write data if present\r\n  if (data.length > 0) {\r\n    state.terminal.write(data);\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n// WebSocket Connection\r\n// =============================================================================\r\n\r\n/**\r\n * Connect to the mux WebSocket for terminal I/O.\r\n * Uses a binary protocol with 9-byte header.\r\n */\r\nexport function connectMuxWebSocket(): void {\r\n  // Close existing WebSocket before creating new one\r\n  if (muxWs) {\r\n    muxWs.onclose = null; // Prevent reconnect loop\r\n    muxWs.close();\r\n    setMuxWs(null);\r\n  }\r\n\r\n  const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n  const ws = new WebSocket(`${protocol}//${location.host}/ws/mux`);\r\n  ws.binaryType = 'arraybuffer';\r\n  setMuxWs(ws);\r\n\r\n  ws.onopen = () => {\r\n    // Detect reconnect: we've connected before AND have terminals to refresh\r\n    const isReconnect = muxHasConnected && sessionTerminals.size > 0;\r\n\r\n    setMuxReconnectDelay(INITIAL_RECONNECT_DELAY);\r\n    setMuxWsConnected(true);\r\n    setMuxHasConnected(true);\r\n    updateConnectionStatus();\r\n\r\n    // On reconnect, clear all terminals and request buffer refresh for each\r\n    // This handles mt.exe restarts where sessions survive but connection is new\r\n    if (isReconnect) {\r\n      console.log(`[Mux] Reconnected - refreshing ${sessionTerminals.size} terminals`);\r\n      pendingOutputFrames.clear();\r\n      outputQueue.length = 0;\r\n      sessionTerminals.forEach((state) => {\r\n        if (state.opened) {\r\n          state.terminal.clear();\r\n        }\r\n        state.serverCols = 0;\r\n        state.serverRows = 0;\r\n        // Server pushes all buffers on connect via SendInitialBuffersAsync\r\n      });\r\n    } else {\r\n      console.log('[Mux] Connected (first connection)');\r\n    }\r\n  };\r\n\r\n  ws.onmessage = (event) => {\r\n    if (!(event.data instanceof ArrayBuffer)) return;\r\n\r\n    const data = new Uint8Array(event.data);\r\n    if (data.length < MUX_HEADER_SIZE) return;\r\n\r\n    const type = data[0];\r\n    const sessionId = decodeSessionId(data, 1);\r\n    const payload = data.slice(MUX_HEADER_SIZE);\r\n\r\n    if (type === MUX_TYPE_RESYNC) {\r\n      // Server is resyncing due to dropped frames - clear all terminals\r\n      console.log('[Resync] Clearing terminals for buffer refresh');\r\n      sessionTerminals.forEach((state) => {\r\n        if (state.opened) {\r\n          state.terminal.clear();\r\n        }\r\n      });\r\n      pendingOutputFrames.clear();\r\n      outputQueue.length = 0; // Clear pending queue too\r\n      return;\r\n    }\r\n\r\n    if (type === MUX_TYPE_OUTPUT || type === MUX_TYPE_COMPRESSED_OUTPUT) {\r\n      // Queue ALL output frames to guarantee strict ordering\r\n      if (payload.length >= 4) {\r\n        queueOutputFrame(sessionId, payload.slice(), type === MUX_TYPE_COMPRESSED_OUTPUT);\r\n      }\r\n    }\r\n  };\r\n\r\n  ws.onclose = () => {\r\n    setMuxWsConnected(false);\r\n    updateConnectionStatus();\r\n    scheduleMuxReconnect();\r\n  };\r\n\r\n  ws.onerror = (e) => {\r\n    console.error('Mux WebSocket error:', e);\r\n  };\r\n}\r\n\r\n/**\r\n * Send terminal input to server.\r\n */\r\nexport function sendInput(sessionId: string, data: string): void {\r\n  if (!muxWs || muxWs.readyState !== WebSocket.OPEN) return;\r\n\r\n  const payload = new TextEncoder().encode(data);\r\n  const frame = new Uint8Array(MUX_HEADER_SIZE + payload.length);\r\n  frame[0] = MUX_TYPE_INPUT;\r\n  encodeSessionId(frame, 1, sessionId);\r\n  frame.set(payload, MUX_HEADER_SIZE);\r\n  muxWs.send(frame);\r\n}\r\n\r\n/**\r\n * Send terminal resize to server.\r\n */\r\nexport function sendResize(sessionId: string, cols: number, rows: number): void {\r\n  if (!muxWs || muxWs.readyState !== WebSocket.OPEN) return;\r\n\r\n  const frame = new Uint8Array(MUX_HEADER_SIZE + 4);\r\n  frame[0] = MUX_TYPE_RESIZE;\r\n  encodeSessionId(frame, 1, sessionId);\r\n  frame[MUX_HEADER_SIZE] = cols & 0xff;\r\n  frame[MUX_HEADER_SIZE + 1] = (cols >> 8) & 0xff;\r\n  frame[MUX_HEADER_SIZE + 2] = rows & 0xff;\r\n  frame[MUX_HEADER_SIZE + 3] = (rows >> 8) & 0xff;\r\n  muxWs.send(frame);\r\n\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (state) {\r\n    state.serverCols = cols;\r\n    state.serverRows = rows;\r\n  }\r\n}\r\n\r\n/**\r\n * Request buffer refresh for a session via WebSocket.\r\n */\r\nexport function requestBufferRefresh(sessionId: string): void {\r\n  if (!muxWs || muxWs.readyState !== WebSocket.OPEN) return;\r\n\r\n  const frame = new Uint8Array(MUX_HEADER_SIZE);\r\n  frame[0] = MUX_TYPE_BUFFER_REQUEST;\r\n  encodeSessionId(frame, 1, sessionId);\r\n  muxWs.send(frame);\r\n}\r\n\r\n/**\r\n * Encode 8-character session ID into buffer at offset.\r\n */\r\nexport function encodeSessionId(buffer: Uint8Array, offset: number, sessionId: string): void {\r\n  for (let i = 0; i < 8; i++) {\r\n    buffer[offset + i] = i < sessionId.length ? sessionId.charCodeAt(i) : 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Decode 8-character session ID from buffer at offset.\r\n */\r\nexport function decodeSessionId(buffer: Uint8Array, offset: number): string {\r\n  const chars: string[] = [];\r\n  for (let i = 0; i < 8; i++) {\r\n    const byte = buffer[offset + i];\r\n    if (byte !== undefined && byte !== 0) {\r\n      chars.push(String.fromCharCode(byte));\r\n    }\r\n  }\r\n  return chars.join('');\r\n}\r\n\r\n/**\r\n * Schedule mux WebSocket reconnection with exponential backoff.\r\n */\r\nexport function scheduleMuxReconnect(): void {\r\n  scheduleReconnect(\r\n    muxReconnectDelay,\r\n    MAX_RECONNECT_DELAY,\r\n    connectMuxWebSocket,\r\n    setMuxReconnectDelay,\r\n    setMuxReconnectTimer,\r\n    muxReconnectTimer\r\n  );\r\n}\r\n\r\n/**\r\n * Write output frame to terminal (used by manager.ts for replay).\r\n */\r\nexport function writeOutputFrame(sessionId: string, state: TerminalState, payload: Uint8Array): void {\r\n  const frame = parseOutputFrame(payload);\r\n  writeToTerminal(sessionId, state, frame.cols, frame.rows, frame.data);\r\n}\r\n", "/**\r\n * Terminal Manager Module\r\n *\r\n * Handles xterm.js terminal lifecycle, creation, destruction,\r\n * and event binding for terminal sessions.\r\n */\r\n\r\nimport type { Session, TerminalState } from '../../types';\r\nimport { THEMES, MOBILE_BREAKPOINT, TERMINAL_FONT_STACK } from '../../constants';\r\nimport {\r\n  sessionTerminals,\r\n  currentSettings,\r\n  activeSessionId,\r\n  pendingOutputFrames,\r\n  fontsReadyPromise,\r\n  dom,\r\n  setFontsReadyPromise,\r\n  windowsBuildNumber,\r\n  sessions\r\n} from '../../state';\r\nimport { getClipboardStyle, parseOutputFrame } from '../../utils';\r\nimport { applyTerminalScaling, fitSessionToScreen } from './scaling';\r\nimport { setupFileDrop, handleClipboardPaste } from './fileDrop';\r\nimport { isBracketedPasteEnabled } from '../comms';\r\n\r\ndeclare const Terminal: any;\r\ndeclare const FitAddon: any;\r\ndeclare const WebglAddon: any;\r\ndeclare const WebLinksAddon: any;\r\ndeclare const SearchAddon: any;\r\n\r\nimport { initSearchForTerminal, showSearch, isSearchVisible, hideSearch, cleanupSearchForTerminal } from './search';\r\n\r\n// Forward declarations for functions from other modules\r\nlet sendInput: (sessionId: string, data: string) => void = () => {};\r\nlet showBellNotification: (sessionId: string) => void = () => {};\r\nlet requestBufferRefresh: (sessionId: string) => void = () => {};\r\n\r\n// Debounce timers for auto-rename from shell title\r\nconst pendingTitleUpdates = new Map<string, number>();\r\n\r\n/**\r\n * Bracketed Paste Mode (BPM) State Tracking\r\n *\r\n * BPM allows TUI apps to distinguish pasted text from typed input by wrapping\r\n * pastes with escape sequences: ESC[200~ (start) and ESC[201~ (end).\r\n *\r\n * HOW IT WORKS WITH COMPLEX TUIs (e.g., Claude Code):\r\n * 1. Shell/app enables BPM by outputting ESC[?2004h\r\n * 2. We detect this in terminal output and track state per session\r\n * 3. When user pastes (or drops file), we wrap content with BPM markers\r\n * 4. TUI app receives markers and knows it's pasted content\r\n *\r\n * IMAGE DRAG-DROP TO CLAUDE CODE:\r\n * Claude Code detects dropped images via string heuristics - it pattern-matches\r\n * for file paths like: ^\"?[A-Z]:\\\\.*?\\.(png|jpg|jpeg|webp|gif)\"?$\r\n * When detected, it reads the file and adds it to context as an image.\r\n *\r\n * CRITICAL FOR WINDOWS: Claude Code checks environment variables to detect\r\n * if it's running in Windows Terminal. See ShellConfigurations.cs for details.\r\n * - WT_PROFILE_ID must have curly braces: {guid-here}\r\n * - TERM and COLORTERM must NOT be set (Windows Terminal doesn't set them)\r\n *\r\n * FOR MAC/LINUX TESTING: The env var requirements may differ. Start by checking\r\n * what environment a native terminal sets, then match it in ShellConfigurations.cs.\r\n * The BPM mechanism itself should work the same across platforms.\r\n *\r\n * We track BPM ourselves AND check xterm.js internal state as fallback because\r\n * xterm.js detection alone proved unreliable in some scenarios.\r\n */\r\nconst bracketedPasteState = new Map<string, boolean>();\r\n\r\n/**\r\n * Auto-update session name from shell title (with debounce)\r\n */\r\nfunction updateSessionNameAuto(sessionId: string, name: string): void {\r\n  const session = sessions.find(s => s.id === sessionId);\r\n  if (session?.manuallyNamed) return;\r\n\r\n  const existing = pendingTitleUpdates.get(sessionId);\r\n  if (existing) {\r\n    window.clearTimeout(existing);\r\n  }\r\n\r\n  const timer = window.setTimeout(() => {\r\n    pendingTitleUpdates.delete(sessionId);\r\n    fetch(`/api/sessions/${sessionId}/name?auto=true`, {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ name })\r\n    }).catch(() => {});\r\n  }, 500);\r\n\r\n  pendingTitleUpdates.set(sessionId, timer);\r\n}\r\n\r\n/**\r\n * Register callbacks from other modules\r\n */\r\nexport function registerTerminalCallbacks(callbacks: {\r\n  sendInput?: (sessionId: string, data: string) => void;\r\n  showBellNotification?: (sessionId: string) => void;\r\n  requestBufferRefresh?: (sessionId: string) => void;\r\n}): void {\r\n  if (callbacks.sendInput) sendInput = callbacks.sendInput;\r\n  if (callbacks.showBellNotification) showBellNotification = callbacks.showBellNotification;\r\n  if (callbacks.requestBufferRefresh) requestBufferRefresh = callbacks.requestBufferRefresh;\r\n}\r\n\r\n/**\r\n * Get terminal options based on current settings\r\n */\r\nexport function getTerminalOptions(): object {\r\n  const isMobile = window.innerWidth <= MOBILE_BREAKPOINT;\r\n  const baseFontSize = currentSettings?.fontSize ?? 14;\r\n  const fontSize = isMobile ? Math.max(baseFontSize - 2, 10) : baseFontSize;\r\n  const themeName = currentSettings?.theme ?? 'dark';\r\n  const fontFamily = currentSettings?.fontFamily ?? 'Cascadia Code';\r\n\r\n  const options: Record<string, unknown> = {\r\n    cursorBlink: currentSettings?.cursorBlink ?? true,\r\n    cursorStyle: currentSettings?.cursorStyle ?? 'bar',\r\n    cursorInactiveStyle: 'none',\r\n    fontFamily: `'${fontFamily}', ${TERMINAL_FONT_STACK}`,\r\n    fontSize: fontSize,\r\n    letterSpacing: 0,\r\n    lineHeight: 1,\r\n    scrollback: currentSettings?.scrollbackLines ?? 10000,\r\n    minimumContrastRatio: currentSettings?.minimumContrastRatio ?? 1,\r\n    smoothScrollDuration: currentSettings?.smoothScrolling ? 150 : 0,\r\n    allowProposedApi: true,\r\n    customGlyphs: true,\r\n    rescaleOverlappingGlyphs: true,\r\n    theme: THEMES[themeName] ?? THEMES.dark\r\n  };\r\n\r\n  // Configure ConPTY for Windows - use server-provided build or detect from userAgent\r\n  const isWindows = /Windows|Win32|Win64/i.test(navigator.userAgent);\r\n  if (windowsBuildNumber !== null) {\r\n    options.windowsPty = {\r\n      backend: 'conpty',\r\n      buildNumber: windowsBuildNumber\r\n    };\r\n  } else if (isWindows) {\r\n    // Default to Windows 10 2004 (19041) which has stable ConPTY support\r\n    // This ensures proper VT sequence interpretation before health check completes\r\n    options.windowsPty = {\r\n      backend: 'conpty',\r\n      buildNumber: 19041\r\n    };\r\n  }\r\n\r\n  return options;\r\n}\r\n\r\n/**\r\n * Create a terminal instance for a session.\r\n * Returns existing state if terminal already exists.\r\n */\r\nexport function createTerminalForSession(\r\n  sessionId: string,\r\n  sessionInfo: Session | undefined\r\n): TerminalState {\r\n  const existing = sessionTerminals.get(sessionId);\r\n  if (existing) {\r\n    return existing;\r\n  }\r\n\r\n  // Create container\r\n  const container = document.createElement('div');\r\n  container.className = 'terminal-container hidden';\r\n  container.id = 'terminal-' + sessionId;\r\n  dom.terminalsArea?.appendChild(container);\r\n\r\n  // Set up file drop handler for drag-and-drop uploads\r\n  setupFileDrop(container);\r\n\r\n  // Initialize xterm.js\r\n  const terminal = new Terminal(getTerminalOptions());\r\n  const fitAddon = new FitAddon.FitAddon();\r\n  terminal.loadAddon(fitAddon);\r\n\r\n  // Get server dimensions from session info (if available)\r\n  const serverCols = sessionInfo && sessionInfo.cols > 0 ? sessionInfo.cols : 0;\r\n  const serverRows = sessionInfo && sessionInfo.rows > 0 ? sessionInfo.rows : 0;\r\n\r\n  const state: TerminalState = {\r\n    terminal: terminal,\r\n    fitAddon: fitAddon,\r\n    container: container,\r\n    serverCols: serverCols,\r\n    serverRows: serverRows,\r\n    opened: false\r\n  };\r\n\r\n  sessionTerminals.set(sessionId, state);\r\n\r\n  // Wait for fonts to be ready before opening terminal\r\n  // This ensures xterm.js measures the correct font for canvas rendering\r\n  (fontsReadyPromise ?? Promise.resolve()).then(() => {\r\n    if (!sessionTerminals.has(sessionId)) return; // Session was deleted\r\n    terminal.open(container);\r\n    state.opened = true;\r\n\r\n    // Load WebGL addon for GPU-accelerated rendering (with fallback)\r\n    if (currentSettings?.useWebGL !== false) {\r\n      try {\r\n        const webglAddon = new WebglAddon.WebglAddon();\r\n        webglAddon.onContextLost(() => {\r\n          webglAddon.dispose();\r\n        });\r\n        terminal.loadAddon(webglAddon);\r\n      } catch {\r\n        // WebGL not available, using canvas renderer\r\n      }\r\n    }\r\n\r\n    // Load Web-Links addon for clickable URLs\r\n    try {\r\n      const webLinksAddon = new WebLinksAddon.WebLinksAddon(\r\n        (_event: MouseEvent, uri: string) => {\r\n          if (uri.startsWith('http://') || uri.startsWith('https://')) {\r\n            window.open(uri, '_blank', 'noopener,noreferrer');\r\n          }\r\n        }\r\n      );\r\n      terminal.loadAddon(webLinksAddon);\r\n    } catch {\r\n      // Web-Links addon failed to load\r\n    }\r\n\r\n    // Load Search addon for Ctrl+F search\r\n    initSearchForTerminal(sessionId, terminal);\r\n\r\n    // Replay any WebSocket frames that arrived before terminal was opened\r\n    replayPendingFrames(sessionId, state);\r\n\r\n    // Defer resize to next frame - xterm.js needs a frame to fully initialize after open()\r\n    requestAnimationFrame(() => {\r\n      if (!sessionTerminals.has(sessionId)) return; // Session was deleted\r\n\r\n      // Fit terminal to current viewport using actual measured cell dimensions\r\n      fitSessionToScreen(sessionId);\r\n\r\n      setupTerminalEvents(sessionId, terminal, container);\r\n    });\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\n/**\r\n * Replay pending output frames that arrived before terminal was opened\r\n */\r\nfunction replayPendingFrames(sessionId: string, state: TerminalState): void {\r\n  const frames = pendingOutputFrames.get(sessionId);\r\n  if (frames && frames.length > 0) {\r\n    frames.forEach((payload) => {\r\n      writeOutputFrame(sessionId, state, payload);\r\n    });\r\n    pendingOutputFrames.delete(sessionId);\r\n  }\r\n}\r\n\r\n/**\r\n * Write an output frame to the terminal, handling dimension updates\r\n */\r\nexport function writeOutputFrame(\r\n  sessionId: string,\r\n  state: TerminalState,\r\n  payload: Uint8Array\r\n): void {\r\n  const frame = parseOutputFrame(payload);\r\n\r\n  // Track bracketed paste mode by detecting escape sequences in output\r\n  // Apps send \\x1b[?2004h to enable and \\x1b[?2004l to disable\r\n  if (frame.data.length > 0) {\r\n    const text = new TextDecoder().decode(frame.data);\r\n\r\n    // Check for bracketed paste mode sequences (multiple formats)\r\n    // ESC[?2004h = enable, ESC[?2004l = disable\r\n    const enableMatch = text.includes('\\x1b[?2004h') || text.includes('\\u001b[?2004h');\r\n    const disableMatch = text.includes('\\x1b[?2004l') || text.includes('\\u001b[?2004l');\r\n\r\n    if (enableMatch) {\r\n      bracketedPasteState.set(sessionId, true);\r\n    }\r\n    if (disableMatch) {\r\n      bracketedPasteState.set(sessionId, false);\r\n    }\r\n  }\r\n\r\n  // Ensure terminal matches frame dimensions before writing\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const core = (state.terminal as any)._core;\r\n  if (frame.valid && core && core._renderService) {\r\n    const currentCols = state.terminal.cols;\r\n    const currentRows = state.terminal.rows;\r\n\r\n    if (currentCols !== frame.cols || currentRows !== frame.rows) {\r\n      try {\r\n        state.terminal.resize(frame.cols, frame.rows);\r\n        state.serverCols = frame.cols;\r\n        state.serverRows = frame.rows;\r\n        applyTerminalScaling(sessionId, state);\r\n      } catch {\r\n        // Ignore resize errors - terminal may not be fully initialized\r\n      }\r\n    }\r\n  }\r\n\r\n  // Write terminal data\r\n  if (frame.data.length > 0) {\r\n    state.terminal.write(frame.data);\r\n  }\r\n}\r\n\r\n/**\r\n * Set up terminal event handlers for input, bell, selection, etc.\r\n */\r\nexport function setupTerminalEvents(\r\n  sessionId: string,\r\n  terminal: any,\r\n  container: HTMLDivElement\r\n): void {\r\n  // Wire up events\r\n  terminal.onData((data: string) => {\r\n    sendInput(sessionId, data);\r\n  });\r\n\r\n  terminal.onBell(() => {\r\n    showBellNotification(sessionId);\r\n  });\r\n\r\n  terminal.onSelectionChange(() => {\r\n    if (currentSettings?.copyOnSelect && terminal.hasSelection()) {\r\n      navigator.clipboard.writeText(terminal.getSelection()).catch(() => {});\r\n    }\r\n  });\r\n\r\n  // Auto-update session name from shell title\r\n  terminal.onTitleChange((title: string) => {\r\n    if (title && title.trim()) {\r\n      updateSessionNameAuto(sessionId, title.trim());\r\n    }\r\n  });\r\n\r\n  // Keyboard shortcuts for copy/paste\r\n  terminal.attachCustomKeyEventHandler((e: KeyboardEvent) => {\r\n    if (e.type !== 'keydown') return true;\r\n\r\n    // Ctrl+Enter: Send LF (\\n) instead of CR (\\r) for TUI apps that use it for line breaks\r\n    if (e.ctrlKey && !e.shiftKey && !e.altKey && !e.metaKey && e.key === 'Enter') {\r\n      sendInput(sessionId, '\\n');\r\n      return false;\r\n    }\r\n\r\n    const style = getClipboardStyle(currentSettings?.clipboardShortcuts ?? 'auto');\r\n\r\n    if (style === 'windows') {\r\n      // Ctrl+C: copy if selected, else let terminal handle (SIGINT)\r\n      if (e.ctrlKey && !e.shiftKey && e.key === 'c') {\r\n        if (terminal.hasSelection()) {\r\n          navigator.clipboard.writeText(terminal.getSelection()).catch(() => {});\r\n          terminal.clearSelection();\r\n          return false;\r\n        }\r\n        return true;\r\n      }\r\n      // Ctrl+V: paste (images uploaded, text pasted)\r\n      if (e.ctrlKey && !e.shiftKey && e.key === 'v') {\r\n        handleClipboardPaste(sessionId);\r\n        return false;\r\n      }\r\n    } else {\r\n      // Unix: Ctrl+Shift+C to copy\r\n      if (e.ctrlKey && e.shiftKey && (e.key === 'C' || e.key === 'c')) {\r\n        if (terminal.hasSelection()) {\r\n          navigator.clipboard.writeText(terminal.getSelection()).catch(() => {});\r\n          terminal.clearSelection();\r\n        }\r\n        return false;\r\n      }\r\n      // Unix: Ctrl+Shift+V to paste (images uploaded, text pasted)\r\n      if (e.ctrlKey && e.shiftKey && (e.key === 'V' || e.key === 'v')) {\r\n        handleClipboardPaste(sessionId);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // Ctrl+F / Cmd+F: Open search\r\n    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {\r\n      showSearch();\r\n      return false;\r\n    }\r\n\r\n    // Escape: Close search if open\r\n    if (e.key === 'Escape' && isSearchVisible()) {\r\n      hideSearch();\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  });\r\n\r\n  // Prevent browser paste event - we handle it ourselves via handleClipboardPaste\r\n  // This prevents xterm.js from also handling paste via onData\r\n  // Use capture phase to intercept before xterm.js\r\n  const pasteHandler = (e: ClipboardEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n  };\r\n  container.addEventListener('paste', pasteHandler, true);\r\n\r\n  // Right-click paste (images uploaded, text pasted)\r\n  const contextMenuHandler = (e: MouseEvent) => {\r\n    if (!currentSettings || currentSettings.rightClickPaste !== false) {\r\n      e.preventDefault();\r\n      handleClipboardPaste(sessionId);\r\n    }\r\n  };\r\n\r\n  container.addEventListener('contextmenu', contextMenuHandler);\r\n\r\n  // Store handler references for cleanup\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (state) {\r\n    state.contextMenuHandler = contextMenuHandler;\r\n    state.pasteHandler = pasteHandler;\r\n  }\r\n}\r\n\r\n/**\r\n * Destroy a terminal for a session and clean up resources\r\n */\r\nexport function destroyTerminalForSession(sessionId: string): void {\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (!state) return;\r\n\r\n  // Clean up event listeners\r\n  if (state.contextMenuHandler) {\r\n    state.container.removeEventListener('contextmenu', state.contextMenuHandler);\r\n  }\r\n  if (state.pasteHandler) {\r\n    state.container.removeEventListener('paste', state.pasteHandler, true);\r\n  }\r\n\r\n  // Clean up search addon state\r\n  cleanupSearchForTerminal(sessionId);\r\n\r\n  // Clean up pending title update timer\r\n  const titleTimer = pendingTitleUpdates.get(sessionId);\r\n  if (titleTimer) {\r\n    clearTimeout(titleTimer);\r\n    pendingTitleUpdates.delete(sessionId);\r\n  }\r\n\r\n  state.terminal.dispose();\r\n  state.container.remove();\r\n  sessionTerminals.delete(sessionId);\r\n  pendingOutputFrames.delete(sessionId);\r\n  bracketedPasteState.delete(sessionId);\r\n}\r\n\r\n/**\r\n * Paste text to a terminal, wrapping with bracketed paste markers if enabled.\r\n * We track BPM state ourselves to ensure reliable paste handling for TUI apps.\r\n *\r\n * @param isFilePath - If true, wrap content in quotes for file path handling.\r\n *                     This helps TUI apps like Claude Code detect file paths with spaces.\r\n */\r\nexport function pasteToTerminal(sessionId: string, data: string, isFilePath: boolean = false): void {\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (!state) return;\r\n\r\n  // Check all BPM tracking sources: local replay tracking, muxChannel live tracking, and xterm.js\r\n  const localBpm = bracketedPasteState.get(sessionId) ?? false;\r\n  const muxBpm = isBracketedPasteEnabled(sessionId);\r\n  const xtermBpm = (state.terminal as any).modes?.bracketedPasteMode ?? false;\r\n  const bpmEnabled = localBpm || muxBpm || xtermBpm;\r\n\r\n  if (bpmEnabled) {\r\n    // Manually wrap with bracketed paste sequences and send via input\r\n    // Only quote file paths (for Claude Code image detection with spaces in path)\r\n    const content = isFilePath ? '\"' + data + '\"' : data;\r\n    const wrapped = '\\x1b[200~' + content + '\\x1b[201~';\r\n    sendInput(sessionId, wrapped);\r\n  } else {\r\n    // No bracketed paste mode - use standard paste\r\n    state.terminal.paste(data);\r\n  }\r\n}\r\n\r\n/**\r\n * Apply current settings to all existing terminals\r\n */\r\nexport function applySettingsToTerminals(): void {\r\n  const options = getTerminalOptions();\r\n  sessionTerminals.forEach((state) => {\r\n    state.terminal.options.cursorBlink = (options as any).cursorBlink;\r\n    state.terminal.options.cursorStyle = (options as any).cursorStyle;\r\n    state.terminal.options.fontSize = (options as any).fontSize;\r\n    state.terminal.options.theme = (options as any).theme;\r\n  });\r\n}\r\n\r\n/**\r\n * Refresh the active terminal buffer by clearing and requesting via WebSocket.\r\n * Using WebSocket ensures the buffer arrives in-order with live terminal data.\r\n */\r\nexport function refreshActiveTerminalBuffer(): void {\r\n  if (!activeSessionId) return;\r\n  const state = sessionTerminals.get(activeSessionId);\r\n  if (state && state.opened) {\r\n    state.terminal.clear();\r\n    requestBufferRefresh(activeSessionId);\r\n  }\r\n}\r\n\r\n/**\r\n * Preload the terminal font for consistent rendering\r\n */\r\nexport function preloadTerminalFont(): Promise<void> {\r\n  const promise = document.fonts.ready.then(() => {\r\n    // Trigger font load by measuring with the font family\r\n    const testSpan = document.createElement('span');\r\n    testSpan.style.fontFamily = TERMINAL_FONT_STACK;\r\n    testSpan.style.position = 'absolute';\r\n    testSpan.style.left = '-9999px';\r\n    testSpan.textContent = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    document.body.appendChild(testSpan);\r\n\r\n    return new Promise<void>((resolve) => {\r\n      requestAnimationFrame(() => {\r\n        testSpan.remove();\r\n        resolve();\r\n      });\r\n    });\r\n  });\r\n\r\n  setFontsReadyPromise(promise);\r\n  return promise;\r\n}\r\n", "/**\r\n * Terminal Scaling Module\r\n *\r\n * Handles terminal scaling, fitting to screen, and viewport resize handling.\r\n * Terminals maintain server-side dimensions and are scaled to fit the viewport.\r\n */\r\n\r\nimport type { TerminalState } from '../../types';\r\nimport {\r\n  TERMINAL_PADDING,\r\n  MIN_TERMINAL_COLS,\r\n  MIN_TERMINAL_ROWS,\r\n  MAX_TERMINAL_COLS,\r\n  MAX_TERMINAL_ROWS\r\n} from '../../constants';\r\nimport {\r\n  sessionTerminals,\r\n  fontsReadyPromise,\r\n  dom\r\n} from '../../state';\r\n\r\n// Forward declarations for functions from other modules\r\nlet sendResize: (sessionId: string, terminal: any) => void = () => {};\r\n\r\n/**\r\n * Register callbacks from other modules\r\n */\r\nexport function registerScalingCallbacks(callbacks: {\r\n  sendResize?: (sessionId: string, terminal: any) => void;\r\n}): void {\r\n  if (callbacks.sendResize) sendResize = callbacks.sendResize;\r\n}\r\n\r\n/**\r\n * Fit a session's terminal to the current screen size.\r\n * This sends a resize request to the server.\r\n *\r\n * Uses direct measurement of terminalsArea via getBoundingClientRect() rather than\r\n * FitAddon's measurement of the terminal container. This avoids timing issues where\r\n * clearing zoom/scale causes layout to be in flux when measurements occur.\r\n */\r\nexport function fitSessionToScreen(sessionId: string): void {\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (!state) return;\r\n\r\n  // Wait for terminal to be opened before fitting\r\n  if (!state.opened) {\r\n    (fontsReadyPromise ?? Promise.resolve()).then(() => {\r\n      fitSessionToScreen(sessionId);\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Clear any existing scaling first\r\n  const xterm = state.container.querySelector('.xterm') as HTMLElement | null;\r\n  if (xterm) {\r\n    (xterm.style as any).zoom = '';\r\n    xterm.style.transform = '';\r\n    state.container.classList.remove('scaled');\r\n  }\r\n\r\n  // Ensure terminal is visible for accurate measurement\r\n  const wasHidden = state.container.classList.contains('hidden');\r\n  if (wasHidden) {\r\n    state.container.classList.remove('hidden');\r\n  }\r\n\r\n  // Measure terminalsArea directly - this gives us the actual visible area\r\n  // regardless of any layout complexities with the terminal container\r\n  const rect = dom.terminalsArea?.getBoundingClientRect();\r\n  if (!rect || rect.width < 100 || rect.height < 100) {\r\n    if (wasHidden) {\r\n      state.container.classList.add('hidden');\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Get cell dimensions from xterm's render service\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const renderService = (state.terminal as any)._core?._renderService;\r\n  const cellWidth = renderService?.dimensions?.css?.cell?.width;\r\n  const cellHeight = renderService?.dimensions?.css?.cell?.height;\r\n\r\n  if (!cellWidth || !cellHeight) {\r\n    // Fallback to FitAddon if render service isn't ready\r\n    requestAnimationFrame(() => {\r\n      try {\r\n        const dims = state.fitAddon.proposeDimensions();\r\n        if (dims?.cols && dims?.rows) {\r\n          state.fitAddon.fit();\r\n          sendResize(sessionId, state.terminal);\r\n        }\r\n      } catch {\r\n        // FitAddon may fail if terminal render service isn't initialized\r\n      }\r\n\r\n      if (wasHidden) {\r\n        state.container.classList.add('hidden');\r\n      }\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Calculate available space (accounting for container padding)\r\n  const availWidth = rect.width - TERMINAL_PADDING;\r\n  const availHeight = rect.height - TERMINAL_PADDING;\r\n\r\n  // Calculate cols/rows that fit in available space\r\n  let cols = Math.floor(availWidth / cellWidth);\r\n  let rows = Math.floor(availHeight / cellHeight);\r\n\r\n  // Clamp to valid range\r\n  cols = Math.max(MIN_TERMINAL_COLS, Math.min(cols, MAX_TERMINAL_COLS));\r\n  rows = Math.max(MIN_TERMINAL_ROWS, Math.min(rows, MAX_TERMINAL_ROWS));\r\n\r\n  // Resize terminal and notify server\r\n  requestAnimationFrame(() => {\r\n    try {\r\n      if (state.terminal.cols !== cols || state.terminal.rows !== rows) {\r\n        state.terminal.resize(cols, rows);\r\n        sendResize(sessionId, state.terminal);\r\n      }\r\n    } catch {\r\n      // Resize may fail if terminal is disposed\r\n    }\r\n\r\n    if (wasHidden) {\r\n      state.container.classList.add('hidden');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Apply CSS scaling to a terminal to fit within its container.\r\n * Scales down terminals that are larger than the available space.\r\n * Uses CSS zoom instead of transform:scale for better pixel alignment.\r\n */\r\nexport function applyTerminalScaling(_sessionId: string, state: TerminalState): void {\r\n  const container = state.container;\r\n  const xterm = container.querySelector('.xterm') as HTMLElement | null;\r\n  if (!xterm) return;\r\n\r\n  // Use requestAnimationFrame for accurate measurements after resize\r\n  requestAnimationFrame(() => {\r\n    const availWidth = container.clientWidth - 8;\r\n    const availHeight = container.clientHeight - 8;\r\n    const termWidth = xterm.offsetWidth;\r\n    const termHeight = xterm.offsetHeight;\r\n\r\n    // Calculate scale (shrink only, never enlarge)\r\n    const scaleX = availWidth / termWidth;\r\n    const scaleY = availHeight / termHeight;\r\n    const scale = Math.min(scaleX, scaleY, 1);\r\n\r\n    if (scale < 0.99) {\r\n      // Use zoom instead of transform:scale for better pixel alignment\r\n      // zoom respects pixel boundaries, transform can cause subpixel rendering\r\n      (xterm.style as any).zoom = scale;\r\n      xterm.style.transform = '';\r\n      container.classList.add('scaled');\r\n    } else {\r\n      (xterm.style as any).zoom = '';\r\n      xterm.style.transform = '';\r\n      container.classList.remove('scaled');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Recalculate scaling for all open terminals\r\n */\r\nexport function rescaleAllTerminals(): void {\r\n  sessionTerminals.forEach((state, sessionId) => {\r\n    if (state.opened) {\r\n      applyTerminalScaling(sessionId, state);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Set up resize observer to recalculate scaling when window resizes\r\n */\r\nexport function setupResizeObserver(): void {\r\n  window.addEventListener('resize', rescaleAllTerminals);\r\n}\r\n\r\n/**\r\n * Set up visual viewport handling for mobile keyboard appearance.\r\n * Updates viewport height CSS variable when visual viewport changes.\r\n */\r\nexport function setupVisualViewport(): void {\r\n  if (!window.visualViewport || !dom.terminalsArea) return;\r\n\r\n  let lastHeight = 0;\r\n\r\n  const updateViewportHeight = () => {\r\n    const vh = window.visualViewport!.height;\r\n    if (Math.abs(vh - lastHeight) < 1) return;\r\n    lastHeight = vh;\r\n\r\n    document.documentElement.style.setProperty('--visual-vh', vh + 'px');\r\n\r\n    const mobileHeader = document.querySelector('.mobile-header') as HTMLElement | null;\r\n    let headerHeight = 0;\r\n    if (mobileHeader && window.getComputedStyle(mobileHeader).display !== 'none') {\r\n      headerHeight = mobileHeader.offsetHeight;\r\n    }\r\n\r\n    const availableHeight = Math.floor((vh - headerHeight) * 0.99);\r\n    dom.terminalsArea!.style.height = availableHeight + 'px';\r\n  };\r\n\r\n  window.visualViewport.addEventListener('resize', updateViewportHeight);\r\n  updateViewportHeight();\r\n}\r\n", "/**\r\n * File Drop Module\r\n *\r\n * Handles drag-and-drop file uploads and clipboard image paste.\r\n * Files are uploaded to the server and the resulting path is inserted into the terminal.\r\n */\r\n\r\nimport { activeSessionId } from '../../state';\r\n\r\n// =============================================================================\r\n// Constants\r\n// =============================================================================\r\n\r\nconst TEXT_FILE_SIZE_LIMIT = 40 * 1024; // 40KB\r\n\r\nconst IMAGE_EXTENSIONS = new Set([\r\n  '.png', '.jpg', '.jpeg', '.gif', '.bmp', '.webp',\r\n  '.svg', '.ico', '.tiff', '.tif', '.heic', '.heif', '.avif'\r\n]);\r\n\r\nconst REJECTED_EXTENSIONS = new Set([\r\n  // Documents\r\n  '.pdf', '.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx',\r\n  '.odt', '.ods', '.odp', '.rtf',\r\n  // Executables/binaries\r\n  '.exe', '.dll', '.so', '.dylib', '.app', '.msi', '.deb', '.rpm', '.dmg', '.iso',\r\n  // Archives\r\n  '.zip', '.tar', '.gz', '.7z', '.rar', '.bz2', '.xz', '.tgz',\r\n  // Binary data\r\n  '.bin', '.dat', '.db', '.sqlite', '.sqlite3',\r\n  // Media (non-image)\r\n  '.mp3', '.mp4', '.wav', '.avi', '.mov', '.mkv', '.flac', '.ogg', '.webm'\r\n]);\r\n\r\n// =============================================================================\r\n// Forward declarations for callbacks\r\n// =============================================================================\r\n\r\nlet pasteToTerminal: (sessionId: string, data: string, isFilePath?: boolean) => void = () => {};\r\n\r\n// =============================================================================\r\n// Helper Functions\r\n// =============================================================================\r\n\r\nfunction getFileExtension(filename: string): string {\r\n  const lastDot = filename.lastIndexOf('.');\r\n  return lastDot >= 0 ? filename.slice(lastDot).toLowerCase() : '';\r\n}\r\n\r\nfunction isImageFile(filename: string): boolean {\r\n  return IMAGE_EXTENSIONS.has(getFileExtension(filename));\r\n}\r\n\r\nfunction isRejectedFile(filename: string): boolean {\r\n  return REJECTED_EXTENSIONS.has(getFileExtension(filename));\r\n}\r\n\r\nfunction showDropToast(message: string): void {\r\n  const existing = document.querySelector('.drop-toast');\r\n  if (existing) existing.remove();\r\n\r\n  const toast = document.createElement('div');\r\n  toast.className = 'drop-toast error';\r\n  toast.textContent = message;\r\n  document.body.appendChild(toast);\r\n\r\n  setTimeout(() => {\r\n    toast.classList.add('hiding');\r\n    setTimeout(() => toast.remove(), 300);\r\n  }, 3000);\r\n}\r\n\r\nasync function readFileAsText(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onload = () => resolve(reader.result as string);\r\n    reader.onerror = () => reject(reader.error);\r\n    reader.readAsText(file);\r\n  });\r\n}\r\n\r\n/**\r\n * Sanitize pasted content to:\r\n * 1. Normalize line endings (CRLF/CR \u2192 LF) to prevent interleaved empty lines\r\n * 2. Strip all escape sequences to prevent \"appears then deleted\" bugs\r\n * 3. Remove BPM markers to prevent paste escape attacks\r\n *\r\n * BPM markers are re-added by pasteToTerminal() after sanitization.\r\n */\r\nfunction sanitizePasteContent(text: string): string {\r\n  return text\r\n    .replace(/\\r\\n/g, '\\n')                     // Normalize CRLF \u2192 LF first\r\n    .replace(/\\r(?!\\n)/g, '\\n')                 // Normalize CR \u2192 LF (Mac Classic)\r\n    .replace(/\\x1b\\[[0-9;]*[A-Za-z]/g, '')      // Remove CSI sequences (colors, cursor, clear)\r\n    .replace(/\\x1b\\][^\\x07]*\\x07/g, '')         // Remove OSC sequences (titles, hyperlinks)\r\n    .replace(/\\x1b[PX^_][^\\x1b]*\\x1b\\\\/g, '')   // Remove DCS/SOS/PM/APC sequences\r\n    .replace(/\\x1b[\\x20-\\x2F]*[\\x30-\\x7E]/g, ''); // Remove other escape sequences\r\n}\r\n\r\n/**\r\n * Register callbacks from mux channel and terminal manager\r\n */\r\nexport function registerFileDropCallbacks(callbacks: {\r\n  sendInput?: (sessionId: string, data: string) => void;\r\n  pasteToTerminal?: (sessionId: string, data: string, isFilePath?: boolean) => void;\r\n}): void {\r\n  if (callbacks.pasteToTerminal) pasteToTerminal = callbacks.pasteToTerminal;\r\n}\r\n\r\n/**\r\n * Upload a file to the server for the given session\r\n */\r\nasync function uploadFile(sessionId: string, file: File): Promise<string | null> {\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n\r\n  try {\r\n    const response = await fetch(`/api/sessions/${sessionId}/upload`, {\r\n      method: 'POST',\r\n      body: formData\r\n    });\r\n\r\n    if (!response.ok) {\r\n      console.error('File upload failed:', response.status);\r\n      return null;\r\n    }\r\n\r\n    const result = await response.json();\r\n    return result.path;\r\n  } catch (error) {\r\n    console.error('File upload error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle file drop - routes to appropriate handler based on file type:\r\n * - Image files: upload and paste path\r\n * - Rejected files (pdf, exe, etc.): show error toast\r\n * - Text files: read content and paste (with 40KB limit)\r\n */\r\nasync function handleFileDrop(files: FileList): Promise<void> {\r\n  if (!activeSessionId || files.length === 0) return;\r\n\r\n  const imagePaths: string[] = [];\r\n\r\n  for (const file of Array.from(files)) {\r\n    // Image files: upload and collect path\r\n    if (isImageFile(file.name)) {\r\n      const path = await uploadFile(activeSessionId, file);\r\n      if (path) imagePaths.push(path);\r\n      continue;\r\n    }\r\n\r\n    // Rejected files: show error toast\r\n    if (isRejectedFile(file.name)) {\r\n      const ext = getFileExtension(file.name);\r\n      showDropToast(`Cannot paste ${ext} files`);\r\n      continue;\r\n    }\r\n\r\n    // Text files: check size limit\r\n    if (file.size > TEXT_FILE_SIZE_LIMIT) {\r\n      showDropToast(`File too large (max 40KB): ${file.name}`);\r\n      continue;\r\n    }\r\n\r\n    // Read and paste text content\r\n    try {\r\n      const content = await readFileAsText(file);\r\n      const sanitized = sanitizePasteContent(content);\r\n      pasteToTerminal(activeSessionId, sanitized, false);\r\n    } catch (err) {\r\n      console.error(`[FileDrop] Failed to read file: ${file.name}`, err);\r\n      showDropToast(`Failed to read: ${file.name}`);\r\n    }\r\n  }\r\n\r\n  // Paste collected image paths (if any)\r\n  if (imagePaths.length > 0) {\r\n    const joined = sanitizePasteContent(imagePaths.join(' '));\r\n    pasteToTerminal(activeSessionId, joined, true);\r\n  }\r\n}\r\n\r\n/**\r\n * Set up drag-and-drop handlers for a terminal container\r\n */\r\nexport function setupFileDrop(container: HTMLElement): void {\r\n  // Prevent default drag behaviors\r\n  container.addEventListener('dragover', (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.classList.add('drag-over');\r\n  });\r\n\r\n  container.addEventListener('dragleave', (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.classList.remove('drag-over');\r\n  });\r\n\r\n  container.addEventListener('dragend', () => {\r\n    container.classList.remove('drag-over');\r\n  });\r\n\r\n  // Handle drop\r\n  container.addEventListener('drop', async (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.classList.remove('drag-over');\r\n\r\n    const files = e.dataTransfer?.files;\r\n    if (files && files.length > 0) {\r\n      await handleFileDrop(files);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Handle clipboard paste - checks for images first, falls back to text\r\n * Used by the keyboard handler in manager.ts\r\n */\r\nexport async function handleClipboardPaste(sessionId: string): Promise<void> {\r\n  // Try to read clipboard items (images)\r\n  try {\r\n    const items = await navigator.clipboard.read();\r\n    for (const item of items) {\r\n      const imageType = item.types.find(t => t.startsWith('image/'));\r\n      if (imageType) {\r\n        const blob = await item.getType(imageType);\r\n        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n        const file = new File([blob], `clipboard_${timestamp}.jpg`, { type: imageType });\r\n        const path = await uploadFile(sessionId, file);\r\n        if (path) {\r\n          pasteToTerminal(sessionId, sanitizePasteContent(path), true);\r\n          return; // Image handled, don't paste text\r\n        }\r\n      }\r\n    }\r\n  } catch {\r\n    // clipboard.read() not supported or failed, fall through to text paste\r\n  }\r\n\r\n  // No image found or image handling failed, paste text\r\n  try {\r\n    const text = await navigator.clipboard.readText();\r\n    if (text) {\r\n      const sanitized = sanitizePasteContent(text);\r\n      pasteToTerminal(sessionId, sanitized);\r\n    }\r\n  } catch {\r\n    // Text paste failed\r\n  }\r\n}\r\n", "/**\r\n * Terminal Search Module\r\n *\r\n * Handles xterm.js search addon functionality, including the search UI,\r\n * keyboard shortcuts, and search result navigation.\r\n */\r\n\r\nimport { sessionTerminals, activeSessionId } from '../../state';\r\n\r\ndeclare const SearchAddon: any;\r\n\r\ninterface SearchState {\r\n  addon: any;\r\n  currentIndex: number;\r\n  totalMatches: number;\r\n}\r\n\r\nconst searchStates = new Map<string, SearchState>();\r\n\r\nlet searchVisible = false;\r\nlet searchInput: HTMLInputElement | null = null;\r\nlet searchResults: HTMLElement | null = null;\r\nlet searchContainer: HTMLElement | null = null;\r\n\r\n/**\r\n * Initialize search addon for a terminal\r\n */\r\nexport function initSearchForTerminal(sessionId: string, terminal: any): void {\r\n  try {\r\n    const addon = new SearchAddon.SearchAddon();\r\n    terminal.loadAddon(addon);\r\n    searchStates.set(sessionId, { addon, currentIndex: 0, totalMatches: 0 });\r\n  } catch {\r\n    // Search addon failed to load\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up search state for a session\r\n */\r\nexport function cleanupSearchForTerminal(sessionId: string): void {\r\n  searchStates.delete(sessionId);\r\n}\r\n\r\n/**\r\n * Show the search UI\r\n */\r\nexport function showSearch(): void {\r\n  if (!searchContainer) {\r\n    searchContainer = document.getElementById('terminal-search');\r\n    searchInput = document.getElementById('search-input') as HTMLInputElement;\r\n    searchResults = document.getElementById('search-results');\r\n  }\r\n\r\n  if (searchContainer && searchInput) {\r\n    searchContainer.classList.remove('hidden');\r\n    searchVisible = true;\r\n    searchInput.focus();\r\n    searchInput.select();\r\n  }\r\n}\r\n\r\n/**\r\n * Hide the search UI\r\n */\r\nexport function hideSearch(): void {\r\n  if (searchContainer) {\r\n    searchContainer.classList.add('hidden');\r\n    searchVisible = false;\r\n  }\r\n\r\n  // Clear decorations from active terminal\r\n  if (activeSessionId) {\r\n    const state = searchStates.get(activeSessionId);\r\n    if (state?.addon) {\r\n      state.addon.clearDecorations();\r\n    }\r\n  }\r\n\r\n  // Return focus to terminal\r\n  if (activeSessionId) {\r\n    const termState = sessionTerminals.get(activeSessionId);\r\n    if (termState) {\r\n      termState.terminal.focus();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Check if search is visible\r\n */\r\nexport function isSearchVisible(): boolean {\r\n  return searchVisible;\r\n}\r\n\r\n/**\r\n * Find next match\r\n */\r\nexport function findNext(): void {\r\n  if (!activeSessionId || !searchInput) return;\r\n\r\n  const query = searchInput.value;\r\n  if (!query) return;\r\n\r\n  const state = searchStates.get(activeSessionId);\r\n  if (!state?.addon) return;\r\n\r\n  const result = state.addon.findNext(query, { incremental: false });\r\n  updateSearchResults(result);\r\n}\r\n\r\n/**\r\n * Find previous match\r\n */\r\nexport function findPrevious(): void {\r\n  if (!activeSessionId || !searchInput) return;\r\n\r\n  const query = searchInput.value;\r\n  if (!query) return;\r\n\r\n  const state = searchStates.get(activeSessionId);\r\n  if (!state?.addon) return;\r\n\r\n  const result = state.addon.findPrevious(query);\r\n  updateSearchResults(result);\r\n}\r\n\r\n/**\r\n * Update search results display\r\n */\r\nfunction updateSearchResults(found: boolean): void {\r\n  if (searchResults) {\r\n    if (found) {\r\n      searchResults.textContent = 'Found';\r\n      searchResults.style.color = '';\r\n    } else {\r\n      searchResults.textContent = 'No matches';\r\n      searchResults.style.color = 'var(--accent-red)';\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Bind search UI event handlers\r\n */\r\nexport function bindSearchEvents(): void {\r\n  const searchInput = document.getElementById('search-input') as HTMLInputElement;\r\n  const prevBtn = document.getElementById('search-prev');\r\n  const nextBtn = document.getElementById('search-next');\r\n  const closeBtn = document.getElementById('search-close');\r\n\r\n  if (searchInput) {\r\n    searchInput.addEventListener('input', () => {\r\n      if (activeSessionId && searchInput.value) {\r\n        findNext();\r\n      } else if (searchResults) {\r\n        searchResults.textContent = '0/0';\r\n        searchResults.style.color = '';\r\n      }\r\n    });\r\n\r\n    searchInput.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        if (e.shiftKey) {\r\n          findPrevious();\r\n        } else {\r\n          findNext();\r\n        }\r\n      } else if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        hideSearch();\r\n      }\r\n    });\r\n  }\r\n\r\n  if (prevBtn) {\r\n    prevBtn.addEventListener('click', findPrevious);\r\n  }\r\n\r\n  if (nextBtn) {\r\n    nextBtn.addEventListener('click', findNext);\r\n  }\r\n\r\n  if (closeBtn) {\r\n    closeBtn.addEventListener('click', hideSearch);\r\n  }\r\n}\r\n", "/**\r\n * Session List Module\r\n *\r\n * Handles rendering and updating the sidebar session list,\r\n * including empty state and mobile title updates.\r\n */\r\n\r\nimport type { Session } from '../../types';\r\nimport {\r\n  sessions,\r\n  activeSessionId,\r\n  settingsOpen,\r\n  pendingSessions,\r\n  dom\r\n} from '../../state';\r\n\r\n// =============================================================================\r\n// Callback Types\r\n// =============================================================================\r\n\r\n/** Callbacks for session list interactions */\r\nexport interface SessionListCallbacks {\r\n  onSelect: (sessionId: string) => void;\r\n  onDelete: (sessionId: string) => void;\r\n  onRename: (sessionId: string) => void;\r\n  onResize: (sessionId: string) => void;\r\n  onCloseSidebar: () => void;\r\n}\r\n\r\nlet callbacks: SessionListCallbacks | null = null;\r\n\r\n// =============================================================================\r\n// Initialization\r\n// =============================================================================\r\n\r\n/**\r\n * Set callbacks for session list interactions\r\n */\r\nexport function setSessionListCallbacks(cbs: SessionListCallbacks): void {\r\n  callbacks = cbs;\r\n}\r\n\r\n// =============================================================================\r\n// Session Display\r\n// =============================================================================\r\n\r\ninterface SessionDisplayInfo {\r\n  primary: string;\r\n  secondary: string | null;\r\n}\r\n\r\n/**\r\n * Get display info for a session (primary title and optional secondary subtitle)\r\n */\r\nexport function getSessionDisplayInfo(session: Session): SessionDisplayInfo {\r\n  const termTitle = session.terminalTitle || session.shellType;\r\n  if (session.name) {\r\n    return { primary: session.name, secondary: termTitle };\r\n  }\r\n  return { primary: termTitle, secondary: null };\r\n}\r\n\r\n/**\r\n * Get the display name for a session (primary title only, for mobile/island)\r\n */\r\nexport function getSessionDisplayName(session: Session): string {\r\n  const info = getSessionDisplayInfo(session);\r\n  return info.primary;\r\n}\r\n\r\n// =============================================================================\r\n// Rendering\r\n// =============================================================================\r\n\r\n/**\r\n * Render the session list in the sidebar\r\n */\r\nexport function renderSessionList(): void {\r\n  if (!dom.sessionList) return;\r\n\r\n  dom.sessionList.innerHTML = '';\r\n\r\n  sessions.forEach((session) => {\r\n    const isPending = pendingSessions.has(session.id);\r\n    const item = document.createElement('div');\r\n    item.className = 'session-item' +\r\n      (session.id === activeSessionId ? ' active' : '') +\r\n      (isPending ? ' pending' : '');\r\n    item.dataset.sessionId = session.id;\r\n\r\n    if (!isPending) {\r\n      item.addEventListener('click', () => {\r\n        if (callbacks) {\r\n          callbacks.onSelect(session.id);\r\n          callbacks.onCloseSidebar();\r\n        }\r\n      });\r\n    }\r\n\r\n    const info = document.createElement('div');\r\n    info.className = 'session-info';\r\n\r\n    if (isPending) {\r\n      const spinner = document.createElement('span');\r\n      spinner.className = 'session-spinner';\r\n      info.appendChild(spinner);\r\n    }\r\n\r\n    const displayInfo = getSessionDisplayInfo(session);\r\n\r\n    const title = document.createElement('span');\r\n    title.className = 'session-title';\r\n    title.textContent = displayInfo.primary;\r\n    info.appendChild(title);\r\n\r\n    if (displayInfo.secondary) {\r\n      item.classList.add('two-line');\r\n      const subtitle = document.createElement('span');\r\n      subtitle.className = 'session-subtitle';\r\n      subtitle.textContent = displayInfo.secondary;\r\n      info.appendChild(subtitle);\r\n    }\r\n\r\n    const actions = document.createElement('div');\r\n    actions.className = 'session-actions';\r\n\r\n    if (!isPending) {\r\n      const resizeBtn = document.createElement('button');\r\n      resizeBtn.className = 'session-resize';\r\n      resizeBtn.innerHTML = '\u2922';\r\n      resizeBtn.title = 'Fit to screen';\r\n      resizeBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        if (callbacks) {\r\n          callbacks.onResize(session.id);\r\n        }\r\n      });\r\n\r\n      const renameBtn = document.createElement('button');\r\n      renameBtn.className = 'session-rename';\r\n      renameBtn.innerHTML = '\u270F\uFE0F';\r\n      renameBtn.title = 'Rename session';\r\n      renameBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        if (callbacks) {\r\n          callbacks.onRename(session.id);\r\n        }\r\n      });\r\n\r\n      const closeBtn = document.createElement('button');\r\n      closeBtn.className = 'session-close';\r\n      closeBtn.innerHTML = '&times;';\r\n      closeBtn.title = 'Close session';\r\n      closeBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        if (callbacks) {\r\n          callbacks.onDelete(session.id);\r\n        }\r\n      });\r\n\r\n      actions.appendChild(resizeBtn);\r\n      actions.appendChild(renameBtn);\r\n      actions.appendChild(closeBtn);\r\n    }\r\n\r\n    item.appendChild(info);\r\n    item.appendChild(actions);\r\n    dom.sessionList!.appendChild(item);\r\n  });\r\n\r\n  // Count only non-pending sessions\r\n  const realSessionCount = sessions.filter((s) => !pendingSessions.has(s.id)).length;\r\n  if (dom.sessionCount) {\r\n    dom.sessionCount.textContent = String(realSessionCount);\r\n  }\r\n}\r\n\r\n/**\r\n * Update the empty state visibility based on session count\r\n */\r\nexport function updateEmptyState(): void {\r\n  if (!dom.emptyState) return;\r\n\r\n  if (sessions.length === 0) {\r\n    dom.emptyState.classList.remove('hidden');\r\n    if (dom.settingsView) dom.settingsView.classList.add('hidden');\r\n  } else if (!settingsOpen) {\r\n    dom.emptyState.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Update the mobile title bar with current session name.\r\n * Also updates the desktop collapsed title bar.\r\n */\r\nexport function updateMobileTitle(): void {\r\n  if (!dom.mobileTitle) return;\r\n\r\n  const session = sessions.find((s) => s.id === activeSessionId);\r\n  dom.mobileTitle.textContent = session ? getSessionDisplayName(session) : 'MidTerm';\r\n\r\n  if (dom.topbarActions) {\r\n    if (session) {\r\n      dom.topbarActions.classList.remove('no-terminal');\r\n    } else {\r\n      dom.topbarActions.classList.add('no-terminal');\r\n    }\r\n  }\r\n\r\n  // Also update the desktop collapsed title bar\r\n  updateTitleBar(session);\r\n}\r\n\r\n/**\r\n * Update the collapsed title bar with current session info\r\n */\r\nfunction updateTitleBar(session: Session | undefined): void {\r\n  if (!dom.titleBarCustom || !dom.titleBarTerminal || !dom.titleBarSeparator) return;\r\n\r\n  if (!session) {\r\n    dom.titleBarCustom.textContent = 'MidTerm';\r\n    dom.titleBarTerminal.textContent = '';\r\n    dom.titleBarSeparator.style.display = 'none';\r\n    return;\r\n  }\r\n\r\n  const info = getSessionDisplayInfo(session);\r\n\r\n  if (session.name) {\r\n    dom.titleBarCustom.textContent = info.primary;\r\n    dom.titleBarTerminal.textContent = info.secondary || '';\r\n    dom.titleBarSeparator.style.display = info.secondary ? '' : 'none';\r\n  } else {\r\n    dom.titleBarCustom.textContent = info.primary;\r\n    dom.titleBarTerminal.textContent = '';\r\n    dom.titleBarSeparator.style.display = 'none';\r\n  }\r\n}\r\n", "/**\r\n * Sidebar Collapse Module\r\n *\r\n * Handles sidebar visibility, collapse/expand state,\r\n * and island title updates for desktop view.\r\n */\r\n\r\nimport {\r\n  sidebarOpen,\r\n  setSidebarOpen,\r\n  setSidebarCollapsed,\r\n  dom\r\n} from '../../state';\r\nimport { getCookie, setCookie } from '../../utils';\r\nimport { updateMobileTitle } from './sessionList';\r\nimport { rescaleAllTerminals } from '../terminal/scaling';\r\n\r\n// =============================================================================\r\n// Cookie Constants\r\n// =============================================================================\r\n\r\nconst SIDEBAR_COLLAPSED_COOKIE = 'mm-sidebar-collapsed';\r\nconst SIDEBAR_WIDTH_COOKIE = 'mm-sidebar-width';\r\nconst DESKTOP_BREAKPOINT = 768;\r\nconst MIN_SIDEBAR_WIDTH = 180;\r\nconst MAX_SIDEBAR_WIDTH = 400;\r\n\r\n// =============================================================================\r\n// Mobile Sidebar Toggle\r\n// =============================================================================\r\n\r\n/**\r\n * Toggle mobile sidebar visibility\r\n */\r\nexport function toggleSidebar(): void {\r\n  setSidebarOpen(!sidebarOpen);\r\n  if (dom.app) dom.app.classList.toggle('sidebar-open', sidebarOpen);\r\n}\r\n\r\n/**\r\n * Close mobile sidebar\r\n */\r\nexport function closeSidebar(): void {\r\n  setSidebarOpen(false);\r\n  if (dom.app) dom.app.classList.remove('sidebar-open');\r\n}\r\n\r\n// =============================================================================\r\n// Desktop Sidebar Collapse\r\n// =============================================================================\r\n\r\n/**\r\n * Collapse sidebar to icon-only mode (desktop)\r\n */\r\nexport function collapseSidebar(): void {\r\n  setSidebarCollapsed(true);\r\n  if (dom.app) dom.app.classList.add('sidebar-collapsed');\r\n  setCookie(SIDEBAR_COLLAPSED_COOKIE, 'true');\r\n  updateMobileTitle();\r\n  requestAnimationFrame(rescaleAllTerminals);\r\n}\r\n\r\n/**\r\n * Expand sidebar to full width (desktop)\r\n */\r\nexport function expandSidebar(): void {\r\n  setSidebarCollapsed(false);\r\n  if (dom.app) dom.app.classList.remove('sidebar-collapsed');\r\n  setCookie(SIDEBAR_COLLAPSED_COOKIE, 'false');\r\n  requestAnimationFrame(rescaleAllTerminals);\r\n}\r\n\r\n// =============================================================================\r\n// State Restoration\r\n// =============================================================================\r\n\r\n/**\r\n * Restore sidebar collapsed state from cookie (desktop only)\r\n */\r\nexport function restoreSidebarState(): void {\r\n  if (getCookie(SIDEBAR_COLLAPSED_COOKIE) === 'true' && window.innerWidth > DESKTOP_BREAKPOINT) {\r\n    setSidebarCollapsed(true);\r\n    if (dom.app) dom.app.classList.add('sidebar-collapsed');\r\n  }\r\n\r\n  // Restore sidebar width\r\n  const savedWidth = getCookie(SIDEBAR_WIDTH_COOKIE);\r\n  if (savedWidth) {\r\n    const width = parseInt(savedWidth, 10);\r\n    if (width >= MIN_SIDEBAR_WIDTH && width <= MAX_SIDEBAR_WIDTH) {\r\n      const sidebar = document.getElementById('sidebar');\r\n      if (sidebar) {\r\n        sidebar.style.width = width + 'px';\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n// Sidebar Resize\r\n// =============================================================================\r\n\r\n/**\r\n * Set up sidebar resize grip functionality\r\n */\r\nexport function setupSidebarResize(): void {\r\n  const grip = document.getElementById('sidebar-resize-grip');\r\n  const sidebar = document.getElementById('sidebar');\r\n  if (!grip || !sidebar) return;\r\n\r\n  let isResizing = false;\r\n  let startX = 0;\r\n  let startWidth = 0;\r\n\r\n  grip.addEventListener('mousedown', (e: MouseEvent) => {\r\n    isResizing = true;\r\n    startX = e.clientX;\r\n    startWidth = sidebar.offsetWidth;\r\n    grip.classList.add('active');\r\n    document.body.style.cursor = 'ew-resize';\r\n    document.body.style.userSelect = 'none';\r\n    e.preventDefault();\r\n  });\r\n\r\n  document.addEventListener('mousemove', (e: MouseEvent) => {\r\n    if (!isResizing) return;\r\n\r\n    const delta = e.clientX - startX;\r\n    const newWidth = Math.max(MIN_SIDEBAR_WIDTH, Math.min(MAX_SIDEBAR_WIDTH, startWidth + delta));\r\n    sidebar.style.width = newWidth + 'px';\r\n    rescaleAllTerminals();\r\n  });\r\n\r\n  document.addEventListener('mouseup', () => {\r\n    if (!isResizing) return;\r\n\r\n    isResizing = false;\r\n    grip.classList.remove('active');\r\n    document.body.style.cursor = '';\r\n    document.body.style.userSelect = '';\r\n\r\n    // Save width to cookie\r\n    const currentWidth = sidebar.offsetWidth;\r\n    setCookie(SIDEBAR_WIDTH_COOKIE, String(currentWidth));\r\n  });\r\n}\r\n", "/**\r\n * MidTerm Terminal Client\r\n *\r\n * Web-based terminal multiplexer frontend using xterm.js.\r\n * Main entry point - wires together all modules.\r\n */\r\n\r\nimport { initThemeFromCookie } from './modules/theming';\r\nimport {\r\n  connectStateWebSocket,\r\n  connectMuxWebSocket,\r\n  registerStateCallbacks,\r\n  registerMuxCallbacks,\r\n  sendInput,\r\n  sendResize,\r\n  requestBufferRefresh\r\n} from './modules/comms';\r\nimport {\r\n  createTerminalForSession,\r\n  destroyTerminalForSession,\r\n  preloadTerminalFont,\r\n  registerTerminalCallbacks,\r\n  applyTerminalScaling,\r\n  fitSessionToScreen,\r\n  setupResizeObserver,\r\n  setupVisualViewport,\r\n  registerScalingCallbacks,\r\n  bindSearchEvents,\r\n  registerFileDropCallbacks,\r\n  pasteToTerminal\r\n} from './modules/terminal';\r\nimport {\r\n  renderSessionList,\r\n  updateEmptyState,\r\n  updateMobileTitle,\r\n  getSessionDisplayName,\r\n  setSessionListCallbacks,\r\n  toggleSidebar,\r\n  closeSidebar,\r\n  collapseSidebar,\r\n  expandSidebar,\r\n  restoreSidebarState,\r\n  setupSidebarResize\r\n} from './modules/sidebar';\r\nimport {\r\n  toggleSettings,\r\n  closeSettings,\r\n  checkSystemHealth,\r\n  fetchSettings\r\n} from './modules/settings';\r\nimport {\r\n  checkAuthStatus,\r\n  bindAuthEvents\r\n} from './modules/auth';\r\nimport {\r\n  renderUpdatePanel,\r\n  applyUpdate,\r\n  checkForUpdates,\r\n  checkUpdateResult,\r\n  showChangelog,\r\n  closeChangelog\r\n} from './modules/updating';\r\nimport {\r\n  cacheDOMElements,\r\n  sessions,\r\n  activeSessionId,\r\n  sessionTerminals,\r\n  currentSettings,\r\n  stateWsConnected,\r\n  muxWsConnected,\r\n  dom,\r\n  setActiveSessionId,\r\n  setFontsReadyPromise,\r\n  newlyCreatedSessions,\r\n  pendingSessions\r\n} from './state';\r\nimport {\r\n  FONT_CHAR_WIDTH_RATIO,\r\n  FONT_LINE_HEIGHT_RATIO,\r\n  TERMINAL_PADDING,\r\n  MIN_TERMINAL_COLS,\r\n  MIN_TERMINAL_ROWS,\r\n  MAX_TERMINAL_COLS,\r\n  MAX_TERMINAL_ROWS\r\n} from './constants';\r\nimport { bindClick, escapeHtml } from './utils';\r\n\r\n// Debug export for console access\r\n(window as any).mmDebug = {\r\n  get terminals() { return sessionTerminals; },\r\n  get activeId() { return activeSessionId; },\r\n  get settings() { return currentSettings; }\r\n};\r\n\r\n// =============================================================================\r\n// Initialization\r\n// =============================================================================\r\n\r\ninitThemeFromCookie();\r\n\r\ndocument.addEventListener('DOMContentLoaded', init);\r\n\r\nfunction init(): void {\r\n  cacheDOMElements();\r\n  restoreSidebarState();\r\n  setupSidebarResize();\r\n\r\n  const fontPromise = preloadTerminalFont();\r\n  setFontsReadyPromise(fontPromise);\r\n\r\n  registerCallbacks();\r\n  connectStateWebSocket();\r\n  connectMuxWebSocket();\r\n  checkSystemHealth();\r\n\r\n  bindEvents();\r\n  bindAuthEvents();\r\n  bindSearchEvents();\r\n  setupResizeObserver();\r\n  setupVisualViewport();\r\n\r\n  fetchVersion();\r\n  fetchNetworks();\r\n  fetchSettings();\r\n  checkAuthStatus();\r\n  checkUpdateResult();\r\n  requestNotificationPermission();\r\n\r\n  setupVisibilityChangeHandler();\r\n}\r\n\r\n// =============================================================================\r\n// Callback Registration\r\n// =============================================================================\r\n\r\nfunction registerCallbacks(): void {\r\n  registerStateCallbacks({\r\n    destroyTerminalForSession,\r\n    applyTerminalScaling,\r\n    renderSessionList,\r\n    updateEmptyState,\r\n    selectSession,\r\n    updateMobileTitle,\r\n    renderUpdatePanel\r\n  });\r\n\r\n  registerMuxCallbacks({\r\n    applyTerminalScaling\r\n  });\r\n\r\n  registerTerminalCallbacks({\r\n    sendInput,\r\n    showBellNotification,\r\n    requestBufferRefresh\r\n  });\r\n\r\n  registerFileDropCallbacks({\r\n    sendInput,\r\n    pasteToTerminal\r\n  });\r\n\r\n  registerScalingCallbacks({\r\n    sendResize: (sessionId: string, terminal: { cols: number; rows: number }) => {\r\n      sendResize(sessionId, terminal.cols, terminal.rows);\r\n    }\r\n  });\r\n\r\n  setSessionListCallbacks({\r\n    onSelect: selectSession,\r\n    onDelete: deleteSession,\r\n    onRename: startInlineRename,\r\n    onResize: fitSessionToScreen,\r\n    onCloseSidebar: closeSidebar\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Visibility Change Handler\r\n// =============================================================================\r\n\r\nfunction setupVisibilityChangeHandler(): void {\r\n  document.addEventListener('visibilitychange', () => {\r\n    if (document.visibilityState === 'visible') {\r\n      // Reconnect WebSockets if they were dropped while in background\r\n      // Buffer refresh is handled by muxChannel's reconnect handler if needed\r\n      if (!stateWsConnected) {\r\n        connectStateWebSocket();\r\n      }\r\n      if (!muxWsConnected) {\r\n        connectMuxWebSocket();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Session Management\r\n// =============================================================================\r\n\r\nfunction createSession(): void {\r\n  const rect = dom.terminalsArea?.getBoundingClientRect();\r\n  let cols = currentSettings?.defaultCols ?? 120;\r\n  let rows = currentSettings?.defaultRows ?? 30;\r\n\r\n  if (rect && rect.width > 100 && rect.height > 100) {\r\n    const fontSize = currentSettings?.fontSize ?? 14;\r\n    const charWidth = fontSize * FONT_CHAR_WIDTH_RATIO;\r\n    const lineHeight = fontSize * FONT_LINE_HEIGHT_RATIO;\r\n\r\n    const availWidth = rect.width - TERMINAL_PADDING;\r\n    const availHeight = rect.height - TERMINAL_PADDING;\r\n\r\n    const measuredCols = Math.floor(availWidth / charWidth);\r\n    const measuredRows = Math.floor(availHeight / lineHeight);\r\n\r\n    if (measuredCols > MIN_TERMINAL_COLS && measuredRows > MIN_TERMINAL_ROWS) {\r\n      cols = Math.min(measuredCols, MAX_TERMINAL_COLS);\r\n      rows = Math.min(measuredRows, MAX_TERMINAL_ROWS);\r\n    }\r\n  }\r\n\r\n  // Optimistic UI: add temporary session with spinner\r\n  const tempId = 'pending-' + Date.now();\r\n  const tempSession = {\r\n    id: tempId,\r\n    name: null,\r\n    terminalTitle: null,\r\n    shellType: 'Loading...',\r\n    cols: cols,\r\n    rows: rows\r\n  };\r\n  sessions.push(tempSession);\r\n  pendingSessions.add(tempId);\r\n  renderSessionList();\r\n  closeSidebar();\r\n\r\n  fetch('/api/sessions', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ Cols: cols, Rows: rows })\r\n  })\r\n    .then((r) => r.json())\r\n    .then((session) => {\r\n      // Remove temporary session\r\n      pendingSessions.delete(tempId);\r\n      const idx = sessions.findIndex((s) => s.id === tempId);\r\n      if (idx >= 0) {\r\n        sessions.splice(idx, 1);\r\n      }\r\n\r\n      newlyCreatedSessions.add(session.id);\r\n      selectSession(session.id);\r\n    })\r\n    .catch((e) => {\r\n      // Remove temporary session on error\r\n      pendingSessions.delete(tempId);\r\n      const idx = sessions.findIndex((s) => s.id === tempId);\r\n      if (idx >= 0) {\r\n        sessions.splice(idx, 1);\r\n        renderSessionList();\r\n        updateEmptyState();\r\n      }\r\n      console.error('Error creating session:', e);\r\n    });\r\n}\r\n\r\nfunction selectSession(sessionId: string): void {\r\n  closeSettings();\r\n  sessionTerminals.forEach((state) => {\r\n    state.container.classList.add('hidden');\r\n  });\r\n\r\n  setActiveSessionId(sessionId);\r\n\r\n  const sessionInfo = sessions.find((s) => s.id === sessionId);\r\n  const state = createTerminalForSession(sessionId, sessionInfo);\r\n  const isNewlyCreated = newlyCreatedSessions.has(sessionId);\r\n  state.container.classList.remove('hidden');\r\n\r\n  requestAnimationFrame(() => {\r\n    state.terminal.focus();\r\n\r\n    // Server pushes all buffers on WS connect, no need to request again\r\n    if (isNewlyCreated) {\r\n      newlyCreatedSessions.delete(sessionId);\r\n    }\r\n  });\r\n\r\n  renderSessionList();\r\n  updateMobileTitle();\r\n  dom.emptyState?.classList.add('hidden');\r\n}\r\n\r\nfunction deleteSession(sessionId: string): void {\r\n  // Optimistic UI: remove session immediately for better UX\r\n  destroyTerminalForSession(sessionId);\r\n\r\n  // Remove from local sessions array\r\n  const idx = sessions.findIndex((s) => s.id === sessionId);\r\n  if (idx >= 0) {\r\n    sessions.splice(idx, 1);\r\n  }\r\n\r\n  // If this was the active session, select another\r\n  if (activeSessionId === sessionId) {\r\n    setActiveSessionId(null);\r\n    const firstSession = sessions[0];\r\n    if (firstSession) {\r\n      selectSession(firstSession.id);\r\n    }\r\n  }\r\n\r\n  renderSessionList();\r\n  updateEmptyState();\r\n  updateMobileTitle();\r\n\r\n  // Send delete request to server\r\n  fetch('/api/sessions/' + sessionId, { method: 'DELETE' }).catch((e) => {\r\n    console.error('Error deleting session:', e);\r\n  });\r\n}\r\n\r\nfunction renameSession(sessionId: string, newName: string | null): void {\r\n  const session = sessions.find((s) => s.id === sessionId);\r\n  if (!session) return;\r\n\r\n  const trimmedName = (newName || '').trim();\r\n  const nameToSend = trimmedName === '' || trimmedName === session.shellType ? null : trimmedName;\r\n\r\n  fetch('/api/sessions/' + sessionId + '/name', {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ name: nameToSend })\r\n  })\r\n    .then(() => {\r\n      session.manuallyNamed = true;\r\n    })\r\n    .catch((e) => {\r\n      console.error('Error renaming session:', e);\r\n    });\r\n}\r\n\r\nfunction startInlineRename(sessionId: string): void {\r\n  const item = dom.sessionList?.querySelector(`[data-session-id=\"${sessionId}\"]`);\r\n  if (!item) return;\r\n\r\n  const titleSpan = item.querySelector('.session-title');\r\n  if (!titleSpan) return;\r\n\r\n  const session = sessions.find((s) => s.id === sessionId);\r\n  const currentName = session ? (session.name || session.shellType) : '';\r\n\r\n  const input = document.createElement('input');\r\n  input.type = 'text';\r\n  input.className = 'session-rename-input';\r\n  input.value = currentName;\r\n\r\n  function finishRename(): void {\r\n    renameSession(sessionId, input.value);\r\n    input.replaceWith(titleSpan as Node);\r\n  }\r\n\r\n  input.addEventListener('blur', finishRename);\r\n  input.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      input.blur();\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      input.replaceWith(titleSpan);\r\n    }\r\n  });\r\n\r\n  titleSpan.replaceWith(input);\r\n  input.focus();\r\n  input.select();\r\n}\r\n\r\nfunction promptRenameSession(sessionId: string): void {\r\n  const session = sessions.find((s) => s.id === sessionId);\r\n  if (!session) return;\r\n\r\n  const currentName = session.name || session.shellType;\r\n  const newName = prompt('Rename terminal:', currentName);\r\n\r\n  if (newName !== null) {\r\n    renameSession(sessionId, newName);\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n// Notifications\r\n// =============================================================================\r\n\r\nfunction requestNotificationPermission(): void {\r\n  if (!('Notification' in window)) return;\r\n  if (Notification.permission === 'default') {\r\n    Notification.requestPermission().catch(() => {});\r\n  }\r\n}\r\n\r\nfunction showBellNotification(sessionId: string): void {\r\n  if (!currentSettings) return;\r\n\r\n  const bellStyle = currentSettings.bellStyle || 'notification';\r\n  const session = sessions.find((s) => s.id === sessionId);\r\n  const title = session ? getSessionDisplayName(session) : 'Terminal';\r\n\r\n  if ((bellStyle === 'notification' || bellStyle === 'both') &&\r\n      Notification.permission === 'granted' && document.hidden) {\r\n    new Notification('Bell: ' + title, {\r\n      body: 'Terminal bell triggered',\r\n      icon: '/favicon.ico'\r\n    });\r\n  }\r\n\r\n  if (bellStyle === 'visual' || bellStyle === 'both') {\r\n    const state = sessionTerminals.get(sessionId);\r\n    if (state) {\r\n      state.container.classList.add('bell-flash');\r\n      setTimeout(() => {\r\n        state.container.classList.remove('bell-flash');\r\n      }, 200);\r\n    }\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n// API Helpers\r\n// =============================================================================\r\n\r\nfunction fetchVersion(): void {\r\n  fetch('/api/version')\r\n    .then((r) => r.text())\r\n    .then((v) => {\r\n      const shortVersion = (v.split(/[+-]/)[0] ?? v).split('.').slice(0, 3).join('.');\r\n      const el = document.getElementById('app-version');\r\n      if (el) el.textContent = 'v' + shortVersion;\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction fetchNetworks(): void {\r\n  fetch('/api/networks')\r\n    .then((r) => r.json())\r\n    .then((networks) => {\r\n      const list = document.getElementById('network-list');\r\n      if (!list) return;\r\n\r\n      const protocol = location.protocol;\r\n      const port = location.port;\r\n      list.innerHTML = networks.map((n: { name: string; ip: string }) => {\r\n        const url = protocol + '//' + n.ip + ':' + port;\r\n        return '<div class=\"network-item\">' +\r\n          '<span class=\"network-name\" title=\"' + escapeHtml(n.name) + '\">' +\r\n          escapeHtml(n.name) + '</span>' +\r\n          '<a class=\"network-url\" href=\"' + url + '\" target=\"_blank\">' +\r\n          escapeHtml(n.ip) + ':' + port + '</a>' +\r\n          '</div>';\r\n      }).join('');\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\n// =============================================================================\r\n// Event Binding\r\n// =============================================================================\r\n\r\nfunction bindEvents(): void {\r\n  bindClick('btn-new-session', createSession);\r\n  bindClick('btn-new-session-mobile', createSession);\r\n  bindClick('btn-create-terminal', createSession);\r\n\r\n  bindClick('btn-hamburger', toggleSidebar);\r\n  bindClick('btn-collapse-sidebar', collapseSidebar);\r\n  bindClick('btn-expand-sidebar', expandSidebar);\r\n\r\n  if (dom.sidebarOverlay) {\r\n    dom.sidebarOverlay.addEventListener('click', closeSidebar);\r\n  }\r\n\r\n  bindClick('btn-ctrlc-mobile', () => {\r\n    if (activeSessionId) sendInput(activeSessionId, '\\x03');\r\n  });\r\n  bindClick('btn-resize-mobile', () => {\r\n    if (activeSessionId) fitSessionToScreen(activeSessionId);\r\n  });\r\n  bindClick('btn-resize-titlebar', () => {\r\n    if (activeSessionId) fitSessionToScreen(activeSessionId);\r\n  });\r\n  bindClick('btn-rename-mobile', () => {\r\n    if (activeSessionId) promptRenameSession(activeSessionId);\r\n  });\r\n  bindClick('btn-rename-titlebar', () => {\r\n    if (activeSessionId) promptRenameSession(activeSessionId);\r\n  });\r\n  bindClick('btn-close-mobile', () => {\r\n    if (activeSessionId) deleteSession(activeSessionId);\r\n  });\r\n\r\n  if (dom.settingsBtn) {\r\n    dom.settingsBtn.addEventListener('click', toggleSettings);\r\n  }\r\n\r\n  bindClick('update-btn', applyUpdate);\r\n  bindClick('btn-check-updates', checkForUpdates);\r\n  bindClick('btn-apply-update', applyUpdate);\r\n  bindClick('btn-show-changelog', showChangelog);\r\n  bindClick('btn-close-changelog', closeChangelog);\r\n\r\n  const changelogBackdrop = document.querySelector('#changelog-modal .modal-backdrop');\r\n  if (changelogBackdrop) {\r\n    changelogBackdrop.addEventListener('click', closeChangelog);\r\n  }\r\n\r\n  import('./modules/settings').then((mod) => {\r\n    mod.bindSettingsAutoSave();\r\n  });\r\n}\r\n", "/**\r\n * Auth Status Module\r\n *\r\n * Handles authentication status checking and security warning display.\r\n */\r\n\r\nimport { authStatus, setAuthStatus } from '../../state';\r\nimport type { AuthStatus } from '../../types';\r\n\r\n/**\r\n * Check authentication status from server\r\n */\r\nexport async function checkAuthStatus(): Promise<void> {\r\n  try {\r\n    const response = await fetch('/api/auth/status');\r\n\r\n    if (response.status === 401) {\r\n      window.location.href = '/login.html';\r\n      return;\r\n    }\r\n\r\n    const status: AuthStatus = await response.json();\r\n    setAuthStatus(status);\r\n    updateSecurityWarning();\r\n    updatePasswordStatus();\r\n  } catch (e) {\r\n    console.error('Auth status error:', e);\r\n  }\r\n}\r\n\r\n/**\r\n * Update security warning visibility based on auth status\r\n */\r\nexport function updateSecurityWarning(): void {\r\n  const warning = document.getElementById('security-warning');\r\n  if (!warning) return;\r\n\r\n  if (authStatus && authStatus.authenticationEnabled && !authStatus.passwordSet) {\r\n    warning.classList.remove('hidden');\r\n  } else {\r\n    warning.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Update password status text in settings panel\r\n */\r\nexport function updatePasswordStatus(): void {\r\n  const statusEl = document.getElementById('password-status-text');\r\n  if (!statusEl) return;\r\n\r\n  if (!authStatus) {\r\n    statusEl.textContent = 'Checking...';\r\n    statusEl.className = '';\r\n    return;\r\n  }\r\n\r\n  if (authStatus.passwordSet) {\r\n    statusEl.textContent = 'Password is set';\r\n    statusEl.className = 'status-set';\r\n  } else {\r\n    statusEl.textContent = 'No password set';\r\n    statusEl.className = 'status-missing';\r\n  }\r\n}\r\n\r\n/**\r\n * Dismiss the security warning banner\r\n */\r\nexport function dismissSecurityWarning(): void {\r\n  const warning = document.getElementById('security-warning');\r\n  if (warning) {\r\n    warning.classList.add('hidden');\r\n  }\r\n}\r\n", "/**\r\n * Password Modal Module\r\n *\r\n * Handles password set/change modal and form submission.\r\n */\r\n\r\nimport { authStatus } from '../../state';\r\nimport { bindClick } from '../../utils';\r\nimport { checkAuthStatus, dismissSecurityWarning } from './status';\r\n\r\nlet passwordModalHasPassword = false;\r\n\r\n/**\r\n * Show the password modal for setting or changing password\r\n */\r\nexport function showPasswordModal(_isInitialSetup: boolean): void {\r\n  const modal = document.getElementById('password-modal');\r\n  const title = document.getElementById('password-modal-title');\r\n  const currentGroup = document.getElementById('current-password-group');\r\n  const errorEl = document.getElementById('password-error');\r\n\r\n  if (!modal) return;\r\n\r\n  passwordModalHasPassword = authStatus?.passwordSet ?? false;\r\n\r\n  if (title) {\r\n    title.textContent = passwordModalHasPassword ? 'Change Password' : 'Set Password';\r\n  }\r\n\r\n  if (currentGroup) {\r\n    currentGroup.style.display = passwordModalHasPassword ? 'block' : 'none';\r\n  }\r\n\r\n  if (errorEl) {\r\n    errorEl.classList.add('hidden');\r\n    errorEl.textContent = '';\r\n  }\r\n\r\n  const form = document.getElementById('password-form') as HTMLFormElement | null;\r\n  if (form) {\r\n    form.reset();\r\n  }\r\n\r\n  modal.classList.remove('hidden');\r\n\r\n  const focusFieldId = passwordModalHasPassword ? 'current-password' : 'new-password';\r\n  const field = document.getElementById(focusFieldId) as HTMLInputElement | null;\r\n  if (field) {\r\n    field.focus();\r\n  }\r\n}\r\n\r\n/**\r\n * Hide the password modal\r\n */\r\nexport function hidePasswordModal(): void {\r\n  const modal = document.getElementById('password-modal');\r\n  if (modal) {\r\n    modal.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Handle password form submission\r\n */\r\nexport function handlePasswordSubmit(e: Event): void {\r\n  e.preventDefault();\r\n\r\n  const currentPw = document.getElementById('current-password') as HTMLInputElement | null;\r\n  const newPw = document.getElementById('new-password') as HTMLInputElement | null;\r\n  const confirmPw = document.getElementById('confirm-password') as HTMLInputElement | null;\r\n  const saveBtn = document.getElementById('btn-save-password') as HTMLButtonElement | null;\r\n\r\n  const newPassword = newPw?.value ?? '';\r\n  const confirmPassword = confirmPw?.value ?? '';\r\n\r\n  if (!newPassword) {\r\n    showPasswordError('New password is required');\r\n    return;\r\n  }\r\n\r\n  if (newPassword !== confirmPassword) {\r\n    showPasswordError('Passwords do not match');\r\n    return;\r\n  }\r\n\r\n  if (newPassword.length < 4) {\r\n    showPasswordError('Password must be at least 4 characters');\r\n    return;\r\n  }\r\n\r\n  const payload = {\r\n    currentPassword: passwordModalHasPassword && currentPw ? currentPw.value : null,\r\n    newPassword: newPassword\r\n  };\r\n\r\n  if (saveBtn) {\r\n    saveBtn.disabled = true;\r\n    saveBtn.textContent = 'Saving...';\r\n  }\r\n\r\n  fetch('/api/auth/change-password', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  })\r\n    .then(r => r.json().then(data => ({ ok: r.ok, data })))\r\n    .then(result => {\r\n      if (saveBtn) {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = 'Save';\r\n      }\r\n\r\n      if (result.ok && result.data.success) {\r\n        hidePasswordModal();\r\n        checkAuthStatus();\r\n      } else {\r\n        showPasswordError(result.data.error || 'Failed to change password');\r\n      }\r\n    })\r\n    .catch(() => {\r\n      if (saveBtn) {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = 'Save';\r\n      }\r\n      showPasswordError('Connection error');\r\n    });\r\n}\r\n\r\n/**\r\n * Show an error message in the password modal\r\n */\r\nexport function showPasswordError(msg: string): void {\r\n  const errorEl = document.getElementById('password-error');\r\n  if (errorEl) {\r\n    errorEl.textContent = msg;\r\n    errorEl.classList.remove('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Bind all auth-related event handlers\r\n */\r\nexport function bindAuthEvents(): void {\r\n  bindClick('btn-set-password-warning', () => {\r\n    showPasswordModal(true);\r\n  });\r\n  bindClick('btn-dismiss-warning', dismissSecurityWarning);\r\n\r\n  bindClick('btn-change-password', () => {\r\n    showPasswordModal(false);\r\n  });\r\n  bindClick('btn-close-password', hidePasswordModal);\r\n  bindClick('btn-cancel-password', hidePasswordModal);\r\n\r\n  const passwordBackdrop = document.querySelector('#password-modal .modal-backdrop');\r\n  if (passwordBackdrop) {\r\n    passwordBackdrop.addEventListener('click', hidePasswordModal);\r\n  }\r\n\r\n  const passwordForm = document.getElementById('password-form');\r\n  if (passwordForm) {\r\n    passwordForm.addEventListener('submit', handlePasswordSubmit);\r\n  }\r\n}\r\n", "/**\r\n * Update Checker Module\r\n *\r\n * Handles checking for updates, rendering the update panel,\r\n * and applying updates with server restart.\r\n */\r\n\r\nimport type { UpdateInfo } from '../../types';\r\nimport { updateInfo, setUpdateInfo } from '../../state';\r\n\r\nconst MAX_RELOAD_ATTEMPTS = 30;\r\nconst RELOAD_INTERVAL_MS = 2000;\r\nconst INITIAL_RESTART_DELAY_MS = 3000;\r\n\r\n/**\r\n * Render the update panel based on current update info\r\n */\r\nexport function renderUpdatePanel(): void {\r\n  const panel = document.getElementById('update-panel');\r\n  if (!panel) return;\r\n\r\n  if (!updateInfo || !updateInfo.available) {\r\n    panel.classList.add('hidden');\r\n    return;\r\n  }\r\n\r\n  panel.classList.remove('hidden');\r\n  const currentEl = panel.querySelector('.update-current');\r\n  const latestEl = panel.querySelector('.update-latest');\r\n  const noteEl = panel.querySelector('.update-note');\r\n  const headerEl = panel.querySelector('.update-header');\r\n\r\n  if (currentEl) currentEl.textContent = updateInfo.currentVersion;\r\n  if (latestEl) latestEl.textContent = updateInfo.latestVersion;\r\n\r\n  if (updateInfo.sessionsPreserved) {\r\n    if (headerEl) headerEl.textContent = 'Quick Update';\r\n    if (noteEl) {\r\n      noteEl.textContent = 'Sessions will stay alive';\r\n      noteEl.classList.add('update-note-safe');\r\n      noteEl.classList.remove('update-note-warning');\r\n    }\r\n  } else {\r\n    if (headerEl) headerEl.textContent = 'Update Available';\r\n    if (noteEl) {\r\n      noteEl.textContent = 'Save your work - sessions will restart';\r\n      noteEl.classList.add('update-note-warning');\r\n      noteEl.classList.remove('update-note-safe');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Apply the available update and restart the server\r\n */\r\nexport function applyUpdate(): void {\r\n  if (!updateInfo || !updateInfo.available) return;\r\n\r\n  const panel = document.getElementById('update-panel');\r\n  const btn = panel?.querySelector('.update-btn') as HTMLButtonElement | null;\r\n\r\n  if (btn) {\r\n    btn.disabled = true;\r\n    btn.textContent = 'Updating...';\r\n  }\r\n\r\n  fetch('/api/update/apply', { method: 'POST' })\r\n    .then((r) => {\r\n      if (r.ok) {\r\n        if (btn) btn.textContent = 'Restarting...';\r\n        waitForServerAndReload();\r\n      } else {\r\n        if (btn) {\r\n          btn.disabled = false;\r\n          btn.textContent = 'Update & Restart';\r\n        }\r\n        console.error('Update failed');\r\n      }\r\n    })\r\n    .catch((e) => {\r\n      if (btn) {\r\n        btn.disabled = false;\r\n        btn.textContent = 'Update & Restart';\r\n      }\r\n      console.error('Update error:', e);\r\n    });\r\n}\r\n\r\n/**\r\n * Wait for the server to restart after an update, then reload the page\r\n */\r\nexport function waitForServerAndReload(): void {\r\n  let attempts = 0;\r\n\r\n  function checkServer(): void {\r\n    attempts++;\r\n    fetch('/api/version', { cache: 'no-store' })\r\n      .then((r) => {\r\n        if (r.ok) {\r\n          location.reload();\r\n        } else if (attempts < MAX_RELOAD_ATTEMPTS) {\r\n          setTimeout(checkServer, RELOAD_INTERVAL_MS);\r\n        }\r\n      })\r\n      .catch(() => {\r\n        if (attempts < MAX_RELOAD_ATTEMPTS) {\r\n          setTimeout(checkServer, RELOAD_INTERVAL_MS);\r\n        }\r\n      });\r\n  }\r\n\r\n  setTimeout(checkServer, INITIAL_RESTART_DELAY_MS);\r\n}\r\n\r\n/**\r\n * Manually check for updates and update the UI\r\n */\r\nexport function checkForUpdates(): void {\r\n  const btn = document.getElementById('btn-check-updates') as HTMLButtonElement | null;\r\n  const statusEl = document.getElementById('update-status');\r\n  const warningEl = document.getElementById('update-warning');\r\n\r\n  if (btn) {\r\n    btn.disabled = true;\r\n    btn.textContent = 'Checking...';\r\n  }\r\n\r\n  fetch('/api/update/check')\r\n    .then((r) => r.json())\r\n    .then((update: UpdateInfo) => {\r\n      if (btn) {\r\n        btn.disabled = false;\r\n        btn.textContent = 'Check for Updates';\r\n      }\r\n\r\n      setUpdateInfo(update);\r\n      renderUpdatePanel();\r\n\r\n      const applyBtn = document.getElementById('btn-apply-update');\r\n      if (statusEl) {\r\n        statusEl.classList.remove('hidden');\r\n        if (update && update.available) {\r\n          statusEl.className = 'update-status update-status-available';\r\n          statusEl.textContent = 'Update available: v' + update.latestVersion;\r\n          if (applyBtn) applyBtn.classList.remove('hidden');\r\n\r\n          // Show warning based on session preservation\r\n          if (warningEl) {\r\n            warningEl.classList.remove('hidden');\r\n            if (update.sessionsPreserved) {\r\n              warningEl.textContent = 'Sessions will stay alive';\r\n              warningEl.className = 'update-warning update-warning-safe';\r\n            } else {\r\n              warningEl.textContent = 'Save your work - sessions will restart';\r\n              warningEl.className = 'update-warning update-warning-warn';\r\n            }\r\n          }\r\n        } else {\r\n          statusEl.className = 'update-status update-status-current';\r\n          statusEl.textContent = 'You are running the latest version';\r\n          if (applyBtn) applyBtn.classList.add('hidden');\r\n          if (warningEl) warningEl.classList.add('hidden');\r\n        }\r\n      }\r\n    })\r\n    .catch((e) => {\r\n      if (btn) {\r\n        btn.disabled = false;\r\n        btn.textContent = 'Check for Updates';\r\n      }\r\n      if (statusEl) {\r\n        statusEl.classList.remove('hidden');\r\n        statusEl.className = 'update-status update-status-error';\r\n        statusEl.textContent = 'Failed to check for updates';\r\n      }\r\n      if (warningEl) warningEl.classList.add('hidden');\r\n      console.error('Update check error:', e);\r\n    });\r\n}\r\n\r\n/**\r\n * Handle incoming update info from WebSocket\r\n */\r\nexport function handleUpdateInfo(update: UpdateInfo): void {\r\n  setUpdateInfo(update);\r\n  renderUpdatePanel();\r\n}\r\n\r\ninterface UpdateResult {\r\n  found: boolean;\r\n  success: boolean;\r\n  message: string;\r\n  details: string;\r\n  timestamp: string;\r\n  logFile: string;\r\n}\r\n\r\n/**\r\n * Check for update results on startup and clear the result file.\r\n * The update result is shown in the settings panel, not as a notification.\r\n */\r\nexport function checkUpdateResult(): void {\r\n  fetch('/api/update/result')\r\n    .then((r) => r.json())\r\n    .then((result: UpdateResult) => {\r\n      if (!result.found) return;\r\n\r\n      // Clear the result file - the result is shown in the settings/sidebar panels\r\n      fetch('/api/update/result', { method: 'DELETE' }).catch(() => {});\r\n    })\r\n    .catch(() => {});\r\n}\r\n", "/**\n * Changelog Module\n *\n * Fetches and displays the changelog from GitHub releases.\n */\n\nimport { escapeHtml } from '../../utils';\n\nconst GITHUB_RELEASES_BASE = 'https://api.github.com/repos/AiTlbx/MidTerm/releases';\nconst PER_PAGE = 30;\nconst GITHUB_RELEASES_PAGE = 'https://github.com/AiTlbx/MidTerm/releases';\n\ninterface GitHubRelease {\n  tag_name?: string;\n  published_at?: string;\n  body?: string;\n}\n\n// Pagination state\nlet currentPage = 1;\nlet hasMoreReleases = true;\nlet isLoading = false;\n\n/**\n * Show the changelog modal and fetch releases from GitHub\n */\nexport function showChangelog(): void {\n  const modal = document.getElementById('changelog-modal');\n  const body = document.getElementById('changelog-body');\n\n  // Reset pagination state\n  currentPage = 1;\n  hasMoreReleases = true;\n  isLoading = false;\n\n  if (modal) modal.classList.remove('hidden');\n  if (body) body.innerHTML = '<div class=\"changelog-loading\">Loading changelog...</div>';\n\n  fetchReleases(true);\n}\n\n/**\n * Fetch releases from GitHub API\n */\nfunction fetchReleases(isInitial: boolean): void {\n  if (isLoading) return;\n  isLoading = true;\n\n  const body = document.getElementById('changelog-body');\n  if (!body) return;\n\n  const url = `${GITHUB_RELEASES_BASE}?per_page=${PER_PAGE}&page=${currentPage}`;\n\n  fetch(url)\n    .then((r) => r.json())\n    .then((releases: GitHubRelease[]) => {\n      isLoading = false;\n\n      if (!releases || !Array.isArray(releases)) {\n        if (isInitial) {\n          body.innerHTML = '<p>No releases found.</p>';\n        }\n        hasMoreReleases = false;\n        return;\n      }\n\n      // Check if there are more pages\n      hasMoreReleases = releases.length === PER_PAGE;\n\n      if (releases.length === 0) {\n        if (isInitial) {\n          body.innerHTML = '<p>No releases found.</p>';\n        }\n        hasMoreReleases = false;\n        return;\n      }\n\n      // Build HTML for releases\n      let html = '';\n      releases.forEach((release) => {\n        const version = release.tag_name || 'Unknown';\n        const date = release.published_at\n          ? new Date(release.published_at).toLocaleDateString()\n          : '';\n        // Strip version prefix from body since version is already shown in header\n        const rawNotes = release.body || 'No release notes.';\n        const notes = stripVersionPrefix(rawNotes, version);\n\n        html += '<div class=\"changelog-release\">';\n        html += '<div class=\"changelog-version\">' + escapeHtml(version) + '</div>';\n        if (date) html += '<div class=\"changelog-date\">' + escapeHtml(date) + '</div>';\n        html += '<div class=\"changelog-notes\">' + formatMarkdown(notes) + '</div>';\n        html += '</div>';\n      });\n\n      if (isInitial) {\n        body.innerHTML = html;\n      } else {\n        // Remove existing load more button before appending\n        const existingBtn = body.querySelector('.changelog-load-more');\n        if (existingBtn) existingBtn.remove();\n        body.insertAdjacentHTML('beforeend', html);\n      }\n\n      // Add load more button if there are more releases\n      if (hasMoreReleases) {\n        const loadMoreBtn = document.createElement('button');\n        loadMoreBtn.className = 'changelog-load-more';\n        loadMoreBtn.textContent = 'Load older releases';\n        loadMoreBtn.addEventListener('click', () => {\n          currentPage++;\n          loadMoreBtn.textContent = 'Loading...';\n          loadMoreBtn.disabled = true;\n          fetchReleases(false);\n        });\n        body.appendChild(loadMoreBtn);\n      }\n    })\n    .catch((e) => {\n      isLoading = false;\n      if (isInitial) {\n        body.innerHTML =\n          '<p class=\"changelog-error\">Failed to load changelog. ' +\n          '<a href=\"' + GITHUB_RELEASES_PAGE + '\" target=\"_blank\">View on GitHub</a></p>';\n      }\n      console.error('Changelog error:', e);\n    });\n}\n\n/**\n * Close the changelog modal\n */\nexport function closeChangelog(): void {\n  const modal = document.getElementById('changelog-modal');\n  if (modal) modal.classList.add('hidden');\n}\n\n/**\n * Strip version prefix from release notes\n *\n * Removes patterns like \"v5.3.0: \" or \"5.3.0: \" from the start of text\n * since the version is already shown in the header.\n */\nfunction stripVersionPrefix(text: string, version: string): string {\n  // Remove leading \"v\" from version if present for matching\n  const versionNum = version.replace(/^v/, '');\n  // Match \"v5.3.0: \" or \"5.3.0: \" at start of text\n  const pattern = new RegExp(`^v?${escapeRegex(versionNum)}:\\\\s*`, 'i');\n  return text.replace(pattern, '').trim();\n}\n\n/**\n * Escape special regex characters in a string\n */\nfunction escapeRegex(str: string): string {\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\n/**\n * Format markdown text to HTML (basic subset)\n *\n * Supports: headers (## and ###), bold (**text**),\n * links [text](url), and bullet lists (- item)\n */\nexport function formatMarkdown(text: string): string {\n  return escapeHtml(text)\n    .replace(/^### (.+)$/gm, '<h4>$1</h4>')\n    .replace(/^## (.+)$/gm, '<h3>$1</h3>')\n    .replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\">$1</a>')\n    .replace(/^- (.+)$/gm, '<li>$1</li>')\n    .replace(/(<li>.*<\\/li>)/s, '<ul>$1</ul>')\n    .replace(/\\n{3,}/g, '\\n\\n') // Collapse 3+ newlines to 2\n    .replace(/\\n\\n/g, '<br><br>') // Double newline = paragraph break\n    .replace(/\\n/g, '<br>'); // Single newline = line break\n}\n"],
  "mappings": "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",
  "names": ["JS_BUILD_VERSION", "MUX_HEADER_SIZE", "MUX_TYPE_OUTPUT", "MUX_TYPE_INPUT", "MUX_TYPE_RESIZE", "MUX_TYPE_RESYNC", "MUX_TYPE_BUFFER_REQUEST", "MUX_TYPE_COMPRESSED_OUTPUT", "THEMES", "INITIAL_RECONNECT_DELAY", "MAX_RECONNECT_DELAY", "TERMINAL_FONT_STACK", "FONT_CHAR_WIDTH_RATIO", "FONT_LINE_HEIGHT_RATIO", "TERMINAL_PADDING", "MIN_TERMINAL_COLS", "MIN_TERMINAL_ROWS", "MAX_TERMINAL_COLS", "MAX_TERMINAL_ROWS", "MAX_FRAME_DIMENSION", "MOBILE_BREAKPOINT", "init_constants", "__esmMin", "setSessions", "newSessions", "sessions", "setActiveSessionId", "id", "activeSessionId", "setCurrentSettings", "settings", "currentSettings", "setUpdateInfo", "info", "updateInfo", "setAuthStatus", "status", "authStatus", "setSettingsOpen", "open", "settingsOpen", "setSidebarOpen", "sidebarOpen", "setSidebarCollapsed", "collapsed", "sidebarCollapsed", "setStateWs", "ws", "stateWs", "setStateReconnectTimer", "timer", "stateReconnectTimer", "setStateReconnectDelay", "delay", "stateReconnectDelay", "setStateWsConnected", "connected", "stateWsConnected", "setMuxWs", "muxWs", "setMuxReconnectTimer", "muxReconnectTimer", "setMuxReconnectDelay", "muxReconnectDelay", "setMuxWsConnected", "muxWsConnected", "setMuxHasConnected", "muxHasConnected", "setFontsReadyPromise", "promise", "fontsReadyPromise", "setWindowsBuildNumber", "build", "windowsBuildNumber", "cacheDOMElements", "dom", "sessionTerminals", "newlyCreatedSessions", "pendingSessions", "pendingOutputFrames", "init_state", "__esmMin", "escapeHtml", "text", "div", "bindClick", "id", "handler", "el", "init_dom", "__esmMin", "getCookie", "name", "value", "setCookie", "days", "expires", "getClipboardStyle", "setting", "ua", "init_cookies", "__esmMin", "parseOutputFrame", "payload", "cols", "rows", "data", "valid", "MAX_FRAME_DIMENSION", "parseCompressedOutputFrame", "compressedData", "decompressGzip", "e", "compressed", "stream", "init_protocol", "__esmMin", "init_constants", "scheduleReconnect", "currentDelay", "maxDelay", "connect", "setDelay", "setTimer", "existingTimer", "timer", "init_reconnect", "__esmMin", "init_utils", "__esmMin", "init_dom", "init_cookies", "init_protocol", "init_reconnect", "setElementValue", "id", "value", "el", "setElementChecked", "checked", "getElementValue", "defaultValue", "getElementChecked", "populateVersionInfo", "serverVersion", "hostVersion", "frontendVersion", "formatVersion", "v", "serverEl", "frontendEl", "hostEl", "populateUserDropdown", "users", "selectedUser", "select", "user", "option", "populateSettingsForm", "settings", "fetchSettings", "version", "health", "r", "setCurrentSettings", "JS_BUILD_VERSION", "applySettingsToTerminals", "currentSettings", "theme", "THEMES", "fontFamily", "TERMINAL_FONT_STACK", "sessionTerminals", "state", "dims", "saveAllSettings", "runAsUserValue", "setCookie", "e", "bindSettingsAutoSave", "settingsView", "dom", "wrapper", "input", "saveBtn", "originalValue", "init_persistence", "__esmMin", "init_constants", "init_state", "init_utils", "closeSidebar", "app", "dom", "toggleSettings", "settingsOpen", "closeSettings", "openSettings", "setSettingsOpen", "activeSessionId", "state", "sessionTerminals", "fetchSettings", "fetchSystemStatus", "sessions", "formatUptime", "seconds", "hours", "mins", "updateTtyHostWarning", "health", "banner", "header", "container", "response", "statusClass", "statusText", "uptimeStr", "ttyHostHtml", "err", "message", "checkSystemHealth", "setWindowsBuildNumber", "init_panel", "__esmMin", "init_state", "init_persistence", "settings_exports", "__export", "bindSettingsAutoSave", "checkSystemHealth", "closeSettings", "fetchSettings", "fetchSystemStatus", "formatUptime", "getElementChecked", "getElementValue", "openSettings", "populateSettingsForm", "populateUserDropdown", "populateVersionInfo", "saveAllSettings", "setElementChecked", "setElementValue", "toggleSettings", "updateTtyHostWarning", "init_settings", "__esmMin", "init_panel", "init_persistence", "init_constants", "init_state", "init_utils", "initThemeFromCookie", "savedTheme", "THEMES", "init_constants", "init_utils", "init_state", "destroyTerminalForSession", "applyTerminalScaling", "renderSessionList", "updateEmptyState", "selectSession", "updateMobileTitle", "renderUpdatePanel", "registerStateCallbacks", "callbacks", "connectStateWebSocket", "stateWs", "setStateWs", "protocol", "ws", "setStateReconnectDelay", "INITIAL_RECONNECT_DELAY", "setStateWsConnected", "updateConnectionStatus", "event", "data", "sessionList", "handleStateUpdate", "handleUpdateInfo", "e", "message", "scheduleStateReconnect", "newSessions", "newIds", "s", "sessionTerminals", "_", "id", "newlyCreatedSessions", "session", "state", "setSessions", "firstSession", "sessions", "activeSessionId", "setActiveSessionId", "nextSession", "update", "setUpdateInfo", "scheduleReconnect", "stateReconnectDelay", "MAX_RECONNECT_DELAY", "setStateReconnectTimer", "stateReconnectTimer", "indicator", "status", "text", "stateWsConnected", "muxWsConnected", "init_constants", "init_utils", "init_state", "applyTerminalScaling", "registerMuxCallbacks", "callbacks", "outputQueue", "processingQueue", "queueOutputFrame", "sessionId", "payload", "compressed", "processOutputQueue", "item", "processOneFrame", "cols", "rows", "data", "frame", "parseCompressedOutputFrame", "parseOutputFrame", "state", "sessionTerminals", "writeToTerminal", "bufferedPayload", "pendingOutputFrames", "e", "bracketedPasteState", "isBracketedPasteEnabled", "text", "termCore", "currentCols", "currentRows", "message", "connectMuxWebSocket", "muxWs", "setMuxWs", "protocol", "ws", "isReconnect", "muxHasConnected", "setMuxReconnectDelay", "INITIAL_RECONNECT_DELAY", "setMuxWsConnected", "setMuxHasConnected", "updateConnectionStatus", "event", "MUX_HEADER_SIZE", "type", "decodeSessionId", "MUX_TYPE_RESYNC", "MUX_TYPE_OUTPUT", "MUX_TYPE_COMPRESSED_OUTPUT", "scheduleMuxReconnect", "sendInput", "MUX_TYPE_INPUT", "encodeSessionId", "sendResize", "MUX_TYPE_RESIZE", "requestBufferRefresh", "MUX_TYPE_BUFFER_REQUEST", "buffer", "offset", "i", "chars", "byte", "scheduleReconnect", "muxReconnectDelay", "MAX_RECONNECT_DELAY", "setMuxReconnectTimer", "muxReconnectTimer", "init_constants", "init_state", "init_utils", "init_constants", "init_state", "sendResize", "registerScalingCallbacks", "callbacks", "fitSessionToScreen", "sessionId", "state", "sessionTerminals", "fontsReadyPromise", "xterm", "wasHidden", "rect", "dom", "renderService", "cellWidth", "cellHeight", "dims", "availWidth", "TERMINAL_PADDING", "availHeight", "cols", "rows", "MIN_TERMINAL_COLS", "MAX_TERMINAL_COLS", "MIN_TERMINAL_ROWS", "MAX_TERMINAL_ROWS", "applyTerminalScaling", "_sessionId", "container", "termWidth", "termHeight", "scaleX", "scaleY", "scale", "rescaleAllTerminals", "setupResizeObserver", "setupVisualViewport", "lastHeight", "updateViewportHeight", "vh", "mobileHeader", "headerHeight", "availableHeight", "init_state", "TEXT_FILE_SIZE_LIMIT", "IMAGE_EXTENSIONS", "REJECTED_EXTENSIONS", "pasteToTerminal", "getFileExtension", "filename", "lastDot", "isImageFile", "isRejectedFile", "showDropToast", "message", "existing", "toast", "readFileAsText", "file", "resolve", "reject", "reader", "sanitizePasteContent", "text", "registerFileDropCallbacks", "callbacks", "uploadFile", "sessionId", "formData", "response", "error", "handleFileDrop", "files", "activeSessionId", "imagePaths", "path", "ext", "content", "sanitized", "err", "joined", "setupFileDrop", "container", "e", "handleClipboardPaste", "items", "item", "imageType", "t", "blob", "timestamp", "init_state", "searchStates", "searchVisible", "searchInput", "searchResults", "searchContainer", "initSearchForTerminal", "sessionId", "terminal", "addon", "cleanupSearchForTerminal", "showSearch", "hideSearch", "activeSessionId", "state", "termState", "sessionTerminals", "isSearchVisible", "findNext", "query", "result", "updateSearchResults", "findPrevious", "found", "bindSearchEvents", "prevBtn", "nextBtn", "closeBtn", "e", "sendInput", "showBellNotification", "requestBufferRefresh", "pendingTitleUpdates", "bracketedPasteState", "updateSessionNameAuto", "sessionId", "name", "sessions", "s", "existing", "timer", "registerTerminalCallbacks", "callbacks", "getTerminalOptions", "isMobile", "MOBILE_BREAKPOINT", "baseFontSize", "currentSettings", "fontSize", "themeName", "fontFamily", "options", "TERMINAL_FONT_STACK", "THEMES", "isWindows", "windowsBuildNumber", "createTerminalForSession", "sessionInfo", "sessionTerminals", "container", "dom", "setupFileDrop", "terminal", "fitAddon", "serverCols", "serverRows", "state", "fontsReadyPromise", "webglAddon", "webLinksAddon", "_event", "uri", "initSearchForTerminal", "replayPendingFrames", "fitSessionToScreen", "setupTerminalEvents", "frames", "pendingOutputFrames", "payload", "writeOutputFrame", "frame", "parseOutputFrame", "text", "enableMatch", "disableMatch", "core", "currentCols", "currentRows", "applyTerminalScaling", "data", "title", "e", "getClipboardStyle", "handleClipboardPaste", "showSearch", "isSearchVisible", "hideSearch", "pasteHandler", "contextMenuHandler", "destroyTerminalForSession", "cleanupSearchForTerminal", "titleTimer", "pasteToTerminal", "isFilePath", "localBpm", "muxBpm", "isBracketedPasteEnabled", "xtermBpm", "wrapped", "preloadTerminalFont", "promise", "testSpan", "TERMINAL_FONT_STACK", "resolve", "setFontsReadyPromise", "init_state", "callbacks", "setSessionListCallbacks", "cbs", "getSessionDisplayInfo", "session", "termTitle", "getSessionDisplayName", "renderSessionList", "dom", "sessions", "isPending", "pendingSessions", "item", "activeSessionId", "info", "spinner", "displayInfo", "title", "subtitle", "actions", "resizeBtn", "e", "renameBtn", "closeBtn", "realSessionCount", "s", "updateEmptyState", "settingsOpen", "updateMobileTitle", "updateTitleBar", "init_state", "init_utils", "SIDEBAR_COLLAPSED_COOKIE", "SIDEBAR_WIDTH_COOKIE", "DESKTOP_BREAKPOINT", "MIN_SIDEBAR_WIDTH", "MAX_SIDEBAR_WIDTH", "toggleSidebar", "setSidebarOpen", "sidebarOpen", "dom", "closeSidebar", "collapseSidebar", "setSidebarCollapsed", "setCookie", "updateMobileTitle", "rescaleAllTerminals", "expandSidebar", "restoreSidebarState", "getCookie", "savedWidth", "width", "sidebar", "setupSidebarResize", "grip", "isResizing", "startX", "startWidth", "e", "delta", "newWidth", "currentWidth", "init_settings", "init_state", "checkAuthStatus", "response", "status", "setAuthStatus", "updateSecurityWarning", "updatePasswordStatus", "warning", "authStatus", "statusEl", "dismissSecurityWarning", "init_state", "init_utils", "passwordModalHasPassword", "showPasswordModal", "_isInitialSetup", "modal", "title", "currentGroup", "errorEl", "authStatus", "form", "focusFieldId", "field", "hidePasswordModal", "handlePasswordSubmit", "currentPw", "newPw", "confirmPw", "saveBtn", "newPassword", "confirmPassword", "showPasswordError", "payload", "r", "data", "result", "checkAuthStatus", "msg", "bindAuthEvents", "bindClick", "dismissSecurityWarning", "passwordBackdrop", "passwordForm", "init_state", "MAX_RELOAD_ATTEMPTS", "RELOAD_INTERVAL_MS", "INITIAL_RESTART_DELAY_MS", "renderUpdatePanel", "panel", "updateInfo", "currentEl", "latestEl", "noteEl", "headerEl", "applyUpdate", "btn", "r", "waitForServerAndReload", "e", "attempts", "checkServer", "checkForUpdates", "statusEl", "warningEl", "update", "setUpdateInfo", "applyBtn", "checkUpdateResult", "r", "result", "init_utils", "GITHUB_RELEASES_BASE", "PER_PAGE", "GITHUB_RELEASES_PAGE", "currentPage", "hasMoreReleases", "isLoading", "showChangelog", "modal", "body", "fetchReleases", "isInitial", "url", "r", "releases", "html", "release", "version", "date", "rawNotes", "notes", "stripVersionPrefix", "escapeHtml", "formatMarkdown", "existingBtn", "loadMoreBtn", "e", "closeChangelog", "text", "versionNum", "pattern", "escapeRegex", "str", "init_state", "init_constants", "init_utils", "sessionTerminals", "activeSessionId", "currentSettings", "initThemeFromCookie", "init", "cacheDOMElements", "restoreSidebarState", "setupSidebarResize", "fontPromise", "preloadTerminalFont", "setFontsReadyPromise", "registerCallbacks", "connectStateWebSocket", "connectMuxWebSocket", "checkSystemHealth", "bindEvents", "bindAuthEvents", "bindSearchEvents", "setupResizeObserver", "setupVisualViewport", "fetchVersion", "fetchNetworks", "fetchSettings", "checkAuthStatus", "checkUpdateResult", "requestNotificationPermission", "setupVisibilityChangeHandler", "registerStateCallbacks", "destroyTerminalForSession", "applyTerminalScaling", "renderSessionList", "updateEmptyState", "selectSession", "updateMobileTitle", "renderUpdatePanel", "registerMuxCallbacks", "registerTerminalCallbacks", "sendInput", "showBellNotification", "requestBufferRefresh", "registerFileDropCallbacks", "pasteToTerminal", "registerScalingCallbacks", "sessionId", "terminal", "sendResize", "setSessionListCallbacks", "deleteSession", "startInlineRename", "fitSessionToScreen", "closeSidebar", "stateWsConnected", "muxWsConnected", "createSession", "rect", "dom", "cols", "rows", "fontSize", "charWidth", "FONT_CHAR_WIDTH_RATIO", "lineHeight", "FONT_LINE_HEIGHT_RATIO", "availWidth", "TERMINAL_PADDING", "availHeight", "measuredCols", "measuredRows", "MIN_TERMINAL_COLS", "MIN_TERMINAL_ROWS", "MAX_TERMINAL_COLS", "MAX_TERMINAL_ROWS", "tempId", "tempSession", "sessions", "pendingSessions", "r", "session", "idx", "s", "newlyCreatedSessions", "e", "closeSettings", "state", "setActiveSessionId", "sessionInfo", "createTerminalForSession", "isNewlyCreated", "firstSession", "renameSession", "newName", "trimmedName", "nameToSend", "item", "titleSpan", "currentName", "input", "finishRename", "promptRenameSession", "bellStyle", "title", "getSessionDisplayName", "v", "shortVersion", "el", "networks", "list", "protocol", "port", "n", "url", "escapeHtml", "bindClick", "toggleSidebar", "collapseSidebar", "expandSidebar", "toggleSettings", "applyUpdate", "checkForUpdates", "showChangelog", "closeChangelog", "changelogBackdrop", "mod"]
}
