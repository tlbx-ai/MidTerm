{
  "version": 3,
  "sources": ["../../src/ts/constants.ts", "../../src/ts/state.ts", "../../src/ts/utils/dom.ts", "../../src/ts/utils/cookies.ts", "../../src/ts/utils/protocol.ts", "../../src/ts/utils/reconnect.ts", "../../src/ts/utils/index.ts", "../../src/ts/modules/terminal/scaling.ts", "../../src/ts/modules/terminal/fileDrop.ts", "../../src/ts/modules/terminal/search.ts", "../../src/ts/modules/terminal/manager.ts", "../../src/ts/modules/terminal/index.ts", "../../src/ts/modules/settings/persistence.ts", "../../src/ts/modules/settings/panel.ts", "../../src/ts/modules/settings/index.ts", "../../src/ts/modules/theming/themes.ts", "../../src/ts/modules/comms/stateChannel.ts", "../../src/ts/modules/comms/muxChannel.ts", "../../src/ts/main.ts", "../../src/ts/modules/sidebar/sessionList.ts", "../../src/ts/modules/sidebar/collapse.ts", "../../src/ts/modules/auth/status.ts", "../../src/ts/modules/auth/password.ts", "../../src/ts/modules/updating/checker.ts", "../../src/ts/modules/updating/changelog.ts"],
  "sourcesContent": ["/**\r\n * Constants\r\n *\r\n * Protocol constants, theme definitions, and configuration values.\r\n */\r\n\r\nimport type { TerminalTheme, ThemeName } from './types';\r\n\r\n// =============================================================================\r\n// Mux Protocol Constants\r\n// =============================================================================\r\n\r\n/** Mux protocol header size (1 byte type + 8 byte session ID) */\r\nexport const MUX_HEADER_SIZE = 9;\r\n\r\n/** Mux protocol message types */\r\nexport const MUX_TYPE_OUTPUT = 0x01;  // Server -> Client: Terminal output (includes dimensions)\r\nexport const MUX_TYPE_INPUT = 0x02;   // Client -> Server: Terminal input\r\nexport const MUX_TYPE_RESIZE = 0x03;  // Client -> Server: Terminal resize\r\nexport const MUX_TYPE_RESYNC = 0x05;  // Server -> Client: Clear terminals, buffer refresh follows\r\n\r\n// =============================================================================\r\n// Terminal Themes\r\n// =============================================================================\r\n\r\n/** Terminal color themes */\r\nexport const THEMES: Record<ThemeName, TerminalTheme> = {\r\n  dark: {\r\n    background: '#101014',\r\n    foreground: '#DCDCF5',\r\n    cursor: '#DCDCF5',\r\n    cursorAccent: '#101014',\r\n    selectionBackground: '#283457'\r\n  },\r\n  light: {\r\n    background: '#D5D6DB',\r\n    foreground: '#343B58',\r\n    cursor: '#343B58',\r\n    cursorAccent: '#D5D6DB',\r\n    selectionBackground: '#9FA0A5'\r\n  },\r\n  solarizedDark: {\r\n    background: '#002B36',\r\n    foreground: '#839496',\r\n    cursor: '#839496',\r\n    cursorAccent: '#002B36',\r\n    selectionBackground: '#073642'\r\n  },\r\n  solarizedLight: {\r\n    background: '#FDF6E3',\r\n    foreground: '#657B83',\r\n    cursor: '#657B83',\r\n    cursorAccent: '#FDF6E3',\r\n    selectionBackground: '#EEE8D5'\r\n  }\r\n};\r\n\r\n// =============================================================================\r\n// Default Settings\r\n// =============================================================================\r\n\r\n/** Default terminal settings */\r\nexport const DEFAULT_SETTINGS = {\r\n  fontSize: 14,\r\n  scrollbackLines: 10000,\r\n  cursorStyle: 'bar' as const,\r\n  cursorBlink: true,\r\n  theme: 'dark' as ThemeName,\r\n  bellStyle: 'notification' as const,\r\n  copyOnSelect: false,\r\n  rightClickPaste: true,\r\n  clipboardShortcuts: 'auto' as const\r\n};\r\n\r\n// =============================================================================\r\n// WebSocket Configuration\r\n// =============================================================================\r\n\r\n/** Initial reconnect delay in milliseconds */\r\nexport const INITIAL_RECONNECT_DELAY = 1000;\r\n\r\n/** Maximum reconnect delay in milliseconds */\r\nexport const MAX_RECONNECT_DELAY = 30000;\r\n\r\n// =============================================================================\r\n// Terminal Rendering Constants\r\n// =============================================================================\r\n\r\n/** Terminal font stack for monospace rendering */\r\nexport const TERMINAL_FONT_STACK = \"'Cascadia Code', 'Cascadia Mono', Consolas, 'Courier New', monospace\";\r\n\r\n/** Character width as ratio of font size (empirical for monospace fonts) */\r\nexport const FONT_CHAR_WIDTH_RATIO = 0.6;\r\n\r\n/** Line height as ratio of font size */\r\nexport const FONT_LINE_HEIGHT_RATIO = 1.2;\r\n\r\n/** Padding around terminal content in pixels */\r\nexport const TERMINAL_PADDING = 8;\r\n\r\n/** Minimum terminal columns */\r\nexport const MIN_TERMINAL_COLS = 10;\r\n\r\n/** Minimum terminal rows */\r\nexport const MIN_TERMINAL_ROWS = 5;\r\n\r\n/** Maximum terminal columns */\r\nexport const MAX_TERMINAL_COLS = 300;\r\n\r\n/** Maximum terminal rows */\r\nexport const MAX_TERMINAL_ROWS = 100;\r\n\r\n/** Maximum frame dimension for validation */\r\nexport const MAX_FRAME_DIMENSION = 500;\r\n\r\n/** Mobile breakpoint in pixels */\r\nexport const MOBILE_BREAKPOINT = 768;\r\n", "/**\r\n * Application State\r\n *\r\n * Centralized state management for the application.\r\n * Replaces the global variables from the original JavaScript.\r\n */\r\n\r\nimport type {\r\n  Session,\r\n  TerminalState,\r\n  Settings,\r\n  UpdateInfo,\r\n  AuthStatus,\r\n  DOMElements\r\n} from './types';\r\n\r\n// =============================================================================\r\n// State Store\r\n// =============================================================================\r\n\r\n/** Sessions from server */\r\nexport let sessions: Session[] = [];\r\n\r\n/** Currently active session ID */\r\nexport let activeSessionId: string | null = null;\r\n\r\n/** User settings from server */\r\nexport let currentSettings: Settings | null = null;\r\n\r\n/** Update info from server */\r\nexport let updateInfo: UpdateInfo | null = null;\r\n\r\n/** Auth status from server */\r\nexport let authStatus: AuthStatus | null = null;\r\n\r\n// =============================================================================\r\n// UI State\r\n// =============================================================================\r\n\r\n/** Settings panel visibility */\r\nexport let settingsOpen = false;\r\n\r\n/** Mobile sidebar visibility */\r\nexport let sidebarOpen = false;\r\n\r\n/** Desktop sidebar collapsed state */\r\nexport let sidebarCollapsed = false;\r\n\r\n// =============================================================================\r\n// WebSocket State\r\n// =============================================================================\r\n\r\n/** State WebSocket connection */\r\nexport let stateWs: WebSocket | null = null;\r\n\r\n/** State WebSocket reconnect timer */\r\nexport let stateReconnectTimer: number | undefined;\r\n\r\n/** State WebSocket reconnect delay */\r\nexport let stateReconnectDelay = 1000;\r\n\r\n/** State WebSocket connected flag */\r\nexport let stateWsConnected = false;\r\n\r\n/** Mux WebSocket connection */\r\nexport let muxWs: WebSocket | null = null;\r\n\r\n/** Mux WebSocket reconnect timer */\r\nexport let muxReconnectTimer: number | undefined;\r\n\r\n/** Mux WebSocket reconnect delay */\r\nexport let muxReconnectDelay = 1000;\r\n\r\n/** Mux WebSocket connected flag */\r\nexport let muxWsConnected = false;\r\n\r\n// =============================================================================\r\n// Terminal State\r\n// =============================================================================\r\n\r\n/** Windows build number for ConPTY configuration (null on non-Windows) */\r\nexport let windowsBuildNumber: number | null = null;\r\n\r\n/** Per-session terminal state */\r\nexport const sessionTerminals = new Map<string, TerminalState>();\r\n\r\n/** Sessions created in this browser session (use WebSocket buffering) */\r\nexport const newlyCreatedSessions = new Set<string>();\r\n\r\n/** Pending sessions being created (for optimistic UI) */\r\nexport const pendingSessions = new Set<string>();\r\n\r\n/** Buffer WebSocket output frames for terminals not yet opened */\r\nexport const pendingOutputFrames = new Map<string, Uint8Array[]>();\r\n\r\n/** Font loading promise */\r\nexport let fontsReadyPromise: Promise<void> | null = null;\r\n\r\n// =============================================================================\r\n// DOM Element Cache\r\n// =============================================================================\r\n\r\n/** Cached DOM elements */\r\nexport const dom: DOMElements = {\r\n  sessionList: null,\r\n  sessionCount: null,\r\n  terminalsArea: null,\r\n  emptyState: null,\r\n  mobileTitle: null,\r\n  topbarActions: null,\r\n  app: null,\r\n  sidebarOverlay: null,\r\n  settingsView: null,\r\n  settingsBtn: null,\r\n  islandTitle: null\r\n};\r\n\r\n// =============================================================================\r\n// State Setters\r\n// =============================================================================\r\n\r\nexport function setSessions(newSessions: Session[]): void {\r\n  sessions = newSessions;\r\n}\r\n\r\nexport function setActiveSessionId(id: string | null): void {\r\n  activeSessionId = id;\r\n}\r\n\r\nexport function setCurrentSettings(settings: Settings | null): void {\r\n  currentSettings = settings;\r\n}\r\n\r\nexport function setUpdateInfo(info: UpdateInfo | null): void {\r\n  updateInfo = info;\r\n}\r\n\r\nexport function setAuthStatus(status: AuthStatus | null): void {\r\n  authStatus = status;\r\n}\r\n\r\nexport function setSettingsOpen(open: boolean): void {\r\n  settingsOpen = open;\r\n}\r\n\r\nexport function setSidebarOpen(open: boolean): void {\r\n  sidebarOpen = open;\r\n}\r\n\r\nexport function setSidebarCollapsed(collapsed: boolean): void {\r\n  sidebarCollapsed = collapsed;\r\n}\r\n\r\nexport function setStateWs(ws: WebSocket | null): void {\r\n  stateWs = ws;\r\n}\r\n\r\nexport function setStateReconnectTimer(timer: number | undefined): void {\r\n  stateReconnectTimer = timer;\r\n}\r\n\r\nexport function setStateReconnectDelay(delay: number): void {\r\n  stateReconnectDelay = delay;\r\n}\r\n\r\nexport function setStateWsConnected(connected: boolean): void {\r\n  stateWsConnected = connected;\r\n}\r\n\r\nexport function setMuxWs(ws: WebSocket | null): void {\r\n  muxWs = ws;\r\n}\r\n\r\nexport function setMuxReconnectTimer(timer: number | undefined): void {\r\n  muxReconnectTimer = timer;\r\n}\r\n\r\nexport function setMuxReconnectDelay(delay: number): void {\r\n  muxReconnectDelay = delay;\r\n}\r\n\r\nexport function setMuxWsConnected(connected: boolean): void {\r\n  muxWsConnected = connected;\r\n}\r\n\r\nexport function setFontsReadyPromise(promise: Promise<void>): void {\r\n  fontsReadyPromise = promise;\r\n}\r\n\r\nexport function setWindowsBuildNumber(build: number | null): void {\r\n  windowsBuildNumber = build;\r\n}\r\n\r\n// =============================================================================\r\n// DOM Element Cache Initialization\r\n// =============================================================================\r\n\r\n/**\r\n * Cache DOM elements for quick access\r\n */\r\nexport function cacheDOMElements(): void {\r\n  dom.sessionList = document.getElementById('session-list');\r\n  dom.sessionCount = document.getElementById('session-count');\r\n  dom.terminalsArea = document.querySelector('.terminals-area');\r\n  dom.emptyState = document.getElementById('empty-state');\r\n  dom.mobileTitle = document.getElementById('mobile-title');\r\n  dom.topbarActions = document.getElementById('topbar-actions');\r\n  dom.app = document.getElementById('app');\r\n  dom.sidebarOverlay = document.getElementById('sidebar-overlay');\r\n  dom.settingsView = document.getElementById('settings-view');\r\n  dom.settingsBtn = document.getElementById('btn-settings');\r\n  dom.islandTitle = document.getElementById('island-title');\r\n}\r\n", "/**\r\n * DOM Utilities\r\n *\r\n * Helper functions for DOM manipulation and event handling.\r\n */\r\n\r\n/**\r\n * Escape HTML special characters to prevent XSS\r\n */\r\nexport function escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Bind a click event to an element by ID\r\n */\r\nexport function bindClick(id: string, handler: (e: MouseEvent) => void): void {\r\n  const el = document.getElementById(id);\r\n  if (el) {\r\n    el.addEventListener('click', handler);\r\n  }\r\n}\r\n\r\n/**\r\n * Create a debounced version of a function\r\n */\r\nexport function debounce<T extends (...args: unknown[]) => void>(\r\n  fn: T,\r\n  delay: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeoutId: number | undefined;\r\n  return (...args: Parameters<T>) => {\r\n    if (timeoutId !== undefined) {\r\n      clearTimeout(timeoutId);\r\n    }\r\n    timeoutId = window.setTimeout(() => fn(...args), delay);\r\n  };\r\n}\r\n\r\n/**\r\n * Format bytes as human-readable string\r\n */\r\nexport function formatBytes(bytes: number): string {\r\n  if (bytes < 1024) return bytes + ' B';\r\n  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\r\n  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\r\n}\r\n", "/**\r\n * Cookie Utilities\r\n *\r\n * Functions for reading and writing browser cookies.\r\n */\r\n\r\n/**\r\n * Get a cookie value by name\r\n */\r\nexport function getCookie(name: string): string | null {\r\n  const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));\r\n  return match ? decodeURIComponent(match[2]) : null;\r\n}\r\n\r\n/**\r\n * Set a cookie value\r\n */\r\nexport function setCookie(name: string, value: string, days: number = 365): void {\r\n  const expires = new Date(Date.now() + days * 24 * 60 * 60 * 1000).toUTCString();\r\n  document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;\r\n}\r\n\r\n/**\r\n * Delete a cookie by name\r\n */\r\nexport function deleteCookie(name: string): void {\r\n  document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;\r\n}\r\n\r\n/**\r\n * Detect clipboard shortcut style based on platform\r\n */\r\nexport function getClipboardStyle(setting: 'auto' | 'windows' | 'unix'): 'windows' | 'unix' {\r\n  if (setting !== 'auto') return setting;\r\n  const ua = navigator.userAgent || '';\r\n  return /Windows|Win32|Win64/i.test(ua) ? 'windows' : 'unix';\r\n}\r\n", "/**\r\n * Protocol Utilities\r\n *\r\n * Binary protocol helpers for mux WebSocket communication.\r\n */\r\n\r\nimport { MAX_FRAME_DIMENSION } from '../constants';\r\n\r\n/** Parsed output frame from server */\r\nexport interface OutputFrame {\r\n  cols: number;\r\n  rows: number;\r\n  data: Uint8Array;\r\n  valid: boolean;\r\n}\r\n\r\n/**\r\n * Parse output frame from binary payload.\r\n * Frame format: [cols:2][rows:2][data]\r\n */\r\nexport function parseOutputFrame(payload: Uint8Array): OutputFrame {\r\n  const cols = payload[0] | (payload[1] << 8);\r\n  const rows = payload[2] | (payload[3] << 8);\r\n  const data = payload.slice(4);\r\n  const valid = cols > 0 && cols <= MAX_FRAME_DIMENSION && rows > 0 && rows <= MAX_FRAME_DIMENSION;\r\n\r\n  return { cols, rows, data, valid };\r\n}\r\n", "/**\r\n * Reconnection Utilities\r\n *\r\n * Exponential backoff reconnection logic for WebSocket connections.\r\n */\r\n\r\n/**\r\n * Schedule a reconnection with exponential backoff.\r\n * Returns the timer ID for cancellation.\r\n */\r\nexport function scheduleReconnect(\r\n  currentDelay: number,\r\n  maxDelay: number,\r\n  connect: () => void,\r\n  setDelay: (delay: number) => void,\r\n  setTimer: (timer: number | undefined) => void,\r\n  existingTimer: number | undefined\r\n): void {\r\n  if (existingTimer !== undefined) {\r\n    clearTimeout(existingTimer);\r\n  }\r\n\r\n  const timer = window.setTimeout(() => {\r\n    setDelay(Math.min(currentDelay * 1.5, maxDelay));\r\n    connect();\r\n  }, currentDelay);\r\n\r\n  setTimer(timer);\r\n}\r\n", "/**\r\n * Utils Module\r\n *\r\n * Re-exports all utility functions.\r\n */\r\n\r\nexport * from './dom';\r\nexport * from './cookies';\r\nexport * from './protocol';\r\nexport * from './reconnect';\r\n", "/**\r\n * Terminal Scaling Module\r\n *\r\n * Handles terminal scaling, fitting to screen, and viewport resize handling.\r\n * Terminals maintain server-side dimensions and are scaled to fit the viewport.\r\n */\r\n\r\nimport type { TerminalState } from '../../types';\r\nimport {\r\n  TERMINAL_PADDING,\r\n  MIN_TERMINAL_COLS,\r\n  MIN_TERMINAL_ROWS,\r\n  MAX_TERMINAL_COLS,\r\n  MAX_TERMINAL_ROWS\r\n} from '../../constants';\r\nimport {\r\n  sessionTerminals,\r\n  fontsReadyPromise,\r\n  dom\r\n} from '../../state';\r\n\r\n// Forward declarations for functions from other modules\r\nlet sendResize: (sessionId: string, terminal: any) => void = () => {};\r\n\r\n/**\r\n * Register callbacks from other modules\r\n */\r\nexport function registerScalingCallbacks(callbacks: {\r\n  sendResize?: (sessionId: string, terminal: any) => void;\r\n}): void {\r\n  if (callbacks.sendResize) sendResize = callbacks.sendResize;\r\n}\r\n\r\n/**\r\n * Fit a session's terminal to the current screen size.\r\n * This sends a resize request to the server.\r\n *\r\n * Uses direct measurement of terminalsArea via getBoundingClientRect() rather than\r\n * FitAddon's measurement of the terminal container. This avoids timing issues where\r\n * clearing zoom/scale causes layout to be in flux when measurements occur.\r\n */\r\nexport function fitSessionToScreen(sessionId: string): void {\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (!state) return;\r\n\r\n  // Wait for terminal to be opened before fitting\r\n  if (!state.opened) {\r\n    (fontsReadyPromise ?? Promise.resolve()).then(() => {\r\n      fitSessionToScreen(sessionId);\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Clear any existing scaling first\r\n  const xterm = state.container.querySelector('.xterm') as HTMLElement | null;\r\n  if (xterm) {\r\n    (xterm.style as any).zoom = '';\r\n    xterm.style.transform = '';\r\n    state.container.classList.remove('scaled');\r\n  }\r\n\r\n  // Ensure terminal is visible for accurate measurement\r\n  const wasHidden = state.container.classList.contains('hidden');\r\n  if (wasHidden) {\r\n    state.container.classList.remove('hidden');\r\n  }\r\n\r\n  // Measure terminalsArea directly - this gives us the actual visible area\r\n  // regardless of any layout complexities with the terminal container\r\n  const rect = dom.terminalsArea?.getBoundingClientRect();\r\n  if (!rect || rect.width < 100 || rect.height < 100) {\r\n    if (wasHidden) {\r\n      state.container.classList.add('hidden');\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Get cell dimensions from xterm's render service\r\n  const renderService = state.terminal._core?._renderService;\r\n  const cellWidth = renderService?.dimensions?.css?.cell?.width;\r\n  const cellHeight = renderService?.dimensions?.css?.cell?.height;\r\n\r\n  if (!cellWidth || !cellHeight) {\r\n    // Fallback to FitAddon if render service isn't ready\r\n    requestAnimationFrame(() => {\r\n      try {\r\n        const dims = state.fitAddon.proposeDimensions();\r\n        if (dims?.cols && dims?.rows) {\r\n          state.fitAddon.fit();\r\n          sendResize(sessionId, state.terminal);\r\n        }\r\n      } catch {\r\n        // FitAddon may fail if terminal render service isn't initialized\r\n      }\r\n\r\n      if (wasHidden) {\r\n        state.container.classList.add('hidden');\r\n      }\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Calculate available space (accounting for container padding)\r\n  const availWidth = rect.width - TERMINAL_PADDING;\r\n  const availHeight = rect.height - TERMINAL_PADDING;\r\n\r\n  // Calculate cols/rows that fit in available space\r\n  let cols = Math.floor(availWidth / cellWidth);\r\n  let rows = Math.floor(availHeight / cellHeight);\r\n\r\n  // Clamp to valid range\r\n  cols = Math.max(MIN_TERMINAL_COLS, Math.min(cols, MAX_TERMINAL_COLS));\r\n  rows = Math.max(MIN_TERMINAL_ROWS, Math.min(rows, MAX_TERMINAL_ROWS));\r\n\r\n  // Resize terminal and notify server\r\n  requestAnimationFrame(() => {\r\n    try {\r\n      if (state.terminal.cols !== cols || state.terminal.rows !== rows) {\r\n        state.terminal.resize(cols, rows);\r\n        sendResize(sessionId, state.terminal);\r\n      }\r\n    } catch {\r\n      // Resize may fail if terminal is disposed\r\n    }\r\n\r\n    if (wasHidden) {\r\n      state.container.classList.add('hidden');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Apply CSS scaling to a terminal to fit within its container.\r\n * Scales down terminals that are larger than the available space.\r\n * Uses CSS zoom instead of transform:scale for better pixel alignment.\r\n */\r\nexport function applyTerminalScaling(sessionId: string, state: TerminalState): void {\r\n  const container = state.container;\r\n  const xterm = container.querySelector('.xterm') as HTMLElement | null;\r\n  if (!xterm) return;\r\n\r\n  // Use requestAnimationFrame for accurate measurements after resize\r\n  requestAnimationFrame(() => {\r\n    const availWidth = container.clientWidth - 8;\r\n    const availHeight = container.clientHeight - 8;\r\n    const termWidth = xterm.offsetWidth;\r\n    const termHeight = xterm.offsetHeight;\r\n\r\n    // Calculate scale (shrink only, never enlarge)\r\n    const scaleX = availWidth / termWidth;\r\n    const scaleY = availHeight / termHeight;\r\n    const scale = Math.min(scaleX, scaleY, 1);\r\n\r\n    if (scale < 0.99) {\r\n      // Use zoom instead of transform:scale for better pixel alignment\r\n      // zoom respects pixel boundaries, transform can cause subpixel rendering\r\n      (xterm.style as any).zoom = scale;\r\n      xterm.style.transform = '';\r\n      container.classList.add('scaled');\r\n    } else {\r\n      (xterm.style as any).zoom = '';\r\n      xterm.style.transform = '';\r\n      container.classList.remove('scaled');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Recalculate scaling for all open terminals\r\n */\r\nexport function rescaleAllTerminals(): void {\r\n  sessionTerminals.forEach((state, sessionId) => {\r\n    if (state.opened) {\r\n      applyTerminalScaling(sessionId, state);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Set up resize observer to recalculate scaling when window resizes\r\n */\r\nexport function setupResizeObserver(): void {\r\n  window.addEventListener('resize', rescaleAllTerminals);\r\n}\r\n\r\n/**\r\n * Set up visual viewport handling for mobile keyboard appearance.\r\n * Updates viewport height CSS variable when visual viewport changes.\r\n */\r\nexport function setupVisualViewport(): void {\r\n  if (!window.visualViewport || !dom.terminalsArea) return;\r\n\r\n  let lastHeight = 0;\r\n\r\n  const updateViewportHeight = () => {\r\n    const vh = window.visualViewport!.height;\r\n    if (Math.abs(vh - lastHeight) < 1) return;\r\n    lastHeight = vh;\r\n\r\n    document.documentElement.style.setProperty('--visual-vh', vh + 'px');\r\n\r\n    const mobileHeader = document.querySelector('.mobile-header') as HTMLElement | null;\r\n    let headerHeight = 0;\r\n    if (mobileHeader && window.getComputedStyle(mobileHeader).display !== 'none') {\r\n      headerHeight = mobileHeader.offsetHeight;\r\n    }\r\n\r\n    const availableHeight = Math.floor((vh - headerHeight) * 0.99);\r\n    dom.terminalsArea!.style.height = availableHeight + 'px';\r\n  };\r\n\r\n  window.visualViewport.addEventListener('resize', updateViewportHeight);\r\n  updateViewportHeight();\r\n}\r\n", "/**\r\n * File Drop Module\r\n *\r\n * Handles drag-and-drop file uploads and clipboard image paste.\r\n * Files are uploaded to the server and the resulting path is inserted into the terminal.\r\n */\r\n\r\nimport { activeSessionId } from '../../state';\r\n\r\n// Forward declarations for callbacks\r\nlet sendInput: (sessionId: string, data: string) => void = () => {};\r\nlet pasteToTerminal: (sessionId: string, data: string) => void = () => {};\r\n\r\n/**\r\n * Register callbacks from mux channel and terminal manager\r\n */\r\nexport function registerFileDropCallbacks(callbacks: {\r\n  sendInput?: (sessionId: string, data: string) => void;\r\n  pasteToTerminal?: (sessionId: string, data: string) => void;\r\n}): void {\r\n  if (callbacks.sendInput) sendInput = callbacks.sendInput;\r\n  if (callbacks.pasteToTerminal) pasteToTerminal = callbacks.pasteToTerminal;\r\n}\r\n\r\n/**\r\n * Upload a file to the server for the given session\r\n */\r\nasync function uploadFile(sessionId: string, file: File): Promise<string | null> {\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n\r\n  try {\r\n    const response = await fetch(`/api/sessions/${sessionId}/upload`, {\r\n      method: 'POST',\r\n      body: formData\r\n    });\r\n\r\n    if (!response.ok) {\r\n      console.error('File upload failed:', response.status);\r\n      return null;\r\n    }\r\n\r\n    const result = await response.json();\r\n    return result.path;\r\n  } catch (error) {\r\n    console.error('File upload error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle file drop - upload and insert path\r\n */\r\nasync function handleFileDrop(files: FileList): Promise<void> {\r\n  if (!activeSessionId || files.length === 0) return;\r\n\r\n  const paths: string[] = [];\r\n\r\n  for (const file of Array.from(files)) {\r\n    const path = await uploadFile(activeSessionId, file);\r\n    if (path) {\r\n      paths.push(path);\r\n    }\r\n  }\r\n\r\n  if (paths.length > 0) {\r\n    // Use terminal.paste() which handles bracketed paste mode automatically\r\n    pasteToTerminal(activeSessionId, paths.join(' '));\r\n  }\r\n}\r\n\r\n/**\r\n * Handle clipboard image paste - convert to file and upload\r\n */\r\nasync function handleClipboardImage(items: DataTransferItemList): Promise<boolean> {\r\n  if (!activeSessionId) return false;\r\n\r\n  for (const item of Array.from(items)) {\r\n    if (item.type.startsWith('image/')) {\r\n      const file = item.getAsFile();\r\n      if (file) {\r\n        // Always use .jpg extension - TUIs are smart enough to detect actual format\r\n        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n        const namedFile = new File([file], `clipboard_${timestamp}.jpg`, { type: file.type });\r\n\r\n        const path = await uploadFile(activeSessionId, namedFile);\r\n        if (path) {\r\n          pasteToTerminal(activeSessionId, path);\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Set up drag-and-drop handlers for a terminal container\r\n */\r\nexport function setupFileDrop(container: HTMLElement): void {\r\n  // Prevent default drag behaviors\r\n  container.addEventListener('dragover', (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.classList.add('drag-over');\r\n  });\r\n\r\n  container.addEventListener('dragleave', (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.classList.remove('drag-over');\r\n  });\r\n\r\n  container.addEventListener('dragend', () => {\r\n    container.classList.remove('drag-over');\r\n  });\r\n\r\n  // Handle drop\r\n  container.addEventListener('drop', async (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.classList.remove('drag-over');\r\n\r\n    const files = e.dataTransfer?.files;\r\n    if (files && files.length > 0) {\r\n      await handleFileDrop(files);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Handle clipboard paste - checks for images first, falls back to text\r\n * Used by the keyboard handler in manager.ts\r\n */\r\nexport async function handleClipboardPaste(sessionId: string): Promise<void> {\r\n  // Try to read clipboard items (images)\r\n  try {\r\n    const items = await navigator.clipboard.read();\r\n    for (const item of items) {\r\n      const imageType = item.types.find(t => t.startsWith('image/'));\r\n      if (imageType) {\r\n        const blob = await item.getType(imageType);\r\n        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n        const file = new File([blob], `clipboard_${timestamp}.jpg`, { type: imageType });\r\n        const path = await uploadFile(sessionId, file);\r\n        if (path) {\r\n          pasteToTerminal(sessionId, path);\r\n          return; // Image handled, don't paste text\r\n        }\r\n      }\r\n    }\r\n  } catch {\r\n    // clipboard.read() not supported or failed, fall through to text paste\r\n  }\r\n\r\n  // No image found or image handling failed, paste text\r\n  try {\r\n    const text = await navigator.clipboard.readText();\r\n    if (text) pasteToTerminal(sessionId, text);\r\n  } catch {\r\n    // Text paste failed\r\n  }\r\n}\r\n", "/**\r\n * Terminal Search Module\r\n *\r\n * Handles xterm.js search addon functionality, including the search UI,\r\n * keyboard shortcuts, and search result navigation.\r\n */\r\n\r\nimport { sessionTerminals, activeSessionId } from '../../state';\r\n\r\ndeclare const SearchAddon: any;\r\n\r\ninterface SearchState {\r\n  addon: any;\r\n  currentIndex: number;\r\n  totalMatches: number;\r\n}\r\n\r\nconst searchStates = new Map<string, SearchState>();\r\n\r\nlet searchVisible = false;\r\nlet searchInput: HTMLInputElement | null = null;\r\nlet searchResults: HTMLElement | null = null;\r\nlet searchContainer: HTMLElement | null = null;\r\n\r\n/**\r\n * Initialize search addon for a terminal\r\n */\r\nexport function initSearchForTerminal(sessionId: string, terminal: any): void {\r\n  try {\r\n    const addon = new SearchAddon.SearchAddon();\r\n    terminal.loadAddon(addon);\r\n    searchStates.set(sessionId, { addon, currentIndex: 0, totalMatches: 0 });\r\n  } catch {\r\n    // Search addon failed to load\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up search state for a session\r\n */\r\nexport function cleanupSearchForTerminal(sessionId: string): void {\r\n  searchStates.delete(sessionId);\r\n}\r\n\r\n/**\r\n * Show the search UI\r\n */\r\nexport function showSearch(): void {\r\n  if (!searchContainer) {\r\n    searchContainer = document.getElementById('terminal-search');\r\n    searchInput = document.getElementById('search-input') as HTMLInputElement;\r\n    searchResults = document.getElementById('search-results');\r\n  }\r\n\r\n  if (searchContainer && searchInput) {\r\n    searchContainer.classList.remove('hidden');\r\n    searchVisible = true;\r\n    searchInput.focus();\r\n    searchInput.select();\r\n  }\r\n}\r\n\r\n/**\r\n * Hide the search UI\r\n */\r\nexport function hideSearch(): void {\r\n  if (searchContainer) {\r\n    searchContainer.classList.add('hidden');\r\n    searchVisible = false;\r\n  }\r\n\r\n  // Clear decorations from active terminal\r\n  if (activeSessionId) {\r\n    const state = searchStates.get(activeSessionId);\r\n    if (state?.addon) {\r\n      state.addon.clearDecorations();\r\n    }\r\n  }\r\n\r\n  // Return focus to terminal\r\n  if (activeSessionId) {\r\n    const termState = sessionTerminals.get(activeSessionId);\r\n    if (termState) {\r\n      termState.terminal.focus();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Check if search is visible\r\n */\r\nexport function isSearchVisible(): boolean {\r\n  return searchVisible;\r\n}\r\n\r\n/**\r\n * Find next match\r\n */\r\nexport function findNext(): void {\r\n  if (!activeSessionId || !searchInput) return;\r\n\r\n  const query = searchInput.value;\r\n  if (!query) return;\r\n\r\n  const state = searchStates.get(activeSessionId);\r\n  if (!state?.addon) return;\r\n\r\n  const result = state.addon.findNext(query, { incremental: false });\r\n  updateSearchResults(result);\r\n}\r\n\r\n/**\r\n * Find previous match\r\n */\r\nexport function findPrevious(): void {\r\n  if (!activeSessionId || !searchInput) return;\r\n\r\n  const query = searchInput.value;\r\n  if (!query) return;\r\n\r\n  const state = searchStates.get(activeSessionId);\r\n  if (!state?.addon) return;\r\n\r\n  const result = state.addon.findPrevious(query);\r\n  updateSearchResults(result);\r\n}\r\n\r\n/**\r\n * Update search results display\r\n */\r\nfunction updateSearchResults(found: boolean): void {\r\n  if (searchResults) {\r\n    if (found) {\r\n      searchResults.textContent = 'Found';\r\n      searchResults.style.color = '';\r\n    } else {\r\n      searchResults.textContent = 'No matches';\r\n      searchResults.style.color = 'var(--accent-red)';\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Bind search UI event handlers\r\n */\r\nexport function bindSearchEvents(): void {\r\n  const searchInput = document.getElementById('search-input') as HTMLInputElement;\r\n  const prevBtn = document.getElementById('search-prev');\r\n  const nextBtn = document.getElementById('search-next');\r\n  const closeBtn = document.getElementById('search-close');\r\n\r\n  if (searchInput) {\r\n    searchInput.addEventListener('input', () => {\r\n      if (activeSessionId && searchInput.value) {\r\n        findNext();\r\n      } else if (searchResults) {\r\n        searchResults.textContent = '0/0';\r\n        searchResults.style.color = '';\r\n      }\r\n    });\r\n\r\n    searchInput.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        if (e.shiftKey) {\r\n          findPrevious();\r\n        } else {\r\n          findNext();\r\n        }\r\n      } else if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        hideSearch();\r\n      }\r\n    });\r\n  }\r\n\r\n  if (prevBtn) {\r\n    prevBtn.addEventListener('click', findPrevious);\r\n  }\r\n\r\n  if (nextBtn) {\r\n    nextBtn.addEventListener('click', findNext);\r\n  }\r\n\r\n  if (closeBtn) {\r\n    closeBtn.addEventListener('click', hideSearch);\r\n  }\r\n}\r\n", "/**\r\n * Terminal Manager Module\r\n *\r\n * Handles xterm.js terminal lifecycle, creation, destruction,\r\n * and event binding for terminal sessions.\r\n */\r\n\r\nimport type { Session, TerminalState } from '../../types';\r\nimport { THEMES, MOBILE_BREAKPOINT, TERMINAL_FONT_STACK } from '../../constants';\r\nimport {\r\n  sessionTerminals,\r\n  currentSettings,\r\n  activeSessionId,\r\n  pendingOutputFrames,\r\n  fontsReadyPromise,\r\n  dom,\r\n  setFontsReadyPromise,\r\n  windowsBuildNumber,\r\n  sessions\r\n} from '../../state';\r\nimport { getClipboardStyle, parseOutputFrame } from '../../utils';\r\nimport { applyTerminalScaling, fitSessionToScreen } from './scaling';\r\nimport { setupFileDrop, handleClipboardPaste } from './fileDrop';\r\n\r\ndeclare const Terminal: any;\r\ndeclare const FitAddon: any;\r\ndeclare const WebglAddon: any;\r\ndeclare const WebLinksAddon: any;\r\ndeclare const SearchAddon: any;\r\n\r\nimport { initSearchForTerminal, showSearch, isSearchVisible, hideSearch, cleanupSearchForTerminal } from './search';\r\n\r\n// Forward declarations for functions from other modules\r\nlet sendInput: (sessionId: string, data: string) => void = () => {};\r\nlet showBellNotification: (sessionId: string) => void = () => {};\r\n\r\n// Debounce timers for auto-rename from shell title\r\nconst pendingTitleUpdates = new Map<string, number>();\r\n\r\n/**\r\n * Auto-update session name from shell title (with debounce)\r\n */\r\nfunction updateSessionNameAuto(sessionId: string, name: string): void {\r\n  const session = sessions.find(s => s.id === sessionId);\r\n  if (session?.manuallyNamed) return;\r\n\r\n  const existing = pendingTitleUpdates.get(sessionId);\r\n  if (existing) {\r\n    window.clearTimeout(existing);\r\n  }\r\n\r\n  const timer = window.setTimeout(() => {\r\n    pendingTitleUpdates.delete(sessionId);\r\n    fetch(`/api/sessions/${sessionId}/name?auto=true`, {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ name })\r\n    }).catch(() => {});\r\n  }, 500);\r\n\r\n  pendingTitleUpdates.set(sessionId, timer);\r\n}\r\n\r\n/**\r\n * Register callbacks from other modules\r\n */\r\nexport function registerTerminalCallbacks(callbacks: {\r\n  sendInput?: (sessionId: string, data: string) => void;\r\n  showBellNotification?: (sessionId: string) => void;\r\n}): void {\r\n  if (callbacks.sendInput) sendInput = callbacks.sendInput;\r\n  if (callbacks.showBellNotification) showBellNotification = callbacks.showBellNotification;\r\n}\r\n\r\n/**\r\n * Get terminal options based on current settings\r\n */\r\nexport function getTerminalOptions(): object {\r\n  const isMobile = window.innerWidth <= MOBILE_BREAKPOINT;\r\n  const baseFontSize = currentSettings?.fontSize ?? 14;\r\n  const fontSize = isMobile ? Math.max(baseFontSize - 2, 10) : baseFontSize;\r\n  const themeName = currentSettings?.theme ?? 'dark';\r\n  const fontFamily = currentSettings?.fontFamily ?? 'Cascadia Code';\r\n\r\n  const options: Record<string, unknown> = {\r\n    cursorBlink: currentSettings?.cursorBlink ?? true,\r\n    cursorStyle: currentSettings?.cursorStyle ?? 'bar',\r\n    fontFamily: `'${fontFamily}', ${TERMINAL_FONT_STACK}`,\r\n    fontSize: fontSize,\r\n    letterSpacing: 0,\r\n    lineHeight: 1,\r\n    scrollback: currentSettings?.scrollbackLines ?? 10000,\r\n    minimumContrastRatio: currentSettings?.minimumContrastRatio ?? 1,\r\n    smoothScrollDuration: currentSettings?.smoothScrolling ? 150 : 0,\r\n    allowProposedApi: true,\r\n    customGlyphs: true,\r\n    rescaleOverlappingGlyphs: true,\r\n    theme: THEMES[themeName] ?? THEMES.dark\r\n  };\r\n\r\n  if (windowsBuildNumber !== null) {\r\n    options.windowsPty = {\r\n      backend: 'conpty',\r\n      buildNumber: windowsBuildNumber\r\n    };\r\n  }\r\n\r\n  return options;\r\n}\r\n\r\n/**\r\n * Create a terminal instance for a session.\r\n * Returns existing state if terminal already exists.\r\n */\r\nexport function createTerminalForSession(\r\n  sessionId: string,\r\n  sessionInfo: Session | undefined\r\n): TerminalState {\r\n  const existing = sessionTerminals.get(sessionId);\r\n  if (existing) {\r\n    return existing;\r\n  }\r\n\r\n  // Create container\r\n  const container = document.createElement('div');\r\n  container.className = 'terminal-container hidden';\r\n  container.id = 'terminal-' + sessionId;\r\n  dom.terminalsArea?.appendChild(container);\r\n\r\n  // Set up file drop handler for drag-and-drop uploads\r\n  setupFileDrop(container);\r\n\r\n  // Initialize xterm.js\r\n  const terminal = new Terminal(getTerminalOptions());\r\n  const fitAddon = new FitAddon.FitAddon();\r\n  terminal.loadAddon(fitAddon);\r\n\r\n  // Get server dimensions from session info (if available)\r\n  const serverCols = sessionInfo && sessionInfo.cols > 0 ? sessionInfo.cols : 0;\r\n  const serverRows = sessionInfo && sessionInfo.rows > 0 ? sessionInfo.rows : 0;\r\n\r\n  const state: TerminalState = {\r\n    terminal: terminal,\r\n    fitAddon: fitAddon,\r\n    container: container,\r\n    serverCols: serverCols,\r\n    serverRows: serverRows,\r\n    opened: false\r\n  };\r\n\r\n  sessionTerminals.set(sessionId, state);\r\n\r\n  // Wait for fonts to be ready before opening terminal\r\n  // This ensures xterm.js measures the correct font for canvas rendering\r\n  (fontsReadyPromise ?? Promise.resolve()).then(() => {\r\n    if (!sessionTerminals.has(sessionId)) return; // Session was deleted\r\n    terminal.open(container);\r\n    state.opened = true;\r\n\r\n    // Load WebGL addon for GPU-accelerated rendering (with fallback)\r\n    if (currentSettings?.useWebGL !== false) {\r\n      try {\r\n        const webglAddon = new WebglAddon.WebglAddon();\r\n        webglAddon.onContextLost(() => {\r\n          webglAddon.dispose();\r\n        });\r\n        terminal.loadAddon(webglAddon);\r\n      } catch {\r\n        // WebGL not available, using canvas renderer\r\n      }\r\n    }\r\n\r\n    // Load Web-Links addon for clickable URLs\r\n    try {\r\n      const webLinksAddon = new WebLinksAddon.WebLinksAddon(\r\n        (_event: MouseEvent, uri: string) => {\r\n          if (uri.startsWith('http://') || uri.startsWith('https://')) {\r\n            window.open(uri, '_blank', 'noopener,noreferrer');\r\n          }\r\n        }\r\n      );\r\n      terminal.loadAddon(webLinksAddon);\r\n    } catch {\r\n      // Web-Links addon failed to load\r\n    }\r\n\r\n    // Load Search addon for Ctrl+F search\r\n    initSearchForTerminal(sessionId, terminal);\r\n\r\n    // Replay any WebSocket frames that arrived before terminal was opened\r\n    replayPendingFrames(sessionId, state);\r\n\r\n    // Defer resize to next frame - xterm.js needs a frame to fully initialize after open()\r\n    requestAnimationFrame(() => {\r\n      if (!sessionTerminals.has(sessionId)) return; // Session was deleted\r\n\r\n      // Fit terminal to current viewport using actual measured cell dimensions\r\n      fitSessionToScreen(sessionId);\r\n\r\n      setupTerminalEvents(sessionId, terminal, container);\r\n    });\r\n  });\r\n\r\n  return state;\r\n}\r\n\r\n/**\r\n * Replay pending output frames that arrived before terminal was opened\r\n */\r\nfunction replayPendingFrames(sessionId: string, state: TerminalState): void {\r\n  const frames = pendingOutputFrames.get(sessionId);\r\n  if (frames && frames.length > 0) {\r\n    frames.forEach((payload) => {\r\n      writeOutputFrame(sessionId, state, payload);\r\n    });\r\n    pendingOutputFrames.delete(sessionId);\r\n  }\r\n}\r\n\r\n/**\r\n * Write an output frame to the terminal, handling dimension updates\r\n */\r\nexport function writeOutputFrame(\r\n  sessionId: string,\r\n  state: TerminalState,\r\n  payload: Uint8Array\r\n): void {\r\n  const frame = parseOutputFrame(payload);\r\n\r\n  // Ensure terminal matches frame dimensions before writing\r\n  if (frame.valid && state.terminal._core && state.terminal._core._renderService) {\r\n    const currentCols = state.terminal.cols;\r\n    const currentRows = state.terminal.rows;\r\n\r\n    if (currentCols !== frame.cols || currentRows !== frame.rows) {\r\n      try {\r\n        state.terminal.resize(frame.cols, frame.rows);\r\n        state.serverCols = frame.cols;\r\n        state.serverRows = frame.rows;\r\n        applyTerminalScaling(sessionId, state);\r\n      } catch {\r\n        // Ignore resize errors - terminal may not be fully initialized\r\n      }\r\n    }\r\n  }\r\n\r\n  // Write terminal data\r\n  if (frame.data.length > 0) {\r\n    state.terminal.write(frame.data);\r\n  }\r\n}\r\n\r\n/**\r\n * Set up terminal event handlers for input, bell, selection, etc.\r\n */\r\nexport function setupTerminalEvents(\r\n  sessionId: string,\r\n  terminal: any,\r\n  container: HTMLDivElement\r\n): void {\r\n  // Wire up events\r\n  terminal.onData((data: string) => {\r\n    sendInput(sessionId, data);\r\n  });\r\n\r\n  terminal.onBell(() => {\r\n    showBellNotification(sessionId);\r\n  });\r\n\r\n  terminal.onSelectionChange(() => {\r\n    if (currentSettings?.copyOnSelect && terminal.hasSelection()) {\r\n      navigator.clipboard.writeText(terminal.getSelection()).catch(() => {});\r\n    }\r\n  });\r\n\r\n  // Auto-update session name from shell title\r\n  terminal.onTitleChange((title: string) => {\r\n    if (title && title.trim()) {\r\n      updateSessionNameAuto(sessionId, title.trim());\r\n    }\r\n  });\r\n\r\n  // Keyboard shortcuts for copy/paste\r\n  terminal.attachCustomKeyEventHandler((e: KeyboardEvent) => {\r\n    if (e.type !== 'keydown') return true;\r\n\r\n    // Ctrl+Enter: Send LF (\\n) instead of CR (\\r) for TUI apps that use it for line breaks\r\n    if (e.ctrlKey && !e.shiftKey && !e.altKey && !e.metaKey && e.key === 'Enter') {\r\n      sendInput(sessionId, '\\n');\r\n      return false;\r\n    }\r\n\r\n    const style = getClipboardStyle(currentSettings?.clipboardShortcuts ?? 'auto');\r\n\r\n    if (style === 'windows') {\r\n      // Ctrl+C: copy if selected, else let terminal handle (SIGINT)\r\n      if (e.ctrlKey && !e.shiftKey && e.key === 'c') {\r\n        if (terminal.hasSelection()) {\r\n          navigator.clipboard.writeText(terminal.getSelection()).catch(() => {});\r\n          terminal.clearSelection();\r\n          return false;\r\n        }\r\n        return true;\r\n      }\r\n      // Ctrl+V: paste (images uploaded, text pasted)\r\n      if (e.ctrlKey && !e.shiftKey && e.key === 'v') {\r\n        handleClipboardPaste(sessionId);\r\n        return false;\r\n      }\r\n    } else {\r\n      // Unix: Ctrl+Shift+C to copy\r\n      if (e.ctrlKey && e.shiftKey && (e.key === 'C' || e.key === 'c')) {\r\n        if (terminal.hasSelection()) {\r\n          navigator.clipboard.writeText(terminal.getSelection()).catch(() => {});\r\n          terminal.clearSelection();\r\n        }\r\n        return false;\r\n      }\r\n      // Unix: Ctrl+Shift+V to paste (images uploaded, text pasted)\r\n      if (e.ctrlKey && e.shiftKey && (e.key === 'V' || e.key === 'v')) {\r\n        handleClipboardPaste(sessionId);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // Ctrl+F / Cmd+F: Open search\r\n    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {\r\n      showSearch();\r\n      return false;\r\n    }\r\n\r\n    // Escape: Close search if open\r\n    if (e.key === 'Escape' && isSearchVisible()) {\r\n      hideSearch();\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  });\r\n\r\n  // Prevent browser paste event - we handle it ourselves via handleClipboardPaste\r\n  // This prevents xterm.js from also handling paste via onData\r\n  // Use capture phase to intercept before xterm.js\r\n  const pasteHandler = (e: ClipboardEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n  };\r\n  container.addEventListener('paste', pasteHandler, true);\r\n\r\n  // Right-click paste (images uploaded, text pasted)\r\n  const contextMenuHandler = (e: MouseEvent) => {\r\n    if (!currentSettings || currentSettings.rightClickPaste !== false) {\r\n      e.preventDefault();\r\n      handleClipboardPaste(sessionId);\r\n    }\r\n  };\r\n\r\n  container.addEventListener('contextmenu', contextMenuHandler);\r\n\r\n  // Store handler references for cleanup\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (state) {\r\n    state.contextMenuHandler = contextMenuHandler;\r\n    state.pasteHandler = pasteHandler;\r\n  }\r\n}\r\n\r\n/**\r\n * Destroy a terminal for a session and clean up resources\r\n */\r\nexport function destroyTerminalForSession(sessionId: string): void {\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (!state) return;\r\n\r\n  // Clean up event listeners\r\n  if (state.contextMenuHandler) {\r\n    state.container.removeEventListener('contextmenu', state.contextMenuHandler);\r\n  }\r\n  if (state.pasteHandler) {\r\n    state.container.removeEventListener('paste', state.pasteHandler, true);\r\n  }\r\n\r\n  // Clean up search addon state\r\n  cleanupSearchForTerminal(sessionId);\r\n\r\n  // Clean up pending title update timer\r\n  const titleTimer = pendingTitleUpdates.get(sessionId);\r\n  if (titleTimer) {\r\n    clearTimeout(titleTimer);\r\n    pendingTitleUpdates.delete(sessionId);\r\n  }\r\n\r\n  state.terminal.dispose();\r\n  state.container.remove();\r\n  sessionTerminals.delete(sessionId);\r\n  pendingOutputFrames.delete(sessionId);\r\n}\r\n\r\n/**\r\n * Paste text to a terminal using xterm.js paste() method\r\n * This respects bracketed paste mode if the application enabled it\r\n */\r\nexport function pasteToTerminal(sessionId: string, data: string): void {\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (!state) return;\r\n  state.terminal.paste(data);\r\n}\r\n\r\n/**\r\n * Apply current settings to all existing terminals\r\n */\r\nexport function applySettingsToTerminals(): void {\r\n  const options = getTerminalOptions();\r\n  sessionTerminals.forEach((state) => {\r\n    state.terminal.options.cursorBlink = (options as any).cursorBlink;\r\n    state.terminal.options.cursorStyle = (options as any).cursorStyle;\r\n    state.terminal.options.fontSize = (options as any).fontSize;\r\n    state.terminal.options.theme = (options as any).theme;\r\n  });\r\n}\r\n\r\n/**\r\n * Fetch and write terminal buffer from server\r\n */\r\nexport function fetchAndWriteBuffer(sessionId: string, terminal: any): void {\r\n  fetch('/api/sessions/' + sessionId + '/buffer')\r\n    .then((response) => {\r\n      return response.ok ? response.text() : '';\r\n    })\r\n    .then((buffer) => {\r\n      if (buffer) {\r\n        terminal.write(buffer);\r\n      }\r\n    })\r\n    .catch((e) => {\r\n      console.error('Error fetching buffer:', e);\r\n    });\r\n}\r\n\r\n/**\r\n * Refresh the active terminal buffer by clearing and re-fetching\r\n */\r\nexport function refreshActiveTerminalBuffer(): void {\r\n  if (!activeSessionId) return;\r\n  const state = sessionTerminals.get(activeSessionId);\r\n  if (state && state.opened) {\r\n    // Clear and re-fetch the entire buffer to ensure consistency\r\n    state.terminal.clear();\r\n    fetchAndWriteBuffer(activeSessionId, state.terminal);\r\n  }\r\n}\r\n\r\n/**\r\n * Preload the terminal font for consistent rendering\r\n */\r\nexport function preloadTerminalFont(): Promise<void> {\r\n  const promise = document.fonts.ready.then(() => {\r\n    // Trigger font load by measuring with the font family\r\n    const testSpan = document.createElement('span');\r\n    testSpan.style.fontFamily = TERMINAL_FONT_STACK;\r\n    testSpan.style.position = 'absolute';\r\n    testSpan.style.left = '-9999px';\r\n    testSpan.textContent = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    document.body.appendChild(testSpan);\r\n\r\n    return new Promise<void>((resolve) => {\r\n      requestAnimationFrame(() => {\r\n        testSpan.remove();\r\n        resolve();\r\n      });\r\n    });\r\n  });\r\n\r\n  setFontsReadyPromise(promise);\r\n  return promise;\r\n}\r\n", "/**\r\n * Terminal Module\r\n *\r\n * Re-exports terminal management and scaling functionality.\r\n */\r\n\r\nexport * from './manager';\r\nexport * from './scaling';\r\nexport * from './search';\r\nexport * from './fileDrop';\r\n", "/**\r\n * Settings Persistence Module\r\n *\r\n * Handles loading, saving, and form binding for application settings.\r\n * Communicates with the server API to persist settings changes.\r\n */\r\n\r\nimport type { Settings, ThemeName, TerminalState } from '../../types';\r\nimport { THEMES, TERMINAL_FONT_STACK } from '../../constants';\r\nimport { currentSettings, setCurrentSettings, dom, sessionTerminals } from '../../state';\r\nimport { setCookie } from '../../utils';\r\n\r\n/**\r\n * Set the value of a form element by ID\r\n */\r\nexport function setElementValue(id: string, value: string | number): void {\r\n  const el = document.getElementById(id) as HTMLInputElement | HTMLSelectElement | null;\r\n  if (el) el.value = String(value);\r\n}\r\n\r\n/**\r\n * Set the checked state of a checkbox by ID\r\n */\r\nexport function setElementChecked(id: string, checked: boolean): void {\r\n  const el = document.getElementById(id) as HTMLInputElement | null;\r\n  if (el) el.checked = checked;\r\n}\r\n\r\n/**\r\n * Get the value of a form element by ID\r\n */\r\nexport function getElementValue(id: string, defaultValue: string): string {\r\n  const el = document.getElementById(id) as HTMLInputElement | HTMLSelectElement | null;\r\n  return el ? el.value : defaultValue;\r\n}\r\n\r\n/**\r\n * Get the checked state of a checkbox by ID\r\n */\r\nexport function getElementChecked(id: string): boolean {\r\n  const el = document.getElementById(id) as HTMLInputElement | null;\r\n  return el ? el.checked : false;\r\n}\r\n\r\n/**\r\n * Populate version info in the about section\r\n */\r\nexport function populateVersionInfo(version: string | null): void {\r\n  const webEl = document.getElementById('version-web');\r\n  if (webEl && version) {\r\n    const shortVersion = version.split(/[+-]/)[0].split('.').slice(0, 3).join('.');\r\n    webEl.textContent = 'v' + shortVersion;\r\n  }\r\n}\r\n\r\n/**\r\n * Populate user dropdown for run-as-user selection\r\n */\r\nexport function populateUserDropdown(\r\n  users: Array<{ username: string }>,\r\n  selectedUser: string | null\r\n): void {\r\n  const select = document.getElementById('setting-run-as-user') as HTMLSelectElement | null;\r\n  if (!select) return;\r\n\r\n  select.innerHTML = '<option value=\"\">Process Owner (default)</option>';\r\n\r\n  users.forEach((user) => {\r\n    const option = document.createElement('option');\r\n    option.value = user.username;\r\n    option.textContent = user.username;\r\n    if (user.username === selectedUser) {\r\n      option.selected = true;\r\n    }\r\n    select.appendChild(option);\r\n  });\r\n}\r\n\r\n/**\r\n * Populate the settings form with current settings\r\n */\r\nexport function populateSettingsForm(settings: Settings): void {\r\n  setElementValue('setting-default-shell', settings.defaultShell || 'Pwsh');\r\n  setElementValue('setting-working-dir', settings.defaultWorkingDirectory || '');\r\n  setElementValue('setting-font-size', settings.fontSize || 14);\r\n  setElementValue('setting-font-family', settings.fontFamily || 'Cascadia Code');\r\n  setElementValue('setting-cursor-style', settings.cursorStyle || 'bar');\r\n  setElementChecked('setting-cursor-blink', settings.cursorBlink !== false);\r\n  setElementValue('setting-theme', settings.theme || 'dark');\r\n  setElementValue('setting-contrast', String(settings.minimumContrastRatio || 1));\r\n  setElementValue('setting-scrollback', settings.scrollbackLines || 10000);\r\n  setElementValue('setting-bell-style', settings.bellStyle || 'notification');\r\n  setElementChecked('setting-copy-on-select', settings.copyOnSelect === true);\r\n  setElementChecked('setting-right-click-paste', settings.rightClickPaste !== false);\r\n  setElementValue('setting-clipboard-shortcuts', settings.clipboardShortcuts || 'auto');\r\n  setElementChecked('setting-smooth-scrolling', settings.smoothScrolling === true);\r\n  setElementChecked('setting-webgl', settings.useWebGL !== false);\r\n  setElementValue('setting-run-as-user', settings.runAsUser || '');\r\n  setElementChecked('setting-debug-logging', settings.debugLogging === true);\r\n}\r\n\r\n/**\r\n * Fetch settings, users, and version from server and populate the form\r\n */\r\nexport async function fetchSettings(): Promise<void> {\r\n  try {\r\n    const [settings, users, version] = await Promise.all([\r\n      fetch('/api/settings').then((r) => r.json() as Promise<Settings>),\r\n      fetch('/api/users')\r\n        .then((r) => r.json() as Promise<Array<{ username: string }>>)\r\n        .catch(() => [] as Array<{ username: string }>),\r\n      fetch('/api/version')\r\n        .then((r) => r.text())\r\n        .catch(() => null)\r\n    ]);\r\n\r\n    setCurrentSettings(settings);\r\n    populateUserDropdown(users, settings.runAsUser);\r\n    populateSettingsForm(settings);\r\n    populateVersionInfo(version);\r\n\r\n    // Apply settings to any terminals that were created before settings loaded\r\n    applySettingsToTerminals();\r\n  } catch (e) {\r\n    console.error('Error fetching settings:', e);\r\n  }\r\n}\r\n\r\n/**\r\n * Apply current settings to all open terminals\r\n */\r\nfunction applySettingsToTerminals(): void {\r\n  if (!currentSettings) return;\r\n\r\n  const theme = THEMES[currentSettings.theme] || THEMES.dark;\r\n  const fontFamily = `'${currentSettings.fontFamily || 'Cascadia Code'}', ${TERMINAL_FONT_STACK}`;\r\n\r\n  sessionTerminals.forEach((state: TerminalState) => {\r\n    state.terminal.options.cursorBlink = currentSettings.cursorBlink;\r\n    state.terminal.options.cursorStyle = currentSettings.cursorStyle;\r\n    state.terminal.options.fontFamily = fontFamily;\r\n    state.terminal.options.fontSize = currentSettings.fontSize;\r\n    state.terminal.options.theme = theme;\r\n    state.terminal.options.minimumContrastRatio = currentSettings.minimumContrastRatio;\r\n    state.terminal.options.smoothScrollDuration = currentSettings.smoothScrolling ? 150 : 0;\r\n\r\n    // Trigger re-render after font changes\r\n    if (state.opened) {\r\n      try {\r\n        const dims = state.fitAddon.proposeDimensions();\r\n        if (dims?.cols && dims?.rows) {\r\n          state.fitAddon.fit();\r\n        }\r\n      } catch {\r\n        // FitAddon may fail if terminal render service isn't initialized\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Save all settings to the server\r\n */\r\nexport function saveAllSettings(): void {\r\n  const runAsUserValue = getElementValue('setting-run-as-user', '');\r\n  const settings: Settings = {\r\n    defaultShell: getElementValue('setting-default-shell', 'Pwsh'),\r\n    defaultWorkingDirectory: getElementValue('setting-working-dir', ''),\r\n    fontSize: parseInt(getElementValue('setting-font-size', '14'), 10) || 14,\r\n    fontFamily: getElementValue('setting-font-family', 'Cascadia Code'),\r\n    cursorStyle: getElementValue('setting-cursor-style', 'bar') as Settings['cursorStyle'],\r\n    cursorBlink: getElementChecked('setting-cursor-blink'),\r\n    theme: getElementValue('setting-theme', 'dark') as ThemeName,\r\n    minimumContrastRatio: parseFloat(getElementValue('setting-contrast', '1')) || 1,\r\n    smoothScrolling: getElementChecked('setting-smooth-scrolling'),\r\n    useWebGL: getElementChecked('setting-webgl'),\r\n    scrollbackLines: parseInt(getElementValue('setting-scrollback', '10000'), 10) || 10000,\r\n    bellStyle: getElementValue('setting-bell-style', 'notification') as Settings['bellStyle'],\r\n    copyOnSelect: getElementChecked('setting-copy-on-select'),\r\n    rightClickPaste: getElementChecked('setting-right-click-paste'),\r\n    clipboardShortcuts: getElementValue(\r\n      'setting-clipboard-shortcuts',\r\n      'auto'\r\n    ) as Settings['clipboardShortcuts'],\r\n    runAsUser: runAsUserValue || null,\r\n    debugLogging: getElementChecked('setting-debug-logging')\r\n  };\r\n\r\n  setCookie('mm-theme', settings.theme);\r\n\r\n  fetch('/api/settings', {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(settings)\r\n  })\r\n    .then((r) => {\r\n      if (r.ok) {\r\n        setCurrentSettings(settings);\r\n        const theme = THEMES[settings.theme] || THEMES.dark;\r\n        document.documentElement.style.setProperty('--terminal-bg', theme.background);\r\n        applySettingsToTerminals();\r\n      }\r\n    })\r\n    .catch((e) => {\r\n      console.error('Error saving settings:', e);\r\n    });\r\n}\r\n\r\n/**\r\n * Bind auto-save behavior to settings form elements\r\n */\r\nexport function bindSettingsAutoSave(): void {\r\n  const settingsView = dom.settingsView;\r\n  if (!settingsView) return;\r\n\r\n  settingsView.querySelectorAll('select, input[type=\"checkbox\"]').forEach((el) => {\r\n    el.addEventListener('change', saveAllSettings);\r\n  });\r\n\r\n  settingsView.querySelectorAll('.text-input-wrapper').forEach((wrapper) => {\r\n    const input = wrapper.querySelector('input') as HTMLInputElement | null;\r\n    const saveBtn = wrapper.querySelector('.inline-save-btn') as HTMLButtonElement | null;\r\n    if (!input || !saveBtn) return;\r\n\r\n    let originalValue = '';\r\n\r\n    input.addEventListener('focus', () => {\r\n      originalValue = input.value;\r\n    });\r\n\r\n    input.addEventListener('input', () => {\r\n      wrapper.classList.toggle('unsaved', input.value !== originalValue);\r\n    });\r\n\r\n    saveBtn.addEventListener('click', () => {\r\n      saveAllSettings();\r\n      wrapper.classList.remove('unsaved');\r\n      originalValue = input.value;\r\n    });\r\n\r\n    input.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter') {\r\n        e.preventDefault();\r\n        saveAllSettings();\r\n        wrapper.classList.remove('unsaved');\r\n        originalValue = input.value;\r\n      }\r\n    });\r\n  });\r\n}\r\n", "/**\r\n * Settings Panel Module\r\n *\r\n * Handles the settings panel UI visibility, system status display,\r\n * and health check functionality.\r\n */\r\n\r\nimport type { HealthResponse } from '../../types';\r\nimport {\r\n  settingsOpen,\r\n  setSettingsOpen,\r\n  activeSessionId,\r\n  sessionTerminals,\r\n  sessions,\r\n  dom,\r\n  setWindowsBuildNumber\r\n} from '../../state';\r\nimport { fetchSettings } from './persistence';\r\n\r\n/**\r\n * Close the mobile sidebar\r\n */\r\nfunction closeSidebar(): void {\r\n  const app = dom.app;\r\n  if (app) app.classList.remove('sidebar-open');\r\n}\r\n\r\n/**\r\n * Toggle the settings panel visibility\r\n */\r\nexport function toggleSettings(): void {\r\n  if (settingsOpen) {\r\n    closeSettings();\r\n  } else {\r\n    openSettings();\r\n  }\r\n}\r\n\r\n/**\r\n * Open the settings panel\r\n */\r\nexport function openSettings(): void {\r\n  setSettingsOpen(true);\r\n  if (dom.settingsBtn) dom.settingsBtn.classList.add('active');\r\n  closeSidebar();\r\n\r\n  if (activeSessionId) {\r\n    const state = sessionTerminals.get(activeSessionId);\r\n    if (state) state.container.classList.add('hidden');\r\n  }\r\n\r\n  if (dom.emptyState) dom.emptyState.classList.add('hidden');\r\n  if (dom.settingsView) dom.settingsView.classList.remove('hidden');\r\n\r\n  fetchSettings();\r\n  fetchSystemStatus();\r\n}\r\n\r\n/**\r\n * Close the settings panel\r\n */\r\nexport function closeSettings(): void {\r\n  setSettingsOpen(false);\r\n  if (dom.settingsBtn) dom.settingsBtn.classList.remove('active');\r\n  if (dom.settingsView) dom.settingsView.classList.add('hidden');\r\n\r\n  if (activeSessionId) {\r\n    const state = sessionTerminals.get(activeSessionId);\r\n    if (state) {\r\n      state.container.classList.remove('hidden');\r\n      requestAnimationFrame(() => {\r\n        state.terminal.focus();\r\n      });\r\n    }\r\n  } else if (sessions.length === 0 && dom.emptyState) {\r\n    dom.emptyState.classList.remove('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Format uptime seconds into human-readable string\r\n */\r\nexport function formatUptime(seconds: number): string {\r\n  if (seconds < 60) return seconds + 's';\r\n  if (seconds < 3600) return Math.floor(seconds / 60) + 'm ' + (seconds % 60) + 's';\r\n\r\n  const hours = Math.floor(seconds / 3600);\r\n  const mins = Math.floor((seconds % 3600) / 60);\r\n\r\n  if (hours < 24) return hours + 'h ' + mins + 'm';\r\n\r\n  const days = Math.floor(hours / 24);\r\n  return days + 'd ' + (hours % 24) + 'h';\r\n}\r\n\r\n/**\r\n * Update the con-host version mismatch warning banner\r\n */\r\nexport function updateConHostWarning(health: HealthResponse): void {\r\n  let banner = document.getElementById('conhost-warning');\r\n\r\n  if (!banner) {\r\n    banner = document.createElement('div');\r\n    banner.id = 'conhost-warning';\r\n    banner.className = 'warning-banner';\r\n    const header = document.querySelector('.app-header');\r\n    if (header && header.parentNode) {\r\n      header.parentNode.insertBefore(banner, header.nextSibling);\r\n    }\r\n  }\r\n\r\n  if (health.conHostVersion && health.conHostCompatible === false) {\r\n    banner.innerHTML =\r\n      '<strong>Version mismatch:</strong> mmttyhost is ' +\r\n      health.conHostVersion +\r\n      ', expected ' +\r\n      health.conHostExpected +\r\n      '. Terminals may not work correctly. Please update mmttyhost.exe or restart the service.';\r\n    banner.style.display = 'block';\r\n  } else {\r\n    banner.style.display = 'none';\r\n  }\r\n}\r\n\r\n/**\r\n * Fetch and display system status in the settings panel\r\n */\r\nexport function fetchSystemStatus(): void {\r\n  const container = document.getElementById('system-status-content');\r\n  if (!container) return;\r\n\r\n  fetch('/api/health')\r\n    .then((response) => response.json() as Promise<HealthResponse>)\r\n    .then((health) => {\r\n      const statusClass = health.healthy ? 'status-healthy' : 'status-error';\r\n      const statusText = health.healthy ? 'Healthy' : 'Unhealthy';\r\n      const uptimeStr = formatUptime(health.uptimeSeconds || 0);\r\n\r\n      let conHostHtml = '';\r\n      if (health.conHostVersion !== null && health.conHostVersion !== undefined) {\r\n        const versionClass = health.conHostCompatible ? '' : 'status-error';\r\n        conHostHtml =\r\n          '<div class=\"status-detail-row\">' +\r\n          '<span class=\"detail-label\">mmttyhost</span>' +\r\n          '<span class=\"detail-value ' +\r\n          versionClass +\r\n          '\">' +\r\n          health.conHostVersion +\r\n          (health.conHostCompatible ? '' : ' expected ' + health.conHostExpected) +\r\n          '</span>' +\r\n          '</div>';\r\n      }\r\n\r\n      container.innerHTML =\r\n        '<div class=\"status-grid\">' +\r\n        '<div class=\"status-item\">' +\r\n        '<span class=\"status-label\">Status</span>' +\r\n        '<span class=\"status-value ' +\r\n        statusClass +\r\n        '\">' +\r\n        statusText +\r\n        '</span>' +\r\n        '</div>' +\r\n        '<div class=\"status-item\">' +\r\n        '<span class=\"status-label\">Mode</span>' +\r\n        '<span class=\"status-value\">' +\r\n        (health.mode || '') +\r\n        '</span>' +\r\n        '</div>' +\r\n        '<div class=\"status-item\">' +\r\n        '<span class=\"status-label\">Sessions</span>' +\r\n        '<span class=\"status-value\">' +\r\n        health.sessionCount +\r\n        '</span>' +\r\n        '</div>' +\r\n        '<div class=\"status-item\">' +\r\n        '<span class=\"status-label\">Uptime</span>' +\r\n        '<span class=\"status-value\">' +\r\n        uptimeStr +\r\n        '</span>' +\r\n        '</div>' +\r\n        '</div>' +\r\n        '<div class=\"status-details\">' +\r\n        '<div class=\"status-detail-row\">' +\r\n        '<span class=\"detail-label\">Platform</span>' +\r\n        '<span class=\"detail-value\">' +\r\n        (health.platform || '') +\r\n        '</span>' +\r\n        '</div>' +\r\n        '<div class=\"status-detail-row\">' +\r\n        '<span class=\"detail-label\">Process ID</span>' +\r\n        '<span class=\"detail-value\">' +\r\n        (health.webProcessId || '') +\r\n        '</span>' +\r\n        '</div>' +\r\n        conHostHtml +\r\n        '</div>';\r\n\r\n      updateConHostWarning(health);\r\n    })\r\n    .catch((err: unknown) => {\r\n      const message = err instanceof Error ? err.message : String(err);\r\n      container.innerHTML =\r\n        '<div class=\"status-error-msg\">Failed to load system status: ' + message + '</div>';\r\n    });\r\n}\r\n\r\n/**\r\n * Check system health on startup for version mismatches\r\n */\r\nexport function checkSystemHealth(): void {\r\n  fetch('/api/health')\r\n    .then((response) => response.json() as Promise<HealthResponse>)\r\n    .then((health) => {\r\n      updateConHostWarning(health);\r\n      if (health.windowsBuildNumber !== undefined) {\r\n        setWindowsBuildNumber(health.windowsBuildNumber);\r\n      }\r\n    })\r\n    .catch(() => {});\r\n}\r\n", "/**\r\n * Settings Module\r\n *\r\n * Re-exports settings panel and persistence functionality.\r\n */\r\n\r\nexport * from './panel';\r\nexport * from './persistence';\r\n", "/**\r\n * Theming Module\r\n *\r\n * Theme definitions and application to xterm.js terminals.\r\n */\r\n\r\nimport type { ThemeName, TerminalTheme } from '../../types';\r\nimport { THEMES } from '../../constants';\r\nimport { sessionTerminals, currentSettings } from '../../state';\r\nimport { setCookie } from '../../utils';\r\n\r\n/**\r\n * Get the current theme based on settings\r\n */\r\nexport function getCurrentTheme(): TerminalTheme {\r\n  const themeName = currentSettings?.theme || 'dark';\r\n  return THEMES[themeName] || THEMES.dark;\r\n}\r\n\r\n/**\r\n * Apply theme to all terminals\r\n */\r\nexport function applyThemeToTerminals(themeName: ThemeName): void {\r\n  const theme = THEMES[themeName];\r\n  if (!theme) return;\r\n\r\n  sessionTerminals.forEach((state) => {\r\n    state.terminal.options.theme = theme;\r\n  });\r\n}\r\n\r\n/**\r\n * Apply theme and persist to cookie\r\n */\r\nexport function setTheme(themeName: ThemeName): void {\r\n  setCookie('mm-theme', themeName);\r\n  applyThemeToTerminals(themeName);\r\n\r\n  // Update CSS variable for flash prevention\r\n  document.documentElement.style.setProperty('--terminal-bg', THEMES[themeName].background);\r\n}\r\n\r\n/**\r\n * Initialize theme from saved cookie\r\n */\r\nexport function initThemeFromCookie(): void {\r\n  const savedTheme = document.cookie.match(/mm-theme=([^;]+)/)?.[1] as ThemeName | undefined;\r\n  if (savedTheme && THEMES[savedTheme]) {\r\n    document.documentElement.style.setProperty('--terminal-bg', THEMES[savedTheme].background);\r\n  }\r\n}\r\n", "/**\r\n * State Channel Module\r\n *\r\n * Manages the state WebSocket connection for real-time session list updates.\r\n * Handles automatic reconnection with exponential backoff.\r\n */\r\n\r\nimport type { Session, UpdateInfo } from '../../types';\r\nimport { INITIAL_RECONNECT_DELAY, MAX_RECONNECT_DELAY } from '../../constants';\r\nimport { scheduleReconnect } from '../../utils';\r\nimport {\r\n  sessions,\r\n  activeSessionId,\r\n  stateWs,\r\n  stateReconnectTimer,\r\n  stateReconnectDelay,\r\n  stateWsConnected,\r\n  muxWsConnected,\r\n  sessionTerminals,\r\n  newlyCreatedSessions,\r\n  setStateWs,\r\n  setStateReconnectTimer,\r\n  setStateReconnectDelay,\r\n  setStateWsConnected,\r\n  setSessions,\r\n  setActiveSessionId,\r\n  setUpdateInfo\r\n} from '../../state';\r\n\r\n// Forward declarations for functions from other modules\r\n// These will be imported when those modules are created\r\nlet destroyTerminalForSession: (sessionId: string) => void = () => {};\r\nlet applyTerminalScaling: (sessionId: string, state: unknown) => void = () => {};\r\nlet renderSessionList: () => void = () => {};\r\nlet updateEmptyState: () => void = () => {};\r\nlet selectSession: (sessionId: string) => void = () => {};\r\nlet updateMobileTitle: () => void = () => {};\r\nlet renderUpdatePanel: () => void = () => {};\r\n\r\n/**\r\n * Register callbacks from other modules\r\n */\r\nexport function registerStateCallbacks(callbacks: {\r\n  destroyTerminalForSession?: (sessionId: string) => void;\r\n  applyTerminalScaling?: (sessionId: string, state: unknown) => void;\r\n  renderSessionList?: () => void;\r\n  updateEmptyState?: () => void;\r\n  selectSession?: (sessionId: string) => void;\r\n  updateMobileTitle?: () => void;\r\n  renderUpdatePanel?: () => void;\r\n}): void {\r\n  if (callbacks.destroyTerminalForSession) destroyTerminalForSession = callbacks.destroyTerminalForSession;\r\n  if (callbacks.applyTerminalScaling) applyTerminalScaling = callbacks.applyTerminalScaling;\r\n  if (callbacks.renderSessionList) renderSessionList = callbacks.renderSessionList;\r\n  if (callbacks.updateEmptyState) updateEmptyState = callbacks.updateEmptyState;\r\n  if (callbacks.selectSession) selectSession = callbacks.selectSession;\r\n  if (callbacks.updateMobileTitle) updateMobileTitle = callbacks.updateMobileTitle;\r\n  if (callbacks.renderUpdatePanel) renderUpdatePanel = callbacks.renderUpdatePanel;\r\n}\r\n\r\n/**\r\n * Connect to the state WebSocket for real-time session updates.\r\n * Automatically reconnects with exponential backoff on disconnect.\r\n */\r\nexport function connectStateWebSocket(): void {\r\n  // Close existing WebSocket before creating new one\r\n  if (stateWs) {\r\n    stateWs.onclose = null; // Prevent reconnect loop\r\n    stateWs.close();\r\n    setStateWs(null);\r\n  }\r\n\r\n  const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n  const ws = new WebSocket(`${protocol}//${location.host}/ws/state`);\r\n  setStateWs(ws);\r\n\r\n  ws.onopen = () => {\r\n    setStateReconnectDelay(INITIAL_RECONNECT_DELAY);\r\n    setStateWsConnected(true);\r\n    updateConnectionStatus();\r\n  };\r\n\r\n  ws.onmessage = (event) => {\r\n    try {\r\n      const data = JSON.parse(event.data);\r\n      const sessionList = data.sessions?.sessions ?? [];\r\n      handleStateUpdate(sessionList);\r\n      handleUpdateInfo(data.update);\r\n    } catch (e: unknown) {\r\n      const message = e instanceof Error ? e.message : String(e);\r\n      console.error('Error parsing state:', message);\r\n    }\r\n  };\r\n\r\n  ws.onclose = () => {\r\n    setStateWsConnected(false);\r\n    updateConnectionStatus();\r\n    scheduleStateReconnect();\r\n  };\r\n\r\n  ws.onerror = (e) => {\r\n    console.error('State WebSocket error:', e);\r\n  };\r\n}\r\n\r\n/**\r\n * Handle session list updates from server.\r\n * Removes terminals for deleted sessions, updates dimensions, and manages selection.\r\n */\r\nexport function handleStateUpdate(newSessions: Session[]): void {\r\n  // Remove terminals for deleted sessions\r\n  const newIds = new Set(newSessions.map(s => s.id));\r\n  sessionTerminals.forEach((_, id) => {\r\n    if (!newIds.has(id)) {\r\n      destroyTerminalForSession(id);\r\n      newlyCreatedSessions.delete(id);\r\n    }\r\n  });\r\n\r\n  // Update dimensions and resize terminals when server dimensions change\r\n  newSessions.forEach((session) => {\r\n    const state = sessionTerminals.get(session.id);\r\n    if (state && state.opened) {\r\n      const dimensionsChanged = state.serverCols !== session.cols || state.serverRows !== session.rows;\r\n      if (dimensionsChanged) {\r\n        state.serverCols = session.cols;\r\n        state.serverRows = session.rows;\r\n        state.terminal.resize(session.cols, session.rows);\r\n        applyTerminalScaling(session.id, state);\r\n      }\r\n    } else if (state) {\r\n      state.serverCols = session.cols;\r\n      state.serverRows = session.rows;\r\n    }\r\n  });\r\n\r\n  setSessions(newSessions);\r\n  renderSessionList();\r\n  updateEmptyState();\r\n\r\n  // Auto-select first session if none active\r\n  if (!activeSessionId && sessions.length > 0) {\r\n    selectSession(sessions[0].id);\r\n  }\r\n\r\n  // Handle active session being deleted\r\n  if (activeSessionId && !sessions.find(s => s.id === activeSessionId)) {\r\n    setActiveSessionId(null);\r\n    if (sessions.length > 0) {\r\n      selectSession(sessions[0].id);\r\n    }\r\n  }\r\n\r\n  updateMobileTitle();\r\n}\r\n\r\n/**\r\n * Handle update info from server.\r\n * Updates the stored update info and renders the update panel.\r\n */\r\nexport function handleUpdateInfo(update: UpdateInfo | null): void {\r\n  setUpdateInfo(update);\r\n  renderUpdatePanel();\r\n}\r\n\r\n/**\r\n * Schedule state WebSocket reconnection with exponential backoff.\r\n */\r\nexport function scheduleStateReconnect(): void {\r\n  scheduleReconnect(\r\n    stateReconnectDelay,\r\n    MAX_RECONNECT_DELAY,\r\n    connectStateWebSocket,\r\n    setStateReconnectDelay,\r\n    setStateReconnectTimer,\r\n    stateReconnectTimer\r\n  );\r\n}\r\n\r\n/**\r\n * Update the connection status indicator in the UI.\r\n */\r\nexport function updateConnectionStatus(): void {\r\n  const indicator = document.getElementById('connection-status');\r\n  if (!indicator) return;\r\n\r\n  let status: string;\r\n  let text: string;\r\n\r\n  if (stateWsConnected && muxWsConnected) {\r\n    status = 'connected';\r\n    text = '';\r\n  } else if (!stateWsConnected && !muxWsConnected) {\r\n    status = 'disconnected';\r\n    text = 'Server disconnected';\r\n  } else {\r\n    status = 'reconnecting';\r\n    text = 'Reconnecting...';\r\n  }\r\n\r\n  indicator.className = `connection-status ${status}`;\r\n  indicator.textContent = text;\r\n}\r\n", "/**\r\n * Mux Channel Module\r\n *\r\n * Manages the mux WebSocket connection for terminal I/O.\r\n * Uses a binary protocol with 9-byte header (1 byte type + 8 byte session ID).\r\n */\r\n\r\nimport type { TerminalState } from '../../types';\r\nimport {\r\n  MUX_HEADER_SIZE,\r\n  MUX_TYPE_OUTPUT,\r\n  MUX_TYPE_INPUT,\r\n  MUX_TYPE_RESIZE,\r\n  MUX_TYPE_RESYNC,\r\n  INITIAL_RECONNECT_DELAY,\r\n  MAX_RECONNECT_DELAY\r\n} from '../../constants';\r\nimport { parseOutputFrame, scheduleReconnect } from '../../utils';\r\nimport {\r\n  muxWs,\r\n  muxReconnectTimer,\r\n  muxReconnectDelay,\r\n  sessionTerminals,\r\n  pendingOutputFrames,\r\n  setMuxWs,\r\n  setMuxReconnectTimer,\r\n  setMuxReconnectDelay,\r\n  setMuxWsConnected\r\n} from '../../state';\r\nimport { updateConnectionStatus } from './stateChannel';\r\n\r\n// Forward declarations for functions from other modules\r\nlet applyTerminalScaling: (sessionId: string, state: TerminalState) => void = () => {};\r\nlet refreshActiveTerminalBuffer: () => void = () => {};\r\n\r\n/**\r\n * Register callbacks from other modules\r\n */\r\nexport function registerMuxCallbacks(callbacks: {\r\n  applyTerminalScaling?: (sessionId: string, state: TerminalState) => void;\r\n  refreshActiveTerminalBuffer?: () => void;\r\n}): void {\r\n  if (callbacks.applyTerminalScaling) applyTerminalScaling = callbacks.applyTerminalScaling;\r\n  if (callbacks.refreshActiveTerminalBuffer) refreshActiveTerminalBuffer = callbacks.refreshActiveTerminalBuffer;\r\n}\r\n\r\n/**\r\n * Connect to the mux WebSocket for terminal I/O.\r\n * Uses a binary protocol with 9-byte header.\r\n */\r\nexport function connectMuxWebSocket(): void {\r\n  // Close existing WebSocket before creating new one\r\n  if (muxWs) {\r\n    muxWs.onclose = null; // Prevent reconnect loop\r\n    muxWs.close();\r\n    setMuxWs(null);\r\n  }\r\n\r\n  const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\r\n  const ws = new WebSocket(`${protocol}//${location.host}/ws/mux`);\r\n  ws.binaryType = 'arraybuffer';\r\n  setMuxWs(ws);\r\n\r\n  ws.onopen = () => {\r\n    const wasReconnect = muxReconnectDelay > INITIAL_RECONNECT_DELAY;\r\n    setMuxReconnectDelay(INITIAL_RECONNECT_DELAY);\r\n    setMuxWsConnected(true);\r\n    updateConnectionStatus();\r\n\r\n    // On reconnect, refresh buffers to catch any missed output\r\n    if (wasReconnect) {\r\n      refreshActiveTerminalBuffer();\r\n    }\r\n  };\r\n\r\n  ws.onmessage = (event) => {\r\n    if (!(event.data instanceof ArrayBuffer)) return;\r\n\r\n    const data = new Uint8Array(event.data);\r\n    if (data.length < MUX_HEADER_SIZE) return;\r\n\r\n    const type = data[0];\r\n    const sessionId = decodeSessionId(data, 1);\r\n    const payload = data.slice(MUX_HEADER_SIZE);\r\n\r\n    if (type === MUX_TYPE_RESYNC) {\r\n      // Server is resyncing due to dropped frames - clear all terminals\r\n      console.log('[Resync] Clearing terminals for buffer refresh');\r\n      sessionTerminals.forEach((state) => {\r\n        if (state.opened) {\r\n          state.terminal.clear();\r\n        }\r\n      });\r\n      pendingOutputFrames.clear();\r\n      return;\r\n    }\r\n\r\n    if (type === MUX_TYPE_OUTPUT) {\r\n      const state = sessionTerminals.get(sessionId);\r\n      if (state && state.opened && payload.length >= 4) {\r\n        writeOutputFrame(sessionId, state, payload);\r\n      } else if (payload.length >= 4) {\r\n        // Terminal not yet opened - buffer frame for replay when terminal opens\r\n        if (!pendingOutputFrames.has(sessionId)) {\r\n          pendingOutputFrames.set(sessionId, []);\r\n        }\r\n        pendingOutputFrames.get(sessionId)!.push(payload.slice());\r\n      }\r\n    }\r\n  };\r\n\r\n  ws.onclose = () => {\r\n    setMuxWsConnected(false);\r\n    updateConnectionStatus();\r\n    scheduleMuxReconnect();\r\n  };\r\n\r\n  ws.onerror = (e) => {\r\n    console.error('Mux WebSocket error:', e);\r\n  };\r\n}\r\n\r\n/**\r\n * Send terminal input to server.\r\n */\r\nexport function sendInput(sessionId: string, data: string): void {\r\n  if (!muxWs || muxWs.readyState !== WebSocket.OPEN) return;\r\n\r\n  const payload = new TextEncoder().encode(data);\r\n  const frame = new Uint8Array(MUX_HEADER_SIZE + payload.length);\r\n  frame[0] = MUX_TYPE_INPUT;\r\n  encodeSessionId(frame, 1, sessionId);\r\n  frame.set(payload, MUX_HEADER_SIZE);\r\n  muxWs.send(frame);\r\n}\r\n\r\n/**\r\n * Send terminal resize to server.\r\n */\r\nexport function sendResize(sessionId: string, cols: number, rows: number): void {\r\n  if (!muxWs || muxWs.readyState !== WebSocket.OPEN) return;\r\n\r\n  const frame = new Uint8Array(MUX_HEADER_SIZE + 4);\r\n  frame[0] = MUX_TYPE_RESIZE;\r\n  encodeSessionId(frame, 1, sessionId);\r\n  // Encode cols and rows as little-endian 16-bit integers\r\n  frame[MUX_HEADER_SIZE] = cols & 0xff;\r\n  frame[MUX_HEADER_SIZE + 1] = (cols >> 8) & 0xff;\r\n  frame[MUX_HEADER_SIZE + 2] = rows & 0xff;\r\n  frame[MUX_HEADER_SIZE + 3] = (rows >> 8) & 0xff;\r\n  muxWs.send(frame);\r\n\r\n  // Update local tracking\r\n  const state = sessionTerminals.get(sessionId);\r\n  if (state) {\r\n    state.serverCols = cols;\r\n    state.serverRows = rows;\r\n  }\r\n}\r\n\r\n/**\r\n * Encode 8-character session ID into buffer at offset.\r\n */\r\nexport function encodeSessionId(buffer: Uint8Array, offset: number, sessionId: string): void {\r\n  for (let i = 0; i < 8; i++) {\r\n    buffer[offset + i] = i < sessionId.length ? sessionId.charCodeAt(i) : 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Decode 8-character session ID from buffer at offset.\r\n */\r\nexport function decodeSessionId(buffer: Uint8Array, offset: number): string {\r\n  const chars: string[] = [];\r\n  for (let i = 0; i < 8; i++) {\r\n    if (buffer[offset + i] !== 0) {\r\n      chars.push(String.fromCharCode(buffer[offset + i]));\r\n    }\r\n  }\r\n  return chars.join('');\r\n}\r\n\r\n/**\r\n * Schedule mux WebSocket reconnection with exponential backoff.\r\n */\r\nexport function scheduleMuxReconnect(): void {\r\n  scheduleReconnect(\r\n    muxReconnectDelay,\r\n    MAX_RECONNECT_DELAY,\r\n    connectMuxWebSocket,\r\n    setMuxReconnectDelay,\r\n    setMuxReconnectTimer,\r\n    muxReconnectTimer\r\n  );\r\n}\r\n\r\n/**\r\n * Replay pending output frames for a session that just opened its terminal.\r\n */\r\nexport function replayPendingFrames(sessionId: string, state: TerminalState): void {\r\n  const frames = pendingOutputFrames.get(sessionId);\r\n  if (frames && frames.length > 0) {\r\n    frames.forEach((payload) => {\r\n      writeOutputFrame(sessionId, state, payload);\r\n    });\r\n    pendingOutputFrames.delete(sessionId);\r\n  }\r\n}\r\n\r\n/**\r\n * Write output frame to terminal.\r\n * Parses dimensions from frame header and resizes terminal if needed.\r\n */\r\nexport function writeOutputFrame(sessionId: string, state: TerminalState, payload: Uint8Array): void {\r\n  const frame = parseOutputFrame(payload);\r\n\r\n  // Ensure terminal matches frame dimensions before writing\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const termCore = (state.terminal as any)._core;\r\n  if (frame.valid && termCore && termCore._renderService) {\r\n    const currentCols = state.terminal.cols;\r\n    const currentRows = state.terminal.rows;\r\n\r\n    if (currentCols !== frame.cols || currentRows !== frame.rows) {\r\n      try {\r\n        state.terminal.resize(frame.cols, frame.rows);\r\n        state.serverCols = frame.cols;\r\n        state.serverRows = frame.rows;\r\n        applyTerminalScaling(sessionId, state);\r\n      } catch (e: unknown) {\r\n        const message = e instanceof Error ? e.message : String(e);\r\n        console.warn('Terminal resize deferred:', message);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Write terminal data\r\n  if (frame.data.length > 0) {\r\n    state.terminal.write(frame.data);\r\n  }\r\n}\r\n", "/**\r\n * MidTerm Terminal Client\r\n *\r\n * Web-based terminal multiplexer frontend using xterm.js.\r\n * Main entry point - wires together all modules.\r\n */\r\n\r\nimport { initThemeFromCookie } from './modules/theming';\r\nimport {\r\n  connectStateWebSocket,\r\n  connectMuxWebSocket,\r\n  registerStateCallbacks,\r\n  registerMuxCallbacks,\r\n  sendInput,\r\n  sendResize\r\n} from './modules/comms';\r\nimport {\r\n  createTerminalForSession,\r\n  destroyTerminalForSession,\r\n  applySettingsToTerminals,\r\n  refreshActiveTerminalBuffer,\r\n  preloadTerminalFont,\r\n  registerTerminalCallbacks,\r\n  applyTerminalScaling,\r\n  fitSessionToScreen,\r\n  setupResizeObserver,\r\n  setupVisualViewport,\r\n  registerScalingCallbacks,\r\n  bindSearchEvents,\r\n  registerFileDropCallbacks,\r\n  pasteToTerminal\r\n} from './modules/terminal';\r\nimport {\r\n  renderSessionList,\r\n  updateEmptyState,\r\n  updateMobileTitle,\r\n  getSessionDisplayName,\r\n  setSessionListCallbacks,\r\n  toggleSidebar,\r\n  closeSidebar,\r\n  collapseSidebar,\r\n  expandSidebar,\r\n  restoreSidebarState,\r\n  setupSidebarResize\r\n} from './modules/sidebar';\r\nimport {\r\n  openSettings,\r\n  closeSettings,\r\n  toggleSettings,\r\n  checkSystemHealth,\r\n  fetchSettings\r\n} from './modules/settings';\r\nimport {\r\n  checkAuthStatus,\r\n  bindAuthEvents\r\n} from './modules/auth';\r\nimport {\r\n  renderUpdatePanel,\r\n  applyUpdate,\r\n  checkForUpdates,\r\n  showChangelog,\r\n  closeChangelog\r\n} from './modules/updating';\r\nimport {\r\n  cacheDOMElements,\r\n  sessions,\r\n  activeSessionId,\r\n  sessionTerminals,\r\n  currentSettings,\r\n  settingsOpen,\r\n  stateWsConnected,\r\n  muxWsConnected,\r\n  stateReconnectDelay,\r\n  muxReconnectDelay,\r\n  dom,\r\n  setActiveSessionId,\r\n  setFontsReadyPromise,\r\n  newlyCreatedSessions,\r\n  pendingSessions\r\n} from './state';\r\nimport {\r\n  FONT_CHAR_WIDTH_RATIO,\r\n  FONT_LINE_HEIGHT_RATIO,\r\n  TERMINAL_PADDING,\r\n  MIN_TERMINAL_COLS,\r\n  MIN_TERMINAL_ROWS,\r\n  MAX_TERMINAL_COLS,\r\n  MAX_TERMINAL_ROWS\r\n} from './constants';\r\nimport { bindClick, escapeHtml } from './utils';\r\n\r\n// Debug export for console access\r\n(window as any).mmDebug = {\r\n  get terminals() { return sessionTerminals; },\r\n  get activeId() { return activeSessionId; },\r\n  get settings() { return currentSettings; }\r\n};\r\n\r\n// =============================================================================\r\n// Initialization\r\n// =============================================================================\r\n\r\ninitThemeFromCookie();\r\n\r\ndocument.addEventListener('DOMContentLoaded', init);\r\n\r\nfunction init(): void {\r\n  cacheDOMElements();\r\n  restoreSidebarState();\r\n  setupSidebarResize();\r\n\r\n  const fontPromise = preloadTerminalFont();\r\n  setFontsReadyPromise(fontPromise);\r\n\r\n  registerCallbacks();\r\n  connectStateWebSocket();\r\n  connectMuxWebSocket();\r\n  checkSystemHealth();\r\n\r\n  bindEvents();\r\n  bindAuthEvents();\r\n  bindSearchEvents();\r\n  setupResizeObserver();\r\n  setupVisualViewport();\r\n\r\n  fetchVersion();\r\n  fetchNetworks();\r\n  fetchSettings();\r\n  checkAuthStatus();\r\n  requestNotificationPermission();\r\n\r\n  setupVisibilityChangeHandler();\r\n}\r\n\r\n// =============================================================================\r\n// Callback Registration\r\n// =============================================================================\r\n\r\nfunction registerCallbacks(): void {\r\n  registerStateCallbacks({\r\n    destroyTerminalForSession,\r\n    applyTerminalScaling,\r\n    renderSessionList,\r\n    updateEmptyState,\r\n    selectSession,\r\n    updateMobileTitle,\r\n    renderUpdatePanel\r\n  });\r\n\r\n  registerMuxCallbacks({\r\n    applyTerminalScaling,\r\n    refreshActiveTerminalBuffer\r\n  });\r\n\r\n  registerTerminalCallbacks({\r\n    sendInput,\r\n    showBellNotification\r\n  });\r\n\r\n  registerFileDropCallbacks({\r\n    sendInput,\r\n    pasteToTerminal\r\n  });\r\n\r\n  registerScalingCallbacks({\r\n    sendResize: (sessionId: string, terminal: { cols: number; rows: number }) => {\r\n      sendResize(sessionId, terminal.cols, terminal.rows);\r\n    }\r\n  });\r\n\r\n  setSessionListCallbacks({\r\n    onSelect: selectSession,\r\n    onDelete: deleteSession,\r\n    onRename: startInlineRename,\r\n    onResize: fitSessionToScreen,\r\n    onCloseSidebar: closeSidebar\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Visibility Change Handler\r\n// =============================================================================\r\n\r\nfunction setupVisibilityChangeHandler(): void {\r\n  document.addEventListener('visibilitychange', () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (!stateWsConnected) {\r\n        connectStateWebSocket();\r\n      }\r\n      if (!muxWsConnected) {\r\n        connectMuxWebSocket();\r\n      }\r\n      if (muxWsConnected && activeSessionId) {\r\n        setTimeout(refreshActiveTerminalBuffer, 200);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n// =============================================================================\r\n// Session Management\r\n// =============================================================================\r\n\r\nfunction createSession(): void {\r\n  const rect = dom.terminalsArea?.getBoundingClientRect();\r\n  let cols = currentSettings?.defaultCols ?? 120;\r\n  let rows = currentSettings?.defaultRows ?? 30;\r\n\r\n  if (rect && rect.width > 100 && rect.height > 100) {\r\n    const fontSize = currentSettings?.fontSize ?? 14;\r\n    const charWidth = fontSize * FONT_CHAR_WIDTH_RATIO;\r\n    const lineHeight = fontSize * FONT_LINE_HEIGHT_RATIO;\r\n\r\n    const availWidth = rect.width - TERMINAL_PADDING;\r\n    const availHeight = rect.height - TERMINAL_PADDING;\r\n\r\n    const measuredCols = Math.floor(availWidth / charWidth);\r\n    const measuredRows = Math.floor(availHeight / lineHeight);\r\n\r\n    if (measuredCols > MIN_TERMINAL_COLS && measuredRows > MIN_TERMINAL_ROWS) {\r\n      cols = Math.min(measuredCols, MAX_TERMINAL_COLS);\r\n      rows = Math.min(measuredRows, MAX_TERMINAL_ROWS);\r\n    }\r\n  }\r\n\r\n  // Optimistic UI: add temporary session with spinner\r\n  const tempId = 'pending-' + Date.now();\r\n  const tempSession = {\r\n    id: tempId,\r\n    name: null,\r\n    shellType: 'Loading...',\r\n    cols: cols,\r\n    rows: rows\r\n  };\r\n  sessions.push(tempSession);\r\n  pendingSessions.add(tempId);\r\n  renderSessionList();\r\n  closeSidebar();\r\n\r\n  fetch('/api/sessions', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ Cols: cols, Rows: rows })\r\n  })\r\n    .then((r) => r.json())\r\n    .then((session) => {\r\n      // Remove temporary session\r\n      pendingSessions.delete(tempId);\r\n      const idx = sessions.findIndex((s) => s.id === tempId);\r\n      if (idx >= 0) {\r\n        sessions.splice(idx, 1);\r\n      }\r\n\r\n      newlyCreatedSessions.add(session.id);\r\n      selectSession(session.id);\r\n    })\r\n    .catch((e) => {\r\n      // Remove temporary session on error\r\n      pendingSessions.delete(tempId);\r\n      const idx = sessions.findIndex((s) => s.id === tempId);\r\n      if (idx >= 0) {\r\n        sessions.splice(idx, 1);\r\n        renderSessionList();\r\n        updateEmptyState();\r\n      }\r\n      console.error('Error creating session:', e);\r\n    });\r\n}\r\n\r\nfunction selectSession(sessionId: string): void {\r\n  if (settingsOpen) {\r\n    closeSettings();\r\n  }\r\n\r\n  sessionTerminals.forEach((state) => {\r\n    state.container.classList.add('hidden');\r\n  });\r\n\r\n  setActiveSessionId(sessionId);\r\n\r\n  const sessionInfo = sessions.find((s) => s.id === sessionId);\r\n  const state = createTerminalForSession(sessionId, sessionInfo);\r\n  const isNewTerminal = state.serverCols === 0;\r\n  const isNewlyCreated = newlyCreatedSessions.has(sessionId);\r\n  state.container.classList.remove('hidden');\r\n\r\n  requestAnimationFrame(() => {\r\n    state.terminal.focus();\r\n\r\n    if (isNewTerminal && !isNewlyCreated) {\r\n      import('./modules/terminal').then((mod) => {\r\n        mod.fetchAndWriteBuffer(sessionId, state.terminal);\r\n      });\r\n    }\r\n\r\n    if (isNewlyCreated) {\r\n      newlyCreatedSessions.delete(sessionId);\r\n    }\r\n  });\r\n\r\n  renderSessionList();\r\n  updateMobileTitle();\r\n  dom.emptyState?.classList.add('hidden');\r\n}\r\n\r\nfunction deleteSession(sessionId: string): void {\r\n  // Optimistic UI: remove session immediately for better UX\r\n  destroyTerminalForSession(sessionId);\r\n\r\n  // Remove from local sessions array\r\n  const idx = sessions.findIndex((s) => s.id === sessionId);\r\n  if (idx >= 0) {\r\n    sessions.splice(idx, 1);\r\n  }\r\n\r\n  // If this was the active session, select another\r\n  if (activeSessionId === sessionId) {\r\n    setActiveSessionId(null);\r\n    if (sessions.length > 0) {\r\n      selectSession(sessions[0].id);\r\n    }\r\n  }\r\n\r\n  renderSessionList();\r\n  updateEmptyState();\r\n  updateMobileTitle();\r\n\r\n  // Send delete request to server\r\n  fetch('/api/sessions/' + sessionId, { method: 'DELETE' }).catch((e) => {\r\n    console.error('Error deleting session:', e);\r\n  });\r\n}\r\n\r\nfunction renameSession(sessionId: string, newName: string | null): void {\r\n  const session = sessions.find((s) => s.id === sessionId);\r\n  if (!session) return;\r\n\r\n  const trimmedName = (newName || '').trim();\r\n  const nameToSend = trimmedName === '' || trimmedName === session.shellType ? null : trimmedName;\r\n\r\n  fetch('/api/sessions/' + sessionId + '/name', {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ name: nameToSend })\r\n  })\r\n    .then(() => {\r\n      session.manuallyNamed = true;\r\n    })\r\n    .catch((e) => {\r\n      console.error('Error renaming session:', e);\r\n    });\r\n}\r\n\r\nfunction startInlineRename(sessionId: string): void {\r\n  const item = dom.sessionList?.querySelector(`[data-session-id=\"${sessionId}\"]`);\r\n  if (!item) return;\r\n\r\n  const titleSpan = item.querySelector('.session-title');\r\n  if (!titleSpan) return;\r\n\r\n  const session = sessions.find((s) => s.id === sessionId);\r\n  const currentName = session ? (session.name || session.shellType) : '';\r\n\r\n  const input = document.createElement('input');\r\n  input.type = 'text';\r\n  input.className = 'session-rename-input';\r\n  input.value = currentName;\r\n\r\n  function finishRename(): void {\r\n    renameSession(sessionId, input.value);\r\n    input.replaceWith(titleSpan);\r\n  }\r\n\r\n  input.addEventListener('blur', finishRename);\r\n  input.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      input.blur();\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      input.replaceWith(titleSpan);\r\n    }\r\n  });\r\n\r\n  titleSpan.replaceWith(input);\r\n  input.focus();\r\n  input.select();\r\n}\r\n\r\nfunction promptRenameSession(sessionId: string): void {\r\n  const session = sessions.find((s) => s.id === sessionId);\r\n  if (!session) return;\r\n\r\n  const currentName = session.name || session.shellType;\r\n  const newName = prompt('Rename terminal:', currentName);\r\n\r\n  if (newName !== null) {\r\n    renameSession(sessionId, newName);\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n// Notifications\r\n// =============================================================================\r\n\r\nfunction requestNotificationPermission(): void {\r\n  if (!('Notification' in window)) return;\r\n  if (Notification.permission === 'default') {\r\n    Notification.requestPermission().catch(() => {});\r\n  }\r\n}\r\n\r\nfunction showBellNotification(sessionId: string): void {\r\n  if (!currentSettings) return;\r\n\r\n  const bellStyle = currentSettings.bellStyle || 'notification';\r\n  const session = sessions.find((s) => s.id === sessionId);\r\n  const title = session ? getSessionDisplayName(session) : 'Terminal';\r\n\r\n  if ((bellStyle === 'notification' || bellStyle === 'both') &&\r\n      Notification.permission === 'granted' && document.hidden) {\r\n    new Notification('Bell: ' + title, {\r\n      body: 'Terminal bell triggered',\r\n      icon: '/favicon.ico'\r\n    });\r\n  }\r\n\r\n  if (bellStyle === 'visual' || bellStyle === 'both') {\r\n    const state = sessionTerminals.get(sessionId);\r\n    if (state) {\r\n      state.container.classList.add('bell-flash');\r\n      setTimeout(() => {\r\n        state.container.classList.remove('bell-flash');\r\n      }, 200);\r\n    }\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n// API Helpers\r\n// =============================================================================\r\n\r\nfunction fetchVersion(): void {\r\n  fetch('/api/version')\r\n    .then((r) => r.text())\r\n    .then((v) => {\r\n      const shortVersion = v.split(/[+-]/)[0].split('.').slice(0, 3).join('.');\r\n      const el = document.getElementById('app-version');\r\n      if (el) el.textContent = 'v' + shortVersion;\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\nfunction fetchNetworks(): void {\r\n  fetch('/api/networks')\r\n    .then((r) => r.json())\r\n    .then((networks) => {\r\n      const list = document.getElementById('network-list');\r\n      if (!list) return;\r\n\r\n      list.innerHTML = networks.map((n: { name: string; ip: string }) => {\r\n        return '<div class=\"network-item\">' +\r\n          '<span class=\"network-name\" title=\"' + escapeHtml(n.name) + '\">' +\r\n          escapeHtml(n.name) + '</span>' +\r\n          '<span class=\"network-ip\">' + escapeHtml(n.ip) + ':' + location.port + '</span>' +\r\n          '</div>';\r\n      }).join('');\r\n    })\r\n    .catch(() => {});\r\n}\r\n\r\n// =============================================================================\r\n// Event Binding\r\n// =============================================================================\r\n\r\nfunction bindEvents(): void {\r\n  bindClick('btn-new-session', createSession);\r\n  bindClick('btn-new-session-mobile', createSession);\r\n  bindClick('btn-create-terminal', createSession);\r\n\r\n  bindClick('btn-hamburger', toggleSidebar);\r\n  bindClick('btn-collapse-sidebar', collapseSidebar);\r\n  bindClick('btn-expand-sidebar', expandSidebar);\r\n\r\n  if (dom.sidebarOverlay) {\r\n    dom.sidebarOverlay.addEventListener('click', closeSidebar);\r\n  }\r\n\r\n  bindClick('btn-ctrlc-mobile', () => {\r\n    if (activeSessionId) sendInput(activeSessionId, '\\x03');\r\n  });\r\n  bindClick('btn-resize-mobile', () => {\r\n    if (activeSessionId) fitSessionToScreen(activeSessionId);\r\n  });\r\n  bindClick('btn-rename-mobile', () => {\r\n    if (activeSessionId) promptRenameSession(activeSessionId);\r\n  });\r\n  bindClick('btn-close-mobile', () => {\r\n    if (activeSessionId) deleteSession(activeSessionId);\r\n  });\r\n\r\n  if (dom.settingsBtn) {\r\n    dom.settingsBtn.addEventListener('click', toggleSettings);\r\n  }\r\n\r\n  bindClick('update-btn', applyUpdate);\r\n  bindClick('btn-check-updates', checkForUpdates);\r\n  bindClick('btn-apply-update', applyUpdate);\r\n  bindClick('btn-show-changelog', showChangelog);\r\n  bindClick('btn-close-changelog', closeChangelog);\r\n\r\n  const changelogBackdrop = document.querySelector('#changelog-modal .modal-backdrop');\r\n  if (changelogBackdrop) {\r\n    changelogBackdrop.addEventListener('click', closeChangelog);\r\n  }\r\n\r\n  import('./modules/settings').then((mod) => {\r\n    mod.bindSettingsAutoSave();\r\n  });\r\n}\r\n", "/**\r\n * Session List Module\r\n *\r\n * Handles rendering and updating the sidebar session list,\r\n * including empty state and mobile title updates.\r\n */\r\n\r\nimport type { Session } from '../../types';\r\nimport {\r\n  sessions,\r\n  activeSessionId,\r\n  settingsOpen,\r\n  pendingSessions,\r\n  dom\r\n} from '../../state';\r\n\r\n// =============================================================================\r\n// Callback Types\r\n// =============================================================================\r\n\r\n/** Callbacks for session list interactions */\r\nexport interface SessionListCallbacks {\r\n  onSelect: (sessionId: string) => void;\r\n  onDelete: (sessionId: string) => void;\r\n  onRename: (sessionId: string) => void;\r\n  onResize: (sessionId: string) => void;\r\n  onCloseSidebar: () => void;\r\n}\r\n\r\nlet callbacks: SessionListCallbacks | null = null;\r\n\r\n// =============================================================================\r\n// Initialization\r\n// =============================================================================\r\n\r\n/**\r\n * Set callbacks for session list interactions\r\n */\r\nexport function setSessionListCallbacks(cbs: SessionListCallbacks): void {\r\n  callbacks = cbs;\r\n}\r\n\r\n// =============================================================================\r\n// Session Display\r\n// =============================================================================\r\n\r\n/**\r\n * Get the display name for a session\r\n */\r\nexport function getSessionDisplayName(session: Session): string {\r\n  return session.name || session.shellType;\r\n}\r\n\r\n// =============================================================================\r\n// Rendering\r\n// =============================================================================\r\n\r\n/**\r\n * Render the session list in the sidebar\r\n */\r\nexport function renderSessionList(): void {\r\n  if (!dom.sessionList) return;\r\n\r\n  dom.sessionList.innerHTML = '';\r\n\r\n  sessions.forEach((session) => {\r\n    const isPending = pendingSessions.has(session.id);\r\n    const item = document.createElement('div');\r\n    item.className = 'session-item' +\r\n      (session.id === activeSessionId ? ' active' : '') +\r\n      (isPending ? ' pending' : '');\r\n    item.dataset.sessionId = session.id;\r\n\r\n    if (!isPending) {\r\n      item.addEventListener('click', () => {\r\n        if (callbacks) {\r\n          callbacks.onSelect(session.id);\r\n          callbacks.onCloseSidebar();\r\n        }\r\n      });\r\n    }\r\n\r\n    const info = document.createElement('div');\r\n    info.className = 'session-info';\r\n\r\n    if (isPending) {\r\n      const spinner = document.createElement('span');\r\n      spinner.className = 'session-spinner';\r\n      info.appendChild(spinner);\r\n    }\r\n\r\n    const title = document.createElement('span');\r\n    title.className = 'session-title';\r\n    title.textContent = getSessionDisplayName(session);\r\n\r\n    info.appendChild(title);\r\n\r\n    const actions = document.createElement('div');\r\n    actions.className = 'session-actions';\r\n\r\n    if (!isPending) {\r\n      const resizeBtn = document.createElement('button');\r\n      resizeBtn.className = 'session-resize';\r\n      resizeBtn.innerHTML = '\u2922';\r\n      resizeBtn.title = 'Fit to screen';\r\n      resizeBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        if (callbacks) {\r\n          callbacks.onResize(session.id);\r\n        }\r\n      });\r\n\r\n      const renameBtn = document.createElement('button');\r\n      renameBtn.className = 'session-rename';\r\n      renameBtn.innerHTML = '\u270F\uFE0F';\r\n      renameBtn.title = 'Rename session';\r\n      renameBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        if (callbacks) {\r\n          callbacks.onRename(session.id);\r\n        }\r\n      });\r\n\r\n      const closeBtn = document.createElement('button');\r\n      closeBtn.className = 'session-close';\r\n      closeBtn.innerHTML = '&times;';\r\n      closeBtn.title = 'Close session';\r\n      closeBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        if (callbacks) {\r\n          callbacks.onDelete(session.id);\r\n        }\r\n      });\r\n\r\n      actions.appendChild(resizeBtn);\r\n      actions.appendChild(renameBtn);\r\n      actions.appendChild(closeBtn);\r\n    }\r\n\r\n    item.appendChild(info);\r\n    item.appendChild(actions);\r\n    dom.sessionList.appendChild(item);\r\n  });\r\n\r\n  // Count only non-pending sessions\r\n  const realSessionCount = sessions.filter((s) => !pendingSessions.has(s.id)).length;\r\n  if (dom.sessionCount) {\r\n    dom.sessionCount.textContent = String(realSessionCount);\r\n  }\r\n}\r\n\r\n/**\r\n * Update the empty state visibility based on session count\r\n */\r\nexport function updateEmptyState(): void {\r\n  if (!dom.emptyState) return;\r\n\r\n  if (sessions.length === 0) {\r\n    dom.emptyState.classList.remove('hidden');\r\n    if (dom.settingsView) dom.settingsView.classList.add('hidden');\r\n  } else if (!settingsOpen) {\r\n    dom.emptyState.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Update the mobile title bar with current session name.\r\n * Also updates the desktop island title.\r\n */\r\nexport function updateMobileTitle(): void {\r\n  if (!dom.mobileTitle) return;\r\n\r\n  const session = sessions.find((s) => s.id === activeSessionId);\r\n  dom.mobileTitle.textContent = session ? getSessionDisplayName(session) : 'MidTerm';\r\n\r\n  if (dom.topbarActions) {\r\n    if (session) {\r\n      dom.topbarActions.classList.remove('no-terminal');\r\n    } else {\r\n      dom.topbarActions.classList.add('no-terminal');\r\n    }\r\n  }\r\n\r\n  // Also update the desktop island title\r\n  if (dom.islandTitle) {\r\n    dom.islandTitle.textContent = session ? getSessionDisplayName(session) : 'MidTerm';\r\n  }\r\n}\r\n", "/**\r\n * Sidebar Collapse Module\r\n *\r\n * Handles sidebar visibility, collapse/expand state,\r\n * and island title updates for desktop view.\r\n */\r\n\r\nimport {\r\n  sidebarOpen,\r\n  sidebarCollapsed,\r\n  setSidebarOpen,\r\n  setSidebarCollapsed,\r\n  sessions,\r\n  activeSessionId,\r\n  dom\r\n} from '../../state';\r\nimport { getCookie, setCookie } from '../../utils';\r\nimport { getSessionDisplayName } from './sessionList';\r\nimport { rescaleAllTerminals } from '../terminal/scaling';\r\n\r\n// =============================================================================\r\n// Cookie Constants\r\n// =============================================================================\r\n\r\nconst SIDEBAR_COLLAPSED_COOKIE = 'mm-sidebar-collapsed';\r\nconst SIDEBAR_WIDTH_COOKIE = 'mm-sidebar-width';\r\nconst DESKTOP_BREAKPOINT = 768;\r\nconst MIN_SIDEBAR_WIDTH = 180;\r\nconst MAX_SIDEBAR_WIDTH = 400;\r\n\r\n// =============================================================================\r\n// Mobile Sidebar Toggle\r\n// =============================================================================\r\n\r\n/**\r\n * Toggle mobile sidebar visibility\r\n */\r\nexport function toggleSidebar(): void {\r\n  setSidebarOpen(!sidebarOpen);\r\n  if (dom.app) dom.app.classList.toggle('sidebar-open', sidebarOpen);\r\n}\r\n\r\n/**\r\n * Close mobile sidebar\r\n */\r\nexport function closeSidebar(): void {\r\n  setSidebarOpen(false);\r\n  if (dom.app) dom.app.classList.remove('sidebar-open');\r\n}\r\n\r\n// =============================================================================\r\n// Desktop Sidebar Collapse\r\n// =============================================================================\r\n\r\n/**\r\n * Collapse sidebar to icon-only mode (desktop)\r\n */\r\nexport function collapseSidebar(): void {\r\n  setSidebarCollapsed(true);\r\n  if (dom.app) dom.app.classList.add('sidebar-collapsed');\r\n  setCookie(SIDEBAR_COLLAPSED_COOKIE, 'true');\r\n  updateIslandTitle();\r\n  requestAnimationFrame(rescaleAllTerminals);\r\n}\r\n\r\n/**\r\n * Expand sidebar to full width (desktop)\r\n */\r\nexport function expandSidebar(): void {\r\n  setSidebarCollapsed(false);\r\n  if (dom.app) dom.app.classList.remove('sidebar-collapsed');\r\n  setCookie(SIDEBAR_COLLAPSED_COOKIE, 'false');\r\n  requestAnimationFrame(rescaleAllTerminals);\r\n}\r\n\r\n// =============================================================================\r\n// Island Title\r\n// =============================================================================\r\n\r\n/**\r\n * Update the desktop island title with current session name\r\n */\r\nexport function updateIslandTitle(): void {\r\n  if (!dom.islandTitle) return;\r\n  const session = sessions.find((s) => s.id === activeSessionId);\r\n  dom.islandTitle.textContent = session ? getSessionDisplayName(session) : 'MidTerm';\r\n}\r\n\r\n// =============================================================================\r\n// State Restoration\r\n// =============================================================================\r\n\r\n/**\r\n * Restore sidebar collapsed state from cookie (desktop only)\r\n */\r\nexport function restoreSidebarState(): void {\r\n  if (getCookie(SIDEBAR_COLLAPSED_COOKIE) === 'true' && window.innerWidth > DESKTOP_BREAKPOINT) {\r\n    setSidebarCollapsed(true);\r\n    if (dom.app) dom.app.classList.add('sidebar-collapsed');\r\n  }\r\n\r\n  // Restore sidebar width\r\n  const savedWidth = getCookie(SIDEBAR_WIDTH_COOKIE);\r\n  if (savedWidth) {\r\n    const width = parseInt(savedWidth, 10);\r\n    if (width >= MIN_SIDEBAR_WIDTH && width <= MAX_SIDEBAR_WIDTH) {\r\n      const sidebar = document.getElementById('sidebar');\r\n      if (sidebar) {\r\n        sidebar.style.width = width + 'px';\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n// Sidebar Resize\r\n// =============================================================================\r\n\r\n/**\r\n * Set up sidebar resize grip functionality\r\n */\r\nexport function setupSidebarResize(): void {\r\n  const grip = document.getElementById('sidebar-resize-grip');\r\n  const sidebar = document.getElementById('sidebar');\r\n  if (!grip || !sidebar) return;\r\n\r\n  let isResizing = false;\r\n  let startX = 0;\r\n  let startWidth = 0;\r\n\r\n  grip.addEventListener('mousedown', (e: MouseEvent) => {\r\n    isResizing = true;\r\n    startX = e.clientX;\r\n    startWidth = sidebar.offsetWidth;\r\n    grip.classList.add('active');\r\n    document.body.style.cursor = 'ew-resize';\r\n    document.body.style.userSelect = 'none';\r\n    e.preventDefault();\r\n  });\r\n\r\n  document.addEventListener('mousemove', (e: MouseEvent) => {\r\n    if (!isResizing) return;\r\n\r\n    const delta = e.clientX - startX;\r\n    const newWidth = Math.max(MIN_SIDEBAR_WIDTH, Math.min(MAX_SIDEBAR_WIDTH, startWidth + delta));\r\n    sidebar.style.width = newWidth + 'px';\r\n    rescaleAllTerminals();\r\n  });\r\n\r\n  document.addEventListener('mouseup', () => {\r\n    if (!isResizing) return;\r\n\r\n    isResizing = false;\r\n    grip.classList.remove('active');\r\n    document.body.style.cursor = '';\r\n    document.body.style.userSelect = '';\r\n\r\n    // Save width to cookie\r\n    const currentWidth = sidebar.offsetWidth;\r\n    setCookie(SIDEBAR_WIDTH_COOKIE, String(currentWidth));\r\n  });\r\n}\r\n", "/**\r\n * Auth Status Module\r\n *\r\n * Handles authentication status checking and security warning display.\r\n */\r\n\r\nimport { authStatus, setAuthStatus } from '../../state';\r\nimport type { AuthStatus } from '../../types';\r\n\r\n/**\r\n * Check authentication status from server\r\n */\r\nexport async function checkAuthStatus(): Promise<void> {\r\n  try {\r\n    const response = await fetch('/api/auth/status');\r\n\r\n    if (response.status === 401) {\r\n      window.location.href = '/login.html';\r\n      return;\r\n    }\r\n\r\n    const status: AuthStatus = await response.json();\r\n    setAuthStatus(status);\r\n    updateSecurityWarning();\r\n    updatePasswordStatus();\r\n  } catch (e) {\r\n    console.error('Auth status error:', e);\r\n  }\r\n}\r\n\r\n/**\r\n * Update security warning visibility based on auth status\r\n */\r\nexport function updateSecurityWarning(): void {\r\n  const warning = document.getElementById('security-warning');\r\n  if (!warning) return;\r\n\r\n  if (authStatus && authStatus.authenticationEnabled && !authStatus.passwordSet) {\r\n    warning.classList.remove('hidden');\r\n  } else {\r\n    warning.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Update password status text in settings panel\r\n */\r\nexport function updatePasswordStatus(): void {\r\n  const statusEl = document.getElementById('password-status-text');\r\n  if (!statusEl) return;\r\n\r\n  if (!authStatus) {\r\n    statusEl.textContent = 'Checking...';\r\n    statusEl.className = '';\r\n    return;\r\n  }\r\n\r\n  if (authStatus.passwordSet) {\r\n    statusEl.textContent = 'Password is set';\r\n    statusEl.className = 'status-set';\r\n  } else {\r\n    statusEl.textContent = 'No password set';\r\n    statusEl.className = 'status-missing';\r\n  }\r\n}\r\n\r\n/**\r\n * Dismiss the security warning banner\r\n */\r\nexport function dismissSecurityWarning(): void {\r\n  const warning = document.getElementById('security-warning');\r\n  if (warning) {\r\n    warning.classList.add('hidden');\r\n  }\r\n}\r\n", "/**\r\n * Password Modal Module\r\n *\r\n * Handles password set/change modal and form submission.\r\n */\r\n\r\nimport { authStatus } from '../../state';\r\nimport { bindClick } from '../../utils';\r\nimport { checkAuthStatus, dismissSecurityWarning } from './status';\r\n\r\nlet passwordModalHasPassword = false;\r\n\r\n/**\r\n * Show the password modal for setting or changing password\r\n */\r\nexport function showPasswordModal(isInitialSetup: boolean): void {\r\n  const modal = document.getElementById('password-modal');\r\n  const title = document.getElementById('password-modal-title');\r\n  const currentGroup = document.getElementById('current-password-group');\r\n  const errorEl = document.getElementById('password-error');\r\n\r\n  if (!modal) return;\r\n\r\n  passwordModalHasPassword = authStatus?.passwordSet ?? false;\r\n\r\n  if (title) {\r\n    title.textContent = passwordModalHasPassword ? 'Change Password' : 'Set Password';\r\n  }\r\n\r\n  if (currentGroup) {\r\n    currentGroup.style.display = passwordModalHasPassword ? 'block' : 'none';\r\n  }\r\n\r\n  if (errorEl) {\r\n    errorEl.classList.add('hidden');\r\n    errorEl.textContent = '';\r\n  }\r\n\r\n  const form = document.getElementById('password-form') as HTMLFormElement | null;\r\n  if (form) {\r\n    form.reset();\r\n  }\r\n\r\n  modal.classList.remove('hidden');\r\n\r\n  const focusFieldId = passwordModalHasPassword ? 'current-password' : 'new-password';\r\n  const field = document.getElementById(focusFieldId) as HTMLInputElement | null;\r\n  if (field) {\r\n    field.focus();\r\n  }\r\n}\r\n\r\n/**\r\n * Hide the password modal\r\n */\r\nexport function hidePasswordModal(): void {\r\n  const modal = document.getElementById('password-modal');\r\n  if (modal) {\r\n    modal.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Handle password form submission\r\n */\r\nexport function handlePasswordSubmit(e: Event): void {\r\n  e.preventDefault();\r\n\r\n  const currentPw = document.getElementById('current-password') as HTMLInputElement | null;\r\n  const newPw = document.getElementById('new-password') as HTMLInputElement | null;\r\n  const confirmPw = document.getElementById('confirm-password') as HTMLInputElement | null;\r\n  const saveBtn = document.getElementById('btn-save-password') as HTMLButtonElement | null;\r\n\r\n  const newPassword = newPw?.value ?? '';\r\n  const confirmPassword = confirmPw?.value ?? '';\r\n\r\n  if (!newPassword) {\r\n    showPasswordError('New password is required');\r\n    return;\r\n  }\r\n\r\n  if (newPassword !== confirmPassword) {\r\n    showPasswordError('Passwords do not match');\r\n    return;\r\n  }\r\n\r\n  if (newPassword.length < 4) {\r\n    showPasswordError('Password must be at least 4 characters');\r\n    return;\r\n  }\r\n\r\n  const payload = {\r\n    currentPassword: passwordModalHasPassword && currentPw ? currentPw.value : null,\r\n    newPassword: newPassword\r\n  };\r\n\r\n  if (saveBtn) {\r\n    saveBtn.disabled = true;\r\n    saveBtn.textContent = 'Saving...';\r\n  }\r\n\r\n  fetch('/api/auth/change-password', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload)\r\n  })\r\n    .then(r => r.json().then(data => ({ ok: r.ok, data })))\r\n    .then(result => {\r\n      if (saveBtn) {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = 'Save';\r\n      }\r\n\r\n      if (result.ok && result.data.success) {\r\n        hidePasswordModal();\r\n        checkAuthStatus();\r\n      } else {\r\n        showPasswordError(result.data.error || 'Failed to change password');\r\n      }\r\n    })\r\n    .catch(() => {\r\n      if (saveBtn) {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = 'Save';\r\n      }\r\n      showPasswordError('Connection error');\r\n    });\r\n}\r\n\r\n/**\r\n * Show an error message in the password modal\r\n */\r\nexport function showPasswordError(msg: string): void {\r\n  const errorEl = document.getElementById('password-error');\r\n  if (errorEl) {\r\n    errorEl.textContent = msg;\r\n    errorEl.classList.remove('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Bind all auth-related event handlers\r\n */\r\nexport function bindAuthEvents(): void {\r\n  bindClick('btn-set-password-warning', () => {\r\n    showPasswordModal(true);\r\n  });\r\n  bindClick('btn-dismiss-warning', dismissSecurityWarning);\r\n\r\n  bindClick('btn-change-password', () => {\r\n    showPasswordModal(false);\r\n  });\r\n  bindClick('btn-close-password', hidePasswordModal);\r\n  bindClick('btn-cancel-password', hidePasswordModal);\r\n\r\n  const passwordBackdrop = document.querySelector('#password-modal .modal-backdrop');\r\n  if (passwordBackdrop) {\r\n    passwordBackdrop.addEventListener('click', hidePasswordModal);\r\n  }\r\n\r\n  const passwordForm = document.getElementById('password-form');\r\n  if (passwordForm) {\r\n    passwordForm.addEventListener('submit', handlePasswordSubmit);\r\n  }\r\n}\r\n", "/**\r\n * Update Checker Module\r\n *\r\n * Handles checking for updates, rendering the update panel,\r\n * and applying updates with server restart.\r\n */\r\n\r\nimport type { UpdateInfo } from '../../types';\r\nimport { updateInfo, setUpdateInfo } from '../../state';\r\n\r\nconst MAX_RELOAD_ATTEMPTS = 30;\r\nconst RELOAD_INTERVAL_MS = 2000;\r\nconst INITIAL_RESTART_DELAY_MS = 3000;\r\n\r\n/**\r\n * Render the update panel based on current update info\r\n */\r\nexport function renderUpdatePanel(): void {\r\n  const panel = document.getElementById('update-panel');\r\n  if (!panel) return;\r\n\r\n  if (!updateInfo || !updateInfo.available) {\r\n    panel.classList.add('hidden');\r\n    return;\r\n  }\r\n\r\n  panel.classList.remove('hidden');\r\n  const currentEl = panel.querySelector('.update-current');\r\n  const latestEl = panel.querySelector('.update-latest');\r\n  const noteEl = panel.querySelector('.update-note');\r\n  const headerEl = panel.querySelector('.update-header');\r\n\r\n  if (currentEl) currentEl.textContent = updateInfo.currentVersion;\r\n  if (latestEl) latestEl.textContent = updateInfo.latestVersion;\r\n\r\n  if (updateInfo.sessionsPreserved) {\r\n    if (headerEl) headerEl.textContent = 'Quick Update';\r\n    if (noteEl) {\r\n      noteEl.textContent = 'Sessions will stay alive';\r\n      noteEl.classList.add('update-note-safe');\r\n      noteEl.classList.remove('update-note-warning');\r\n    }\r\n  } else {\r\n    if (headerEl) headerEl.textContent = 'Update Available';\r\n    if (noteEl) {\r\n      noteEl.textContent = 'Save your work - sessions will restart';\r\n      noteEl.classList.add('update-note-warning');\r\n      noteEl.classList.remove('update-note-safe');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Apply the available update and restart the server\r\n */\r\nexport function applyUpdate(): void {\r\n  if (!updateInfo || !updateInfo.available) return;\r\n\r\n  const panel = document.getElementById('update-panel');\r\n  const btn = panel?.querySelector('.update-btn') as HTMLButtonElement | null;\r\n\r\n  if (btn) {\r\n    btn.disabled = true;\r\n    btn.textContent = 'Updating...';\r\n  }\r\n\r\n  fetch('/api/update/apply', { method: 'POST' })\r\n    .then((r) => {\r\n      if (r.ok) {\r\n        if (btn) btn.textContent = 'Restarting...';\r\n        waitForServerAndReload();\r\n      } else {\r\n        if (btn) {\r\n          btn.disabled = false;\r\n          btn.textContent = 'Update & Restart';\r\n        }\r\n        console.error('Update failed');\r\n      }\r\n    })\r\n    .catch((e) => {\r\n      if (btn) {\r\n        btn.disabled = false;\r\n        btn.textContent = 'Update & Restart';\r\n      }\r\n      console.error('Update error:', e);\r\n    });\r\n}\r\n\r\n/**\r\n * Wait for the server to restart after an update, then reload the page\r\n */\r\nexport function waitForServerAndReload(): void {\r\n  let attempts = 0;\r\n\r\n  function checkServer(): void {\r\n    attempts++;\r\n    fetch('/api/version', { cache: 'no-store' })\r\n      .then((r) => {\r\n        if (r.ok) {\r\n          location.reload();\r\n        } else if (attempts < MAX_RELOAD_ATTEMPTS) {\r\n          setTimeout(checkServer, RELOAD_INTERVAL_MS);\r\n        }\r\n      })\r\n      .catch(() => {\r\n        if (attempts < MAX_RELOAD_ATTEMPTS) {\r\n          setTimeout(checkServer, RELOAD_INTERVAL_MS);\r\n        }\r\n      });\r\n  }\r\n\r\n  setTimeout(checkServer, INITIAL_RESTART_DELAY_MS);\r\n}\r\n\r\n/**\r\n * Manually check for updates and update the UI\r\n */\r\nexport function checkForUpdates(): void {\r\n  const btn = document.getElementById('btn-check-updates') as HTMLButtonElement | null;\r\n  const statusEl = document.getElementById('update-status');\r\n\r\n  if (btn) {\r\n    btn.disabled = true;\r\n    btn.textContent = 'Checking...';\r\n  }\r\n\r\n  fetch('/api/update/check')\r\n    .then((r) => r.json())\r\n    .then((update: UpdateInfo) => {\r\n      if (btn) {\r\n        btn.disabled = false;\r\n        btn.textContent = 'Check for Updates';\r\n      }\r\n\r\n      setUpdateInfo(update);\r\n      renderUpdatePanel();\r\n\r\n      const applyBtn = document.getElementById('btn-apply-update');\r\n      if (statusEl) {\r\n        statusEl.classList.remove('hidden');\r\n        if (update && update.available) {\r\n          statusEl.className = 'update-status update-status-available';\r\n          let msg = 'Update available: v' + update.latestVersion;\r\n          if (update.sessionsPreserved) {\r\n            msg += ' (sessions will stay alive)';\r\n          } else {\r\n            msg += ' (sessions will restart)';\r\n          }\r\n          statusEl.textContent = msg;\r\n          if (applyBtn) applyBtn.classList.remove('hidden');\r\n        } else {\r\n          statusEl.className = 'update-status update-status-current';\r\n          statusEl.textContent = 'You are running the latest version';\r\n          if (applyBtn) applyBtn.classList.add('hidden');\r\n        }\r\n      }\r\n    })\r\n    .catch((e) => {\r\n      if (btn) {\r\n        btn.disabled = false;\r\n        btn.textContent = 'Check for Updates';\r\n      }\r\n      if (statusEl) {\r\n        statusEl.classList.remove('hidden');\r\n        statusEl.className = 'update-status update-status-error';\r\n        statusEl.textContent = 'Failed to check for updates';\r\n      }\r\n      console.error('Update check error:', e);\r\n    });\r\n}\r\n\r\n/**\r\n * Handle incoming update info from WebSocket\r\n */\r\nexport function handleUpdateInfo(update: UpdateInfo): void {\r\n  setUpdateInfo(update);\r\n  renderUpdatePanel();\r\n}\r\n", "/**\r\n * Changelog Module\r\n *\r\n * Fetches and displays the changelog from GitHub releases.\r\n */\r\n\r\nimport { escapeHtml } from '../../utils';\r\n\r\nconst GITHUB_RELEASES_URL = 'https://api.github.com/repos/AiTlbx/MidTerm/releases?per_page=10';\r\nconst GITHUB_RELEASES_PAGE = 'https://github.com/AiTlbx/MidTerm/releases';\r\n\r\ninterface GitHubRelease {\r\n  tag_name?: string;\r\n  published_at?: string;\r\n  body?: string;\r\n}\r\n\r\n/**\r\n * Show the changelog modal and fetch releases from GitHub\r\n */\r\nexport function showChangelog(): void {\r\n  const modal = document.getElementById('changelog-modal');\r\n  const body = document.getElementById('changelog-body');\r\n\r\n  if (modal) modal.classList.remove('hidden');\r\n  if (body) body.innerHTML = '<div class=\"changelog-loading\">Loading changelog...</div>';\r\n\r\n  fetch(GITHUB_RELEASES_URL)\r\n    .then((r) => r.json())\r\n    .then((releases: GitHubRelease[]) => {\r\n      if (!body) return;\r\n\r\n      if (!releases || releases.length === 0) {\r\n        body.innerHTML = '<p>No releases found.</p>';\r\n        return;\r\n      }\r\n\r\n      let html = '';\r\n      releases.forEach((release) => {\r\n        const version = release.tag_name || 'Unknown';\r\n        const date = release.published_at\r\n          ? new Date(release.published_at).toLocaleDateString()\r\n          : '';\r\n        const notes = release.body || 'No release notes.';\r\n\r\n        html += '<div class=\"changelog-release\">';\r\n        html += '<div class=\"changelog-version\">' + escapeHtml(version) + '</div>';\r\n        if (date) html += '<div class=\"changelog-date\">' + escapeHtml(date) + '</div>';\r\n        html += '<div class=\"changelog-notes\">' + formatMarkdown(notes) + '</div>';\r\n        html += '</div>';\r\n      });\r\n\r\n      body.innerHTML = html;\r\n    })\r\n    .catch((e) => {\r\n      if (body) {\r\n        body.innerHTML =\r\n          '<p class=\"changelog-error\">Failed to load changelog. ' +\r\n          '<a href=\"' + GITHUB_RELEASES_PAGE + '\" target=\"_blank\">View on GitHub</a></p>';\r\n      }\r\n      console.error('Changelog error:', e);\r\n    });\r\n}\r\n\r\n/**\r\n * Close the changelog modal\r\n */\r\nexport function closeChangelog(): void {\r\n  const modal = document.getElementById('changelog-modal');\r\n  if (modal) modal.classList.add('hidden');\r\n}\r\n\r\n/**\r\n * Format markdown text to HTML (basic subset)\r\n *\r\n * Supports: headers (## and ###), bold (**text**),\r\n * links [text](url), and bullet lists (- item)\r\n */\r\nexport function formatMarkdown(text: string): string {\r\n  return escapeHtml(text)\r\n    .replace(/^### (.+)$/gm, '<h4>$1</h4>')\r\n    .replace(/^## (.+)$/gm, '<h3>$1</h3>')\r\n    .replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>')\r\n    .replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\">$1</a>')\r\n    .replace(/^- (.+)$/gm, '<li>$1</li>')\r\n    .replace(/(<li>.*<\\/li>)/s, '<ul>$1</ul>')\r\n    .replace(/\\n/g, '<br>');\r\n}\r\n"],
  "mappings": "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",
  "names": ["THEMES", "INITIAL_RECONNECT_DELAY", "MAX_RECONNECT_DELAY", "TERMINAL_FONT_STACK", "FONT_CHAR_WIDTH_RATIO", "FONT_LINE_HEIGHT_RATIO", "TERMINAL_PADDING", "MIN_TERMINAL_COLS", "MIN_TERMINAL_ROWS", "MAX_TERMINAL_COLS", "MAX_TERMINAL_ROWS", "MAX_FRAME_DIMENSION", "MOBILE_BREAKPOINT", "init_constants", "__esmMin", "setSessions", "newSessions", "sessions", "setActiveSessionId", "id", "activeSessionId", "setCurrentSettings", "settings", "currentSettings", "setUpdateInfo", "info", "updateInfo", "setAuthStatus", "status", "authStatus", "setSettingsOpen", "open", "settingsOpen", "setSidebarOpen", "sidebarOpen", "setSidebarCollapsed", "collapsed", "sidebarCollapsed", "setStateWs", "ws", "stateWs", "setStateReconnectTimer", "timer", "stateReconnectTimer", "setStateReconnectDelay", "delay", "stateReconnectDelay", "setStateWsConnected", "connected", "stateWsConnected", "setMuxWs", "muxWs", "setMuxReconnectTimer", "muxReconnectTimer", "setMuxReconnectDelay", "muxReconnectDelay", "setMuxWsConnected", "muxWsConnected", "setFontsReadyPromise", "promise", "fontsReadyPromise", "setWindowsBuildNumber", "build", "windowsBuildNumber", "cacheDOMElements", "dom", "sessionTerminals", "newlyCreatedSessions", "pendingSessions", "pendingOutputFrames", "init_state", "__esmMin", "escapeHtml", "text", "div", "bindClick", "id", "handler", "el", "init_dom", "__esmMin", "getCookie", "name", "match", "setCookie", "value", "days", "expires", "getClipboardStyle", "setting", "ua", "init_cookies", "__esmMin", "parseOutputFrame", "payload", "cols", "rows", "data", "valid", "MAX_FRAME_DIMENSION", "init_protocol", "__esmMin", "init_constants", "scheduleReconnect", "currentDelay", "maxDelay", "connect", "setDelay", "setTimer", "existingTimer", "timer", "init_reconnect", "__esmMin", "init_utils", "__esmMin", "init_dom", "init_cookies", "init_protocol", "init_reconnect", "registerScalingCallbacks", "callbacks", "sendResize", "fitSessionToScreen", "sessionId", "state", "sessionTerminals", "fontsReadyPromise", "xterm", "wasHidden", "rect", "dom", "renderService", "cellWidth", "cellHeight", "dims", "availWidth", "TERMINAL_PADDING", "availHeight", "cols", "rows", "MIN_TERMINAL_COLS", "MAX_TERMINAL_COLS", "MIN_TERMINAL_ROWS", "MAX_TERMINAL_ROWS", "applyTerminalScaling", "container", "termWidth", "termHeight", "scaleX", "scaleY", "scale", "rescaleAllTerminals", "setupResizeObserver", "setupVisualViewport", "lastHeight", "updateViewportHeight", "vh", "mobileHeader", "headerHeight", "availableHeight", "init_scaling", "__esmMin", "init_constants", "init_state", "registerFileDropCallbacks", "callbacks", "sendInput", "pasteToTerminal", "uploadFile", "sessionId", "file", "formData", "response", "error", "handleFileDrop", "files", "activeSessionId", "paths", "path", "setupFileDrop", "container", "e", "handleClipboardPaste", "items", "item", "imageType", "t", "blob", "timestamp", "text", "init_fileDrop", "__esmMin", "init_state", "initSearchForTerminal", "sessionId", "terminal", "addon", "searchStates", "cleanupSearchForTerminal", "showSearch", "searchContainer", "searchInput", "searchResults", "searchVisible", "hideSearch", "activeSessionId", "state", "termState", "sessionTerminals", "isSearchVisible", "findNext", "query", "result", "updateSearchResults", "findPrevious", "found", "bindSearchEvents", "prevBtn", "nextBtn", "closeBtn", "e", "init_search", "__esmMin", "init_state", "updateSessionNameAuto", "sessionId", "name", "sessions", "s", "existing", "pendingTitleUpdates", "timer", "registerTerminalCallbacks", "callbacks", "sendInput", "showBellNotification", "getTerminalOptions", "isMobile", "MOBILE_BREAKPOINT", "baseFontSize", "currentSettings", "fontSize", "themeName", "fontFamily", "options", "TERMINAL_FONT_STACK", "THEMES", "windowsBuildNumber", "createTerminalForSession", "sessionInfo", "sessionTerminals", "container", "dom", "setupFileDrop", "terminal", "fitAddon", "serverCols", "serverRows", "state", "fontsReadyPromise", "webglAddon", "webLinksAddon", "_event", "uri", "initSearchForTerminal", "replayPendingFrames", "fitSessionToScreen", "setupTerminalEvents", "frames", "pendingOutputFrames", "payload", "writeOutputFrame", "frame", "parseOutputFrame", "currentCols", "currentRows", "applyTerminalScaling", "data", "title", "e", "getClipboardStyle", "handleClipboardPaste", "showSearch", "isSearchVisible", "hideSearch", "pasteHandler", "contextMenuHandler", "destroyTerminalForSession", "cleanupSearchForTerminal", "titleTimer", "pasteToTerminal", "applySettingsToTerminals", "fetchAndWriteBuffer", "response", "buffer", "refreshActiveTerminalBuffer", "activeSessionId", "preloadTerminalFont", "promise", "testSpan", "resolve", "setFontsReadyPromise", "init_manager", "__esmMin", "init_constants", "init_state", "init_utils", "init_scaling", "init_fileDrop", "init_search", "terminal_exports", "__export", "applySettingsToTerminals", "applyTerminalScaling", "bindSearchEvents", "cleanupSearchForTerminal", "createTerminalForSession", "destroyTerminalForSession", "fetchAndWriteBuffer", "findNext", "findPrevious", "fitSessionToScreen", "getTerminalOptions", "handleClipboardPaste", "hideSearch", "initSearchForTerminal", "isSearchVisible", "pasteToTerminal", "preloadTerminalFont", "refreshActiveTerminalBuffer", "registerFileDropCallbacks", "registerScalingCallbacks", "registerTerminalCallbacks", "rescaleAllTerminals", "setupFileDrop", "setupResizeObserver", "setupTerminalEvents", "setupVisualViewport", "showSearch", "writeOutputFrame", "init_terminal", "__esmMin", "init_manager", "init_scaling", "init_search", "init_fileDrop", "setElementValue", "id", "value", "el", "setElementChecked", "checked", "getElementValue", "defaultValue", "getElementChecked", "populateVersionInfo", "version", "webEl", "shortVersion", "populateUserDropdown", "users", "selectedUser", "select", "user", "option", "populateSettingsForm", "settings", "fetchSettings", "r", "setCurrentSettings", "applySettingsToTerminals", "currentSettings", "theme", "THEMES", "fontFamily", "TERMINAL_FONT_STACK", "sessionTerminals", "state", "dims", "saveAllSettings", "runAsUserValue", "setCookie", "e", "bindSettingsAutoSave", "settingsView", "dom", "wrapper", "input", "saveBtn", "originalValue", "init_persistence", "__esmMin", "init_constants", "init_state", "init_utils", "closeSidebar", "app", "dom", "toggleSettings", "settingsOpen", "closeSettings", "openSettings", "setSettingsOpen", "activeSessionId", "state", "sessionTerminals", "fetchSettings", "fetchSystemStatus", "sessions", "formatUptime", "seconds", "hours", "mins", "updateConHostWarning", "health", "banner", "header", "container", "response", "statusClass", "statusText", "uptimeStr", "conHostHtml", "err", "message", "checkSystemHealth", "setWindowsBuildNumber", "init_panel", "__esmMin", "init_state", "init_persistence", "settings_exports", "__export", "bindSettingsAutoSave", "checkSystemHealth", "closeSettings", "fetchSettings", "fetchSystemStatus", "formatUptime", "getElementChecked", "getElementValue", "openSettings", "populateSettingsForm", "populateUserDropdown", "populateVersionInfo", "saveAllSettings", "setElementChecked", "setElementValue", "toggleSettings", "updateConHostWarning", "init_settings", "__esmMin", "init_panel", "init_persistence", "init_constants", "init_state", "init_utils", "initThemeFromCookie", "savedTheme", "THEMES", "init_constants", "init_utils", "init_state", "destroyTerminalForSession", "applyTerminalScaling", "renderSessionList", "updateEmptyState", "selectSession", "updateMobileTitle", "renderUpdatePanel", "registerStateCallbacks", "callbacks", "connectStateWebSocket", "stateWs", "setStateWs", "protocol", "ws", "setStateReconnectDelay", "INITIAL_RECONNECT_DELAY", "setStateWsConnected", "updateConnectionStatus", "event", "data", "sessionList", "handleStateUpdate", "handleUpdateInfo", "e", "message", "scheduleStateReconnect", "newSessions", "newIds", "s", "sessionTerminals", "_", "id", "newlyCreatedSessions", "session", "state", "setSessions", "activeSessionId", "sessions", "setActiveSessionId", "update", "setUpdateInfo", "scheduleReconnect", "stateReconnectDelay", "MAX_RECONNECT_DELAY", "setStateReconnectTimer", "stateReconnectTimer", "indicator", "status", "text", "stateWsConnected", "muxWsConnected", "init_constants", "init_utils", "init_state", "applyTerminalScaling", "refreshActiveTerminalBuffer", "registerMuxCallbacks", "callbacks", "connectMuxWebSocket", "muxWs", "setMuxWs", "protocol", "ws", "wasReconnect", "muxReconnectDelay", "INITIAL_RECONNECT_DELAY", "setMuxReconnectDelay", "setMuxWsConnected", "updateConnectionStatus", "event", "data", "type", "sessionId", "decodeSessionId", "payload", "sessionTerminals", "state", "pendingOutputFrames", "writeOutputFrame", "scheduleMuxReconnect", "e", "sendInput", "frame", "encodeSessionId", "sendResize", "cols", "rows", "buffer", "offset", "i", "chars", "scheduleReconnect", "MAX_RECONNECT_DELAY", "setMuxReconnectTimer", "muxReconnectTimer", "writeOutputFrame", "sessionId", "state", "payload", "frame", "parseOutputFrame", "termCore", "currentCols", "currentRows", "applyTerminalScaling", "e", "message", "init_terminal", "init_state", "callbacks", "setSessionListCallbacks", "cbs", "getSessionDisplayName", "session", "renderSessionList", "dom", "sessions", "isPending", "pendingSessions", "item", "activeSessionId", "info", "spinner", "title", "actions", "resizeBtn", "e", "renameBtn", "closeBtn", "realSessionCount", "s", "updateEmptyState", "settingsOpen", "updateMobileTitle", "init_state", "init_utils", "init_scaling", "SIDEBAR_COLLAPSED_COOKIE", "SIDEBAR_WIDTH_COOKIE", "DESKTOP_BREAKPOINT", "MIN_SIDEBAR_WIDTH", "MAX_SIDEBAR_WIDTH", "toggleSidebar", "setSidebarOpen", "sidebarOpen", "dom", "closeSidebar", "collapseSidebar", "setSidebarCollapsed", "setCookie", "updateIslandTitle", "rescaleAllTerminals", "expandSidebar", "session", "sessions", "s", "activeSessionId", "getSessionDisplayName", "restoreSidebarState", "getCookie", "savedWidth", "width", "sidebar", "setupSidebarResize", "grip", "isResizing", "startX", "startWidth", "e", "delta", "newWidth", "currentWidth", "init_settings", "init_state", "checkAuthStatus", "response", "status", "setAuthStatus", "updateSecurityWarning", "updatePasswordStatus", "warning", "authStatus", "statusEl", "dismissSecurityWarning", "init_state", "init_utils", "passwordModalHasPassword", "showPasswordModal", "isInitialSetup", "modal", "title", "currentGroup", "errorEl", "authStatus", "form", "focusFieldId", "field", "hidePasswordModal", "handlePasswordSubmit", "currentPw", "newPw", "confirmPw", "saveBtn", "newPassword", "confirmPassword", "showPasswordError", "payload", "r", "data", "result", "checkAuthStatus", "msg", "bindAuthEvents", "bindClick", "dismissSecurityWarning", "passwordBackdrop", "passwordForm", "init_state", "MAX_RELOAD_ATTEMPTS", "RELOAD_INTERVAL_MS", "INITIAL_RESTART_DELAY_MS", "renderUpdatePanel", "panel", "updateInfo", "currentEl", "latestEl", "noteEl", "headerEl", "applyUpdate", "btn", "r", "waitForServerAndReload", "e", "attempts", "checkServer", "checkForUpdates", "statusEl", "update", "setUpdateInfo", "applyBtn", "msg", "init_utils", "GITHUB_RELEASES_URL", "GITHUB_RELEASES_PAGE", "showChangelog", "modal", "body", "r", "releases", "html", "release", "version", "date", "notes", "escapeHtml", "formatMarkdown", "e", "closeChangelog", "text", "init_state", "init_constants", "init_utils", "sessionTerminals", "activeSessionId", "currentSettings", "initThemeFromCookie", "init", "cacheDOMElements", "restoreSidebarState", "setupSidebarResize", "fontPromise", "preloadTerminalFont", "setFontsReadyPromise", "registerCallbacks", "connectStateWebSocket", "connectMuxWebSocket", "checkSystemHealth", "bindEvents", "bindAuthEvents", "bindSearchEvents", "setupResizeObserver", "setupVisualViewport", "fetchVersion", "fetchNetworks", "fetchSettings", "checkAuthStatus", "requestNotificationPermission", "setupVisibilityChangeHandler", "registerStateCallbacks", "destroyTerminalForSession", "applyTerminalScaling", "renderSessionList", "updateEmptyState", "selectSession", "updateMobileTitle", "renderUpdatePanel", "registerMuxCallbacks", "refreshActiveTerminalBuffer", "registerTerminalCallbacks", "sendInput", "showBellNotification", "registerFileDropCallbacks", "pasteToTerminal", "registerScalingCallbacks", "sessionId", "terminal", "sendResize", "setSessionListCallbacks", "deleteSession", "startInlineRename", "fitSessionToScreen", "closeSidebar", "stateWsConnected", "muxWsConnected", "createSession", "rect", "dom", "cols", "rows", "fontSize", "charWidth", "FONT_CHAR_WIDTH_RATIO", "lineHeight", "FONT_LINE_HEIGHT_RATIO", "availWidth", "TERMINAL_PADDING", "availHeight", "measuredCols", "measuredRows", "MIN_TERMINAL_COLS", "MIN_TERMINAL_ROWS", "MAX_TERMINAL_COLS", "MAX_TERMINAL_ROWS", "tempId", "tempSession", "sessions", "pendingSessions", "r", "session", "idx", "s", "newlyCreatedSessions", "e", "settingsOpen", "closeSettings", "state", "setActiveSessionId", "sessionInfo", "createTerminalForSession", "isNewTerminal", "isNewlyCreated", "mod", "renameSession", "newName", "trimmedName", "nameToSend", "item", "titleSpan", "currentName", "input", "finishRename", "promptRenameSession", "bellStyle", "title", "getSessionDisplayName", "v", "shortVersion", "el", "networks", "list", "escapeHtml", "bindClick", "toggleSidebar", "collapseSidebar", "expandSidebar", "toggleSettings", "applyUpdate", "checkForUpdates", "showChangelog", "closeChangelog", "changelogBackdrop"]
}
